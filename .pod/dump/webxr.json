{
  "version": "0.0.102",
  "files": [
    {
      "filename": "cloned/d3/tangled-tree-visualization-ii/4cab522856cbfdde@670.js",
      "content": "import define1 from \"./5cd5cb7ccc2b790f@200.js\";\n\nfunction _1(md){return(\nmd`# Tangled tree visualization`\n)}\n\nfunction _2(renderChart,data){return(\nrenderChart(data)\n)}\n\nfunction _intro(md){return(\nmd`A tree with multiple inheritance (sometimes called *tangled tree*) cannot be represented by using a classic tree visualization. It is technically a directed acyclic graph (DAG) with one (or more) nodes identified as root. Using a graph visualization technique solves the issue, but poorly represents some peculiarities of a quasi-tree structure.\n\nThis visualization tries to address the representation of a tangled tree (a genealogy in this specific example). The layout and basic technique is the same underlying [Geneaquilts](https://aviz.fr/Research/Geneaquilts) [[1](#footnote1)], but with curved links instead of matrices. Metro-style bundling is used when a parent node appears in multiple \"families\", and the layout is made more compact on the y axis.\n\nThe intention is for the graphic to be more readily understood, while losing some of the advantages of Geneaquilts (e.g., representing a union without children). See also [this older, simpler example](https://beta.observablehq.com/@nitaku/tangled-tree-visualization).\n\nThe technique can also be applied to other types of tangled trees. Such structures are commonly found in computational linguistics (thesauri, some ontologies, wordnets).\n\n(Thanks to [@trebor](https://observablehq.com/@trebor) for making it more reusable!)`\n)}\n\nfunction _4(md){return(\nmd`## Code`\n)}\n\nfunction _renderChart(color,constructTangleLayout,_,svg,background_color){return(\n(data, options={}) => {\n  options.color ||= (d, i) => color(i)\n  \n  const tangleLayout = constructTangleLayout(_.cloneDeep(data), options);\n\n  return svg`<svg width=\"${tangleLayout.layout.width}\" height=\"${\n    tangleLayout.layout.height\n  }\" style=\"background-color: ${background_color}\">\n  <style>\n    text {\n      font-family: sans-serif;\n      font-size: 10px;\n    }\n    .node {\n      stroke-linecap: round;\n    }\n    .link {\n      fill: none;\n    }\n  </style>\n\n  ${tangleLayout.bundles.map((b, i) => {\n    let d = b.links\n      .map(\n        l => `\n      M${l.xt} ${l.yt}\n      L${l.xb - l.c1} ${l.yt}\n      A${l.c1} ${l.c1} 90 0 1 ${l.xb} ${l.yt + l.c1}\n      L${l.xb} ${l.ys - l.c2}\n      A${l.c2} ${l.c2} 90 0 0 ${l.xb + l.c2} ${l.ys}\n      L${l.xs} ${l.ys}`\n      )\n      .join(\"\");\n    return `\n      <path class=\"link\" d=\"${d}\" stroke=\"${background_color}\" stroke-width=\"5\"/>\n      <path class=\"link\" d=\"${d}\" stroke=\"${options.color(b, i)}\" stroke-width=\"2\"/>\n    `;\n  })}\n\n  ${tangleLayout.nodes.map(\n    n => `\n    <path class=\"selectable node\" data-id=\"${\n      n.id\n    }\" stroke=\"black\" stroke-width=\"8\" d=\"M${n.x} ${n.y - n.height / 2} L${\n      n.x\n    } ${n.y + n.height / 2}\"/>\n    <path class=\"node\" stroke=\"white\" stroke-width=\"4\" d=\"M${n.x} ${n.y -\n      n.height / 2} L${n.x} ${n.y + n.height / 2}\"/>\n\n    <text class=\"selectable\" data-id=\"${n.id}\" x=\"${n.x + 4}\" y=\"${n.y -\n      n.height / 2 -\n      4}\" stroke=\"${background_color}\" stroke-width=\"2\">${n.id}</text>\n    <text x=\"${n.x + 4}\" y=\"${n.y -\n      n.height / 2 -\n      4}\" style=\"pointer-events: none;\">${n.id}</text>\n  `\n  )}\n\n  </svg>`;\n}\n)}\n\nfunction _data(){return(\n[\n  [{ id: 'Chaos' }],\n  [{ id: 'Gaea', parents: ['Chaos'] }, { id: 'Uranus' }],\n  [\n    { id: 'Oceanus', parents: ['Gaea', 'Uranus'] },\n    { id: 'Thethys', parents: ['Gaea', 'Uranus'] },\n    { id: 'Pontus' },\n    { id: 'Rhea', parents: ['Gaea', 'Uranus'] },\n    { id: 'Cronus', parents: ['Gaea', 'Uranus'] },\n    { id: 'Coeus', parents: ['Gaea', 'Uranus'] },\n    { id: 'Phoebe', parents: ['Gaea', 'Uranus'] },\n    { id: 'Crius', parents: ['Gaea', 'Uranus'] },\n    { id: 'Hyperion', parents: ['Gaea', 'Uranus'] },\n    { id: 'Iapetus', parents: ['Gaea', 'Uranus'] },\n    { id: 'Thea', parents: ['Gaea', 'Uranus'] },\n    { id: 'Themis', parents: ['Gaea', 'Uranus'] },\n    { id: 'Mnemosyne', parents: ['Gaea', 'Uranus'] }\n  ],\n  [\n    { id: 'Doris', parents: ['Oceanus', 'Thethys'] },\n    { id: 'Neures', parents: ['Pontus', 'Gaea'] },\n    { id: 'Dionne' },\n    { id: 'Demeter', parents: ['Rhea', 'Cronus'] },\n    { id: 'Hades', parents: ['Rhea', 'Cronus'] },\n    { id: 'Hera', parents: ['Rhea', 'Cronus'] },\n    { id: 'Alcmene' },\n    { id: 'Zeus', parents: ['Rhea', 'Cronus'] },\n    { id: 'Eris' },\n    { id: 'Leto', parents: ['Coeus', 'Phoebe'] },\n    { id: 'Amphitrite' },\n    { id: 'Medusa' },\n    { id: 'Poseidon', parents: ['Rhea', 'Cronus'] },\n    { id: 'Hestia', parents: ['Rhea', 'Cronus'] }\n  ],\n  [\n    { id: 'Thetis', parents: ['Doris', 'Neures'] },\n    { id: 'Peleus' },\n    { id: 'Anchises' },\n    { id: 'Adonis' },\n    { id: 'Aphrodite', parents: ['Zeus', 'Dionne'] },\n    { id: 'Persephone', parents: ['Zeus', 'Demeter'] },\n    { id: 'Ares', parents: ['Zeus', 'Hera'] },\n    { id: 'Hephaestus', parents: ['Zeus', 'Hera'] },\n    { id: 'Hebe', parents: ['Zeus', 'Hera'] },\n    { id: 'Hercules', parents: ['Zeus', 'Alcmene'] },\n    { id: 'Megara' },\n    { id: 'Deianira' },\n    { id: 'Eileithya', parents: ['Zeus', 'Hera'] },\n    { id: 'Ate', parents: ['Zeus', 'Eris'] },\n    { id: 'Leda' },\n    { id: 'Athena', parents: ['Zeus'] },\n    { id: 'Apollo', parents: ['Zeus', 'Leto'] },\n    { id: 'Artemis', parents: ['Zeus', 'Leto'] },\n    { id: 'Triton', parents: ['Poseidon', 'Amphitrite'] },\n    { id: 'Pegasus', parents: ['Poseidon', 'Medusa'] },\n    { id: 'Orion', parents: ['Poseidon'] },\n    { id: 'Polyphemus', parents: ['Poseidon'] }\n  ],\n  [\n    { id: 'Deidamia' },\n    { id: 'Achilles', parents: ['Peleus', 'Thetis'] },\n    { id: 'Creusa' },\n    { id: 'Aeneas', parents: ['Anchises', 'Aphrodite'] },\n    { id: 'Lavinia' },\n    { id: 'Eros', parents: ['Hephaestus', 'Aphrodite'] },\n    { id: 'Helen', parents: ['Leda', 'Zeus'] },\n    { id: 'Menelaus' },\n    { id: 'Polydueces', parents: ['Leda', 'Zeus'] }\n  ],\n  [\n    { id: 'Andromache' },\n    { id: 'Neoptolemus', parents: ['Deidamia', 'Achilles'] },\n    { id: 'Aeneas(2)', parents: ['Creusa', 'Aeneas'] },\n    { id: 'Pompilius', parents: ['Creusa', 'Aeneas'] },\n    { id: 'Iulus', parents: ['Lavinia', 'Aeneas'] },\n    { id: 'Hermione', parents: ['Helen', 'Menelaus'] }\n  ]\n]\n)}\n\nfunction _constructTangleLayout(d3){return(\n(levels, options={}) => {\n  // precompute level depth\n  levels.forEach((l, i) => l.forEach(n => (n.level = i)));\n\n  var nodes = levels.reduce((a, x) => a.concat(x), []);\n  var nodes_index = {};\n  nodes.forEach(d => (nodes_index[d.id] = d));\n\n  // objectification\n  nodes.forEach(d => {\n    d.parents = (d.parents === undefined ? [] : d.parents).map(\n      p => nodes_index[p]\n    );\n  });\n\n  // precompute bundles\n  levels.forEach((l, i) => {\n    var index = {};\n    l.forEach(n => {\n      if (n.parents.length == 0) {\n        return;\n      }\n\n      var id = n.parents\n        .map(d => d.id)\n        .sort()\n        .join('-X-');\n      if (id in index) {\n        index[id].parents = index[id].parents.concat(n.parents);\n      } else {\n        index[id] = { id: id, parents: n.parents.slice(), level: i, span: i - d3.min(n.parents, p => p.level) };\n      }\n      n.bundle = index[id];\n    });\n    l.bundles = Object.keys(index).map(k => index[k]);\n    l.bundles.forEach((b, i) => (b.i = i));\n  });\n\n  var links = [];\n  nodes.forEach(d => {\n    d.parents.forEach(p =>\n      links.push({ source: d, bundle: d.bundle, target: p })\n    );\n  });\n\n  var bundles = levels.reduce((a, x) => a.concat(x.bundles), []);\n\n  // reverse pointer from parent to bundles\n  bundles.forEach(b =>\n    b.parents.forEach(p => {\n      if (p.bundles_index === undefined) {\n        p.bundles_index = {};\n      }\n      if (!(b.id in p.bundles_index)) {\n        p.bundles_index[b.id] = [];\n      }\n      p.bundles_index[b.id].push(b);\n    })\n  );\n\n  nodes.forEach(n => {\n    if (n.bundles_index !== undefined) {\n      n.bundles = Object.keys(n.bundles_index).map(k => n.bundles_index[k]);\n    } else {\n      n.bundles_index = {};\n      n.bundles = [];\n    }\n    n.bundles.sort((a,b) => d3.descending(d3.max(a, d => d.span), d3.max(b, d => d.span)))\n    n.bundles.forEach((b, i) => (b.i = i));\n  });\n\n  links.forEach(l => {\n    if (l.bundle.links === undefined) {\n      l.bundle.links = [];\n    }\n    l.bundle.links.push(l);\n  });\n\n  // layout\n  const padding = 8;\n  const node_height = 22;\n  const node_width = 70;\n  const bundle_width = 14;\n  const level_y_padding = 16;\n  const metro_d = 4;\n  const min_family_height = 22;\n  \n  options.c ||= 16;\n  const c = options.c;\n  options.bigc ||= node_width+c;\n\n  nodes.forEach(\n    n => (n.height = (Math.max(1, n.bundles.length) - 1) * metro_d)\n  );\n\n  var x_offset = padding;\n  var y_offset = padding;\n  levels.forEach(l => {\n    x_offset += l.bundles.length * bundle_width;\n    y_offset += level_y_padding;\n    l.forEach((n, i) => {\n      n.x = n.level * node_width + x_offset;\n      n.y = node_height + y_offset + n.height / 2;\n\n      y_offset += node_height + n.height;\n    });\n  });\n\n  var i = 0;\n  levels.forEach(l => {\n    l.bundles.forEach(b => {\n      b.x =\n        d3.max(b.parents, d => d.x) +\n        node_width +\n        (l.bundles.length - 1 - b.i) * bundle_width;\n      b.y = i * node_height;\n    });\n    i += l.length;\n  });\n\n  links.forEach(l => {\n    l.xt = l.target.x;\n    l.yt =\n      l.target.y +\n      l.target.bundles_index[l.bundle.id].i * metro_d -\n      (l.target.bundles.length * metro_d) / 2 +\n      metro_d / 2;\n    l.xb = l.bundle.x;\n    l.yb = l.bundle.y;\n    l.xs = l.source.x;\n    l.ys = l.source.y;\n  });\n  \n  // compress vertical space\n  var y_negative_offset = 0;\n  levels.forEach(l => {\n    y_negative_offset +=\n      -min_family_height +\n        d3.min(l.bundles, b =>\n          d3.min(b.links, link => link.ys - 2*c - (link.yt + c))\n        ) || 0;\n    l.forEach(n => (n.y -= y_negative_offset));\n  });\n\n  // very ugly, I know\n  links.forEach(l => {\n    l.yt =\n      l.target.y +\n      l.target.bundles_index[l.bundle.id].i * metro_d -\n      (l.target.bundles.length * metro_d) / 2 +\n      metro_d / 2;\n    l.ys = l.source.y;\n    l.c1 = l.source.level - l.target.level > 1 ? Math.min(options.bigc, l.xb-l.xt, l.yb-l.yt)-c : c;\n    l.c2 = c;\n  });\n\n  var layout = {\n    width: d3.max(nodes, n => n.x) + node_width + 2 * padding,\n    height: d3.max(nodes, n => n.y) + node_height / 2 + 2 * padding,\n    node_height,\n    node_width,\n    bundle_width,\n    level_y_padding,\n    metro_d\n  };\n\n  return { levels, nodes, nodes_index, links, bundles, layout };\n}\n)}\n\nfunction _color(d3){return(\nd3.scaleOrdinal(d3.schemeDark2)\n)}\n\nfunction _background_color(){return(\n'white'\n)}\n\nfunction _10(md){return(\nmd`## Dependencies`\n)}\n\nfunction _d3(require){return(\nrequire('d3-scale', 'd3-scale-chromatic', 'd3-array')\n)}\n\nfunction __(require){return(\nrequire(\"lodash\")\n)}\n\nfunction _14(md){return(\nmd`## References`\n)}\n\nfunction _footnote1(footnote){return(\nfootnote(\"intro\", 1, `A. Bezerianos, P. Dragicevic, J. Fekete, J. Bae and B. Watson, \"GeneaQuilts: A System for Exploring Large Genealogies,\" in IEEE Transactions on Visualization and Computer Graphics, vol. 16, no. 6, pp. 1073-1081, Nov.-Dec. 2010, doi: 10.1109/TVCG.2010.159.`)\n)}\n\nexport default function define(runtime, observer) {\n  const main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  main.variable(observer()).define([\"renderChart\",\"data\"], _2);\n  main.variable(observer(\"intro\")).define(\"intro\", [\"md\"], _intro);\n  main.variable(observer()).define([\"md\"], _4);\n  main.variable(observer(\"renderChart\")).define(\"renderChart\", [\"color\",\"constructTangleLayout\",\"_\",\"svg\",\"background_color\"], _renderChart);\n  main.variable(observer(\"data\")).define(\"data\", _data);\n  main.variable(observer(\"constructTangleLayout\")).define(\"constructTangleLayout\", [\"d3\"], _constructTangleLayout);\n  main.variable(observer(\"color\")).define(\"color\", [\"d3\"], _color);\n  main.variable(observer(\"background_color\")).define(\"background_color\", _background_color);\n  main.variable(observer()).define([\"md\"], _10);\n  main.variable(observer(\"d3\")).define(\"d3\", [\"require\"], _d3);\n  main.variable(observer(\"_\")).define(\"_\", [\"require\"], __);\n  const child1 = runtime.module(define1);\n  main.import(\"footnote\", child1);\n  main.variable(observer()).define([\"md\"], _14);\n  main.variable(observer(\"footnote1\")).define(\"footnote1\", [\"footnote\"], _footnote1);\n  return main;\n}\n"
    },
    {
      "filename": "cloned/d3/tangled-tree-visualization-ii/5cd5cb7ccc2b790f@200.js",
      "content": "// https://observablehq.com/@jashkenas/markdown-style-footnotes@200\nfunction _1(md){return(\nmd`# Markdown-Style Footnotes Refined\n\n*Using a bit of the Iliad, in the [Buckley translation](http://www.gutenberg.org/files/22382/22382-h/22382-h.htm), for the demonstration.*`\n)}\n\nfunction _paragraph1(md){return(\nmd`But to them arose the hero, the son of Atreus, wide-ruling Agamemnon,<sup>[[19](#footnote19)]</sup> agitated; and his all-gloomy heart was greatly filled with wrath, and his eyes were like unto gleaming fire. Sternly regarding Calchas most of all, he addressed [him]:\n\n“Prophet of ills, not at any time hast thou spoken anything good for me; but evils are always gratifying to thy soul to prophesy,<sup>[[20](#footnote20)]</sup> and never yet hast thou offered one good word, nor accomplished [one]. And now, prophesying amongst the Greeks, thou haranguest that forsooth the Far-darter works griefs to them upon this account, because I was unwilling to accept the splendid ransom of the virgin daughter of Chryses, since I much prefer to have her at home; and my reason is, I prefer her even to Clytemnestra, my lawful wife; for she is not inferior to her, either in person, or in figure, or in mind, or by any means in accomplishments. But even thus I am willing to restore her, if it be better; for I wish the people to be safe rather than to perish. But do thou immediately prepare a prize for me, that I may not alone, of the Argives, be without a prize; since it is not fitting. For ye all see this, that my prize is going elsewhere.”`\n)}\n\nfunction _paragraph2(md){return(\nmd`But him swift-footed godlike Achilles then answered: “Most noble son of Atreus, most avaricious of all! for how shall the magnanimous Greeks assign thee a prize? Nor do we know of many common stores laid up anywhere. But what we plundered<sup>[[21](#footnote21)]</sup> from the cities, these have been divided, and it is not fitting that the troops should collect these brought together again. But do thou now let her go to the God, and we Greeks will compensate thee thrice, or four-fold, if haply Jove grant to us to sack the well-fortified city of Troy.”`\n)}\n\nfunction _paragraph3(md){return(\nmd`But him answering, king Agamemnon addressed: “Do not thus, excellent though thou be, godlike Achilles, practise deceit in thy mind; since thou shalt not overreach, nor yet persuade me. Dost thou wish that thou thyself mayest have a prize, whilst I sit down idly,<sup>[[22](#footnote22)]</sup> wanting one? And dost thou bid me to restore her? If, however, the magnanimous Greeks will give me a prize, having suited it to my mind, so that it shall be an equivalent, [it is well]. But if they will not give it, then I myself coming, will seize your prize, or that of Ajax,<sup>[[23](#footnote23)]</sup> or Ulysses,<sup>[[24](#footnote24)]</sup> and will bear it away; and he to whom I may come shall have cause for anger. On these things, however, we will consult afterwards. But now come, let us launch a sable ship into the boundless sea, and let us collect into it rowers in sufficient number, and place on board a hecatomb; and let us make the fair-cheeked daughter of Chryses to embark, and let some one noble man be commander, Ajax or Idomeneus, or divine Ulysses; or thyself, son of Peleus, most terrible of all men, that thou mayest appease for us the Far-darter, having offered sacrifices.”`\n)}\n\nfunction _paragraph4(md){return(\nmd`But him swift-footed Achilles sternly regarding, addressed: “Ha!<sup>[[25](#footnote25)]</sup> thou clad in impudence, thou bent on gain, how can any of the Greeks willingly obey thy orders, either to undertake a mission, or to fight bravely with men? For I did not come hither to fight on account of the warlike Trojans, seeing that they are blameless as respects me. Since they have never driven away my oxen, nor my horses either nor ever injured my crops in fertile and populous Phthia: for very many shadowy mountains, and the resounding sea, are between us. But thee, O most shameless man, we follow, that thou mayest rejoice; seeking satisfaction from the Trojans for Menelaus, and for thy pleasure, shameless one! for which things thou hast neither respect nor care. And now thou hast threatened that thou wilt in person wrest from me my prize, for which I have toiled much, and which the sons of the Greeks have given me. Whenever the Greeks sacked a well-inhabited city of the Trojans, I never have had a prize equal to thine; although my hands perform the greater portion of the tumultuous conflict, yet when the division [of spoil] may come, a much greater prize is given to thee, while I come to my ships, when I am fatigued with fighting, having one small and agreeable. But now I will go to Phthia, for it is much better to return home with our curved ships; for I do not think that thou shalt amass wealth and treasures while I am dishonoured here.”`\n)}\n\nfunction _paragraph5(md){return(\nmd`But him, the king of men, Agamemnon, then answered: “Fly, by all means, if thy mind urges thee; nor will I entreat thee to remain on my account: there are others with me who will honour me, but chiefly the all-wise Jove. For to me thou art the most odious of the Jove-nourished princes, for ever is contention agreeable to thee, and wars and battles. If thou be very bold, why doubtless a deity has given this to thee. Going home with thy ships and thy companions, rule over the Myrmidons; for I do not regard thee, nor care for thee in thy wrath; but thus will I threaten thee: Since Phoebus Apollo is depriving me of the daughter of Chryses,<sup>[[26](#footnote26)]</sup> her indeed I will send, with my own ship, and with my own friends; but I myself, going to thy tent, will lead away the fair-cheeked daughter of Brises,<sup>[[27](#footnote27)]</sup> thy prize; that thou mayest well know how much more powerful I am than thou, and that another may dread to pronounce himself equal to me, and to liken himself openly [to me].”`\n)}\n\nfunction _paragraph6(md){return(\nmd`Thus he spoke, and grief arose to the son of Peleus, and the heart within, in his hairy breast, was pondering upon two courses; whether, drawing his sharp sword from his thigh, he should dismiss them,<sup>[[28](#footnote28)]</sup> and should kill the son of Atreus, or should put a stop to his wrath, and restrain his passion. While he was thus pondering in his heart and soul, and was drawing his mighty sword from the scabbard, came Minerva from heaven; for her the white-armed goddess Juno had sent forward, equally loving and regarding both from her soul. And she stood behind, and caught the son of Peleus by his yellow hair, appearing to him alone; but none of the others beheld her. But Achilles was amazed, and turned himself round, and immediately recognized Pallas Minerva; and awe-inspiring her eyes appeared to him. And addressing her, he spoke winged words:\n\n“Why, O offspring of ægis-bearing Jove, hast thou come hither? Is it that thou mayest witness the insolence of Agamemnon, the son of Atreus? But I tell thee, what I think will be accomplished, that he will probably soon lose his life by his haughtiness.”`\n)}\n\nfunction _paragraph7(md){return(\nmd`But him in turn the azure-eyed goddess Minerva addressed: “I came from heaven to assuage thy wrath, if thou wilt obey me; for the white-armed goddess Juno sent me forward, equally loving and regarding both from her soul. But come, cease from strife, nor draw the sword with thine hand. But reproach by words, as the occasion may suggest; for thus I declare, and it shall be accomplished, that thrice as many splendid gifts shall be presented to thee, because of this insolent act; only restrain thyself, and obey us.”\n\nBut her answering,<sup>[[29](#footnote29)]</sup> swift-footed Achilles addressed: “It behoves me to observe the command of you both, O goddess, although much enraged in my soul; for so it is better. Whosoever obeys the gods, to him they hearken propitiously.”`\n)}\n\nfunction _paragraph8(md){return(\nmd`He spoke, and held still his heavy hand upon the silvery hilt, and thrust back the great sword into the scabbard, nor did he disobey the mandate of Minerva; but she had gone to Olympus, to the mansions of ægis-bearing Jove, amongst the other deities. But the son of Peleus again addressed Atrides with injurious [[30](#footnote30)] words, nor as yet ceased from anger:\n\n“Wine-bibber, having the countenance of a dog, but the heart of a stag, never hast thou at any time dared in soul to arm thyself with the people for war, nor to go to ambuscade with the chiefs of the Greeks; for this always appears to thee to be death. Certainly it is much better through the wide army of the Achæans, to take away the rewards of whoever may speak against thee. A people-devouring king [art thou], since thou rulest over fellows of no account; for assuredly, son of Atreus, thou [otherwise] wouldst have insulted now for the last time. But I will tell thee, and I will further swear a great oath: yea, by this sceptre, which will never bear leaves and branches, nor will bud again, after it has once left its trunk on the mountains; for the axe has lopped it all around of its leaves and bark; but now the sons of the Greeks, the judges, they who protect the laws [received] from Jove, bear it in their hands; and this will be a great oath to thee; surely will a longing desire for Achilles come upon all the sons of the Achæans at some future day, and thou, although much grieved, wilt be unable to assist them, when many dying shall fall by the hand of man-slaying Hector. Then enraged, wilt thou inwardly fret thy soul, that thou didst in no way honour the bravest of the Greeks.”`\n)}\n\nfunction _footnotes(md){return(\nmd`---\n\n## Footnotes`\n)}\n\nfunction _footnote19(md){return(\nmd`19. [^](#paragraph1) “In the assembly of the people, as in the courts of justice, the nobles alone speak, advise, and decide, whilst the people merely listen to their ordinances and decisions, in order to regulate their own conduct accordingly; being suffered, indeed, to follow the natural impulse of evincing, to a certain extent, their approbation or disapprobation of their superiors, but without any legal means of giving validity to their opinion.” Müller, Gk. Lit. p. 30.`\n)}\n\nfunction _footnote20(html){return(\nhtml`<ol start=\"20\">\n  <li><a href=\"#paragraph1\">^</a> But we must not join μαντεύεσθαι with κικά.—Nägelsbach.</li>\n</ol>`\n)}\n\nfunction _footnote21(footnote){return(\nfootnote(\"paragraph2\", 21, \"More closely: “took from the cities, when we destroyed them.”\")\n)}\n\nfunction _footnote22(footnote){return(\nfootnote(\"paragraph3\", 22, \"Buttmann would take αὔτως as = frustra.\")\n)}\n\nfunction _footnote23(footnote){return(\nfootnote(\"paragraph3\", 23, \"Tecmessa.\")\n)}\n\nfunction _footnote24(footnote){return(\nfootnote(\"paragraph3\", 24, \"Laodice, daughter of Cyenus.\")\n)}\n\nfunction _footnote25(footnote){return(\nfootnote(\"paragraph4\", 25, \"See my note on Od. i. p. 2, n. 11, ed. Bohn.\")\n)}\n\nfunction _footnote26(footnote){return(\nfootnote(\"paragraph5\", 26, \"Astynome. Cf. Eustath. fol. 58.\")\n)}\n\nfunction _footnote27(footnote){return(\nfootnote(\"paragraph5\", 27, \"Hippodameia.\")\n)}\n\nfunction _footnote28(footnote){return(\nfootnote(\"paragraph6\", 28, \"The princes assembled.\")\n)}\n\nfunction _footnote29(footnote){return(\nfootnote(\"paragraph7\", 29, \"Columna on Ennius, p. 17, ed. Hessel., compares “Ollei respondet Rex Albaï longaï,” and “Ollei respondet suavis sonus Egeriäi,” observing that this formula was probably as common in the heroic annals of Ennius as τὸν δ' ὰπαμειξόμενος is in Homer.\")\n)}\n\nfunction _footnote30(footnote){return(\nfootnote(\"paragraph8\", 30, \"Epimerism. Hom. in Cramer’s Anecdott. vol. i. p. 24. άταρτηρός, η παρά την άτην, ο σημαίνει την βλάξην, άτηρός.—Hesych. βλαξρός, άτηρός.\")\n)}\n\nfunction _23(md){return(\nmd`## Appendix`\n)}\n\nfunction _24(html){return(\nhtml`<style>\n  sup {\n    line-height: 0;\n  }\n</style>`\n)}\n\nfunction _footnote(html){return(\n(referencingCellName, number, text) => {\n  return html`<ol start=\\\"${number}\"><li><a href=\"#${referencingCellName}\">^</a> ${text}</li></ol>`;\n}\n)}\n\nexport default function define(runtime, observer) {\n  const main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  main.variable(observer(\"paragraph1\")).define(\"paragraph1\", [\"md\"], _paragraph1);\n  main.variable(observer(\"paragraph2\")).define(\"paragraph2\", [\"md\"], _paragraph2);\n  main.variable(observer(\"paragraph3\")).define(\"paragraph3\", [\"md\"], _paragraph3);\n  main.variable(observer(\"paragraph4\")).define(\"paragraph4\", [\"md\"], _paragraph4);\n  main.variable(observer(\"paragraph5\")).define(\"paragraph5\", [\"md\"], _paragraph5);\n  main.variable(observer(\"paragraph6\")).define(\"paragraph6\", [\"md\"], _paragraph6);\n  main.variable(observer(\"paragraph7\")).define(\"paragraph7\", [\"md\"], _paragraph7);\n  main.variable(observer(\"paragraph8\")).define(\"paragraph8\", [\"md\"], _paragraph8);\n  main.variable(observer(\"footnotes\")).define(\"footnotes\", [\"md\"], _footnotes);\n  main.variable(observer(\"footnote19\")).define(\"footnote19\", [\"md\"], _footnote19);\n  main.variable(observer(\"footnote20\")).define(\"footnote20\", [\"html\"], _footnote20);\n  main.variable(observer(\"footnote21\")).define(\"footnote21\", [\"footnote\"], _footnote21);\n  main.variable(observer(\"footnote22\")).define(\"footnote22\", [\"footnote\"], _footnote22);\n  main.variable(observer(\"footnote23\")).define(\"footnote23\", [\"footnote\"], _footnote23);\n  main.variable(observer(\"footnote24\")).define(\"footnote24\", [\"footnote\"], _footnote24);\n  main.variable(observer(\"footnote25\")).define(\"footnote25\", [\"footnote\"], _footnote25);\n  main.variable(observer(\"footnote26\")).define(\"footnote26\", [\"footnote\"], _footnote26);\n  main.variable(observer(\"footnote27\")).define(\"footnote27\", [\"footnote\"], _footnote27);\n  main.variable(observer(\"footnote28\")).define(\"footnote28\", [\"footnote\"], _footnote28);\n  main.variable(observer(\"footnote29\")).define(\"footnote29\", [\"footnote\"], _footnote29);\n  main.variable(observer(\"footnote30\")).define(\"footnote30\", [\"footnote\"], _footnote30);\n  main.variable(observer()).define([\"md\"], _23);\n  main.variable(observer()).define([\"html\"], _24);\n  main.variable(observer(\"footnote\")).define(\"footnote\", [\"html\"], _footnote);\n  return main;\n}\n"
    },
    {
      "filename": "cloned/d3/tangled-tree-visualization-ii/README.md",
      "content": "# Tangled tree visualization\n\nhttps://observablehq.com/@nitaku/tangled-tree-visualization-ii@670\n\nView this notebook in your browser by running a web server in this folder. For\nexample:\n\n~~~sh\nnpx http-server\n~~~\n\nOr, use the [Observable Runtime](https://github.com/observablehq/runtime) to\nimport this module directly into your application. To npm install:\n\n~~~sh\nnpm install @observablehq/runtime@5\nnpm install https://api.observablehq.com/@nitaku/tangled-tree-visualization-ii@670.tgz?v=3\n~~~\n\nThen, import your notebook and the runtime as:\n\n~~~js\nimport {Runtime, Inspector} from \"@observablehq/runtime\";\nimport define from \"@nitaku/tangled-tree-visualization-ii\";\n~~~\n\nTo log the value of the cell named “foo”:\n\n~~~js\nconst runtime = new Runtime();\nconst main = runtime.module(define);\nmain.value(\"foo\").then(value => console.log(value));\n~~~\n"
    },
    {
      "filename": "cloned/d3/tangled-tree-visualization-ii/index.html",
      "content": "<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<title>Tangled tree visualization</title>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"./inspector.css\">\n<body>\n<script type=\"module\">\n\nimport define from \"./index.js\";\nimport {Runtime, Library, Inspector} from \"./runtime.js\";\n\nconst runtime = new Runtime();\nconst main = runtime.module(define, Inspector.into(document.body));\n\n</script>\n"
    },
    {
      "filename": "cloned/d3/tangled-tree-visualization-ii/index.js",
      "content": "export {default} from \"./4cab522856cbfdde@670.js\";\n"
    },
    {
      "filename": "cloned/d3/tangled-tree-visualization-ii/runtime.js",
      "content": "// @observablehq/runtime v5.9.9 Copyright 2024 Observable, Inc.\nfunction e(e,t,n){n=n||{};var r=e.ownerDocument,a=r.defaultView.CustomEvent;\"function\"==typeof a?a=new a(t,{detail:n}):((a=r.createEvent(\"Event\")).initEvent(t,!1,!1),a.detail=n),e.dispatchEvent(a)}function t(e){return Array.isArray(e)||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function n(e){return e===(0|e)+\"\"}function r(e){const t=document.createElement(\"span\");return t.className=\"observablehq--cellname\",t.textContent=`${e} = `,t}const a=Symbol.prototype.toString;function o(e){return a.call(e)}const{getOwnPropertySymbols:i,prototype:{hasOwnProperty:s}}=Object,{toStringTag:c}=Symbol,l={},u=i;function f(e,t){return s.call(e,t)}function d(e){return e[c]||e.constructor&&e.constructor.name||\"Object\"}function p(e,t){try{const n=e[t];return n&&n.constructor,n}catch(e){return l}}const m=[{symbol:\"@@__IMMUTABLE_INDEXED__@@\",name:\"Indexed\",modifier:!0},{symbol:\"@@__IMMUTABLE_KEYED__@@\",name:\"Keyed\",modifier:!0},{symbol:\"@@__IMMUTABLE_LIST__@@\",name:\"List\",arrayish:!0},{symbol:\"@@__IMMUTABLE_MAP__@@\",name:\"Map\"},{symbol:\"@@__IMMUTABLE_ORDERED__@@\",name:\"Ordered\",modifier:!0,prefix:!0},{symbol:\"@@__IMMUTABLE_RECORD__@@\",name:\"Record\"},{symbol:\"@@__IMMUTABLE_SET__@@\",name:\"Set\",arrayish:!0,setish:!0},{symbol:\"@@__IMMUTABLE_STACK__@@\",name:\"Stack\",arrayish:!0}];function h(e){try{let t=m.filter((({symbol:t})=>!0===e[t]));if(!t.length)return;const n=t.find((e=>!e.modifier)),r=\"Map\"===n.name&&t.find((e=>e.modifier&&e.prefix)),a=t.some((e=>e.arrayish)),o=t.some((e=>e.setish));return{name:`${r?r.name:\"\"}${n.name}`,symbols:t,arrayish:a&&!o,setish:o}}catch(e){return null}}const{getPrototypeOf:b,getOwnPropertyDescriptors:w}=Object,v=b({});function y(n,a,o,i){let s,c,l,u,f=t(n);n instanceof Map?n instanceof n.constructor?(s=`Map(${n.size})`,c=_):(s=\"Map()\",c=T):n instanceof Set?n instanceof n.constructor?(s=`Set(${n.size})`,c=g):(s=\"Set()\",c=T):f?(s=`${n.constructor.name}(${n.length})`,c=C):(u=h(n))?(s=`Immutable.${u.name}${\"Record\"===u.name?\"\":`(${n.size})`}`,f=u.arrayish,c=u.arrayish?N:u.setish?E:A):i?(s=d(n),c=x):(s=d(n),c=T);const p=document.createElement(\"span\");p.className=\"observablehq--expanded\",o&&p.appendChild(r(o));const m=p.appendChild(document.createElement(\"a\"));m.innerHTML=\"<svg width=8 height=8 class='observablehq--caret'>\\n    <path d='M4 7L0 1h8z' fill='currentColor' />\\n  </svg>\",m.appendChild(document.createTextNode(`${s}${f?\" [\":\" {\"}`)),m.addEventListener(\"mouseup\",(function(e){e.stopPropagation(),ie(p,L(n,null,o,i))})),c=c(n);for(let e=0;!(l=c.next()).done&&e<20;++e)p.appendChild(l.value);if(!l.done){const t=p.appendChild(document.createElement(\"a\"));t.className=\"observablehq--field\",t.style.display=\"block\",t.appendChild(document.createTextNode(\"  … more\")),t.addEventListener(\"mouseup\",(function(t){t.stopPropagation(),p.insertBefore(l.value,p.lastChild.previousSibling);for(let e=0;!(l=c.next()).done&&e<19;++e)p.insertBefore(l.value,p.lastChild.previousSibling);l.done&&p.removeChild(p.lastChild.previousSibling),e(p,\"load\")}))}return p.appendChild(document.createTextNode(f?\"]\":\"}\")),p}function*_(e){for(const[t,n]of e)yield S(t,n);yield*T(e)}function*g(e){for(const t of e)yield q(t);yield*T(e)}function*E(e){for(const t of e)yield q(t)}function*C(e){for(let t=0,n=e.length;t<n;++t)t in e&&(yield $(t,p(e,t),\"observablehq--index\"));for(const t in e)!n(t)&&f(e,t)&&(yield $(t,p(e,t),\"observablehq--key\"));for(const t of u(e))yield $(o(t),p(e,t),\"observablehq--symbol\")}function*N(e){let t=0;for(const n=e.size;t<n;++t)yield $(t,e.get(t),!0)}function*x(e){for(const t in w(e))yield $(t,p(e,t),\"observablehq--key\");for(const t of u(e))yield $(o(t),p(e,t),\"observablehq--symbol\");const t=b(e);t&&t!==v&&(yield j(t))}function*T(e){for(const t in e)f(e,t)&&(yield $(t,p(e,t),\"observablehq--key\"));for(const t of u(e))yield $(o(t),p(e,t),\"observablehq--symbol\");const t=b(e);t&&t!==v&&(yield j(t))}function*A(e){for(const[t,n]of e)yield $(t,n,\"observablehq--key\")}function j(e){const t=document.createElement(\"div\"),n=t.appendChild(document.createElement(\"span\"));return t.className=\"observablehq--field\",n.className=\"observablehq--prototype-key\",n.textContent=\"  <prototype>\",t.appendChild(document.createTextNode(\": \")),t.appendChild(oe(e,void 0,void 0,void 0,!0)),t}function $(e,t,n){const r=document.createElement(\"div\"),a=r.appendChild(document.createElement(\"span\"));return r.className=\"observablehq--field\",a.className=n,a.textContent=`  ${e}`,r.appendChild(document.createTextNode(\": \")),r.appendChild(oe(t)),r}function S(e,t){const n=document.createElement(\"div\");return n.className=\"observablehq--field\",n.appendChild(document.createTextNode(\"  \")),n.appendChild(oe(e)),n.appendChild(document.createTextNode(\" => \")),n.appendChild(oe(t)),n}function q(e){const t=document.createElement(\"div\");return t.className=\"observablehq--field\",t.appendChild(document.createTextNode(\"  \")),t.appendChild(oe(e)),t}function O(e){const t=window.getSelection();return\"Range\"===t.type&&(t.containsNode(e,!0)||t.anchorNode.isSelfOrDescendant(e)||t.focusNode.isSelfOrDescendant(e))}function L(e,n,a,o){let i,s,c,l,u=t(e);if(e instanceof Map?e instanceof e.constructor?(i=`Map(${e.size})`,s=k):(i=\"Map()\",s=U):e instanceof Set?e instanceof e.constructor?(i=`Set(${e.size})`,s=M):(i=\"Set()\",s=U):u?(i=`${e.constructor.name}(${e.length})`,s=R):(l=h(e))?(i=`Immutable.${l.name}${\"Record\"===l.name?\"\":`(${e.size})`}`,u=l.arrayish,s=l.arrayish?P:l.setish?I:D):(i=d(e),s=U),n){const t=document.createElement(\"span\");return t.className=\"observablehq--shallow\",a&&t.appendChild(r(a)),t.appendChild(document.createTextNode(i)),t.addEventListener(\"mouseup\",(function(n){O(t)||(n.stopPropagation(),ie(t,L(e)))})),t}const f=document.createElement(\"span\");f.className=\"observablehq--collapsed\",a&&f.appendChild(r(a));const p=f.appendChild(document.createElement(\"a\"));p.innerHTML=\"<svg width=8 height=8 class='observablehq--caret'>\\n    <path d='M7 4L1 8V0z' fill='currentColor' />\\n  </svg>\",p.appendChild(document.createTextNode(`${i}${u?\" [\":\" {\"}`)),f.addEventListener(\"mouseup\",(function(t){O(f)||(t.stopPropagation(),ie(f,y(e,0,a,o)))}),!0),s=s(e);for(let e=0;!(c=s.next()).done&&e<20;++e)e>0&&f.appendChild(document.createTextNode(\", \")),f.appendChild(c.value);return c.done||f.appendChild(document.createTextNode(\", …\")),f.appendChild(document.createTextNode(u?\"]\":\"}\")),f}function*k(e){for(const[t,n]of e)yield z(t,n);yield*U(e)}function*M(e){for(const t of e)yield oe(t,!0);yield*U(e)}function*I(e){for(const t of e)yield oe(t,!0)}function*P(e){let t=-1,n=0;for(const r=e.size;n<r;++n)n>t+1&&(yield F(n-t-1)),yield oe(e.get(n),!0),t=n;n>t+1&&(yield F(n-t-1))}function*R(e){let t=-1,r=0;for(const n=e.length;r<n;++r)r in e&&(r>t+1&&(yield F(r-t-1)),yield oe(p(e,r),!0),t=r);r>t+1&&(yield F(r-t-1));for(const t in e)!n(t)&&f(e,t)&&(yield B(t,p(e,t),\"observablehq--key\"));for(const t of u(e))yield B(o(t),p(e,t),\"observablehq--symbol\")}function*U(e){for(const t in e)f(e,t)&&(yield B(t,p(e,t),\"observablehq--key\"));for(const t of u(e))yield B(o(t),p(e,t),\"observablehq--symbol\")}function*D(e){for(const[t,n]of e)yield B(t,n,\"observablehq--key\")}function F(e){const t=document.createElement(\"span\");return t.className=\"observablehq--empty\",t.textContent=1===e?\"empty\":`empty × ${e}`,t}function B(e,t,n){const r=document.createDocumentFragment(),a=r.appendChild(document.createElement(\"span\"));return a.className=n,a.textContent=e,r.appendChild(document.createTextNode(\": \")),r.appendChild(oe(t,!0)),r}function z(e,t){const n=document.createDocumentFragment();return n.appendChild(oe(e,!0)),n.appendChild(document.createTextNode(\" => \")),n.appendChild(oe(t,!0)),n}function W(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return\"function\"==typeof t?t(e):t;const n=e.getUTCHours(),r=e.getUTCMinutes(),a=e.getUTCSeconds(),o=e.getUTCMilliseconds();return`${i=e.getUTCFullYear(),i<0?`-${H(-i,6)}`:i>9999?`+${H(i,6)}`:H(i,4)}-${H(e.getUTCMonth()+1,2)}-${H(e.getUTCDate(),2)}${n||r||a||o?`T${H(n,2)}:${H(r,2)}${a||o?`:${H(a,2)}${o?`.${H(o,3)}`:\"\"}`:\"\"}Z`:\"\"}`;var i}function H(e,t){return`${e}`.padStart(t,\"0\")}var V=Error.prototype.toString;var G=RegExp.prototype.toString;function Y(e){return e.replace(/[\\\\`\\x00-\\x09\\x0b-\\x19]|\\${/g,Z)}function Z(e){var t=e.charCodeAt(0);switch(t){case 8:return\"\\\\b\";case 9:return\"\\\\t\";case 11:return\"\\\\v\";case 12:return\"\\\\f\";case 13:return\"\\\\r\"}return t<16?\"\\\\x0\"+t.toString(16):t<32?\"\\\\x\"+t.toString(16):\"\\\\\"+e}function J(e,t){for(var n=0;t.exec(e);)++n;return n}var K=Function.prototype.toString,X={prefix:\"async ƒ\"},Q={prefix:\"async ƒ*\"},ee={prefix:\"class\"},te={prefix:\"ƒ\"},ne={prefix:\"ƒ*\"};function re(e,t,n){var a=document.createElement(\"span\");a.className=\"observablehq--function\",n&&a.appendChild(r(n));var o=a.appendChild(document.createElement(\"span\"));return o.className=\"observablehq--keyword\",o.textContent=e.prefix,a.appendChild(document.createTextNode(t)),a}const{prototype:{toString:ae}}=Object;function oe(e,t,n,a,i){let s=typeof e;switch(s){case\"boolean\":case\"undefined\":e+=\"\";break;case\"number\":e=0===e&&1/e<0?\"-0\":e+\"\";break;case\"bigint\":e+=\"n\";break;case\"symbol\":e=o(e);break;case\"function\":return function(e,t){var n,r,a=K.call(e);switch(e.constructor&&e.constructor.name){case\"AsyncFunction\":n=X;break;case\"AsyncGeneratorFunction\":n=Q;break;case\"GeneratorFunction\":n=ne;break;default:n=/^class\\b/.test(a)?ee:te}return n===ee?re(n,\"\",t):(r=/^(?:async\\s*)?(\\w+)\\s*=>/.exec(a))?re(n,\"(\"+r[1]+\")\",t):(r=/^(?:async\\s*)?\\(\\s*(\\w+(?:\\s*,\\s*\\w+)*)?\\s*\\)/.exec(a))||(r=/^(?:async\\s*)?function(?:\\s*\\*)?(?:\\s*\\w+)?\\s*\\(\\s*(\\w+(?:\\s*,\\s*\\w+)*)?\\s*\\)/.exec(a))?re(n,r[1]?\"(\"+r[1].replace(/\\s*,\\s*/g,\", \")+\")\":\"()\",t):re(n,\"(…)\",t)}(e,a);case\"string\":return function(e,t,n,a){if(!1===t){if(J(e,/[\"\\n]/g)<=J(e,/`|\\${/g)){const t=document.createElement(\"span\");a&&t.appendChild(r(a));const n=t.appendChild(document.createElement(\"span\"));return n.className=\"observablehq--string\",n.textContent=JSON.stringify(e),t}const o=e.split(\"\\n\");if(o.length>20&&!n){const n=document.createElement(\"div\");a&&n.appendChild(r(a));const i=n.appendChild(document.createElement(\"span\"));i.className=\"observablehq--string\",i.textContent=\"`\"+Y(o.slice(0,20).join(\"\\n\"));const s=n.appendChild(document.createElement(\"span\")),c=o.length-20;return s.textContent=`Show ${c} truncated line${c>1?\"s\":\"\"}`,s.className=\"observablehq--string-expand\",s.addEventListener(\"mouseup\",(function(r){r.stopPropagation(),ie(n,oe(e,t,!0,a))})),n}const i=document.createElement(\"span\");a&&i.appendChild(r(a));const s=i.appendChild(document.createElement(\"span\"));return s.className=\"observablehq--string\"+(n?\" observablehq--expanded\":\"\"),s.textContent=\"`\"+Y(e)+\"`\",i}const o=document.createElement(\"span\");a&&o.appendChild(r(a));const i=o.appendChild(document.createElement(\"span\"));return i.className=\"observablehq--string\",i.textContent=JSON.stringify(e.length>100?`${e.slice(0,50)}…${e.slice(-49)}`:e),o}(e,t,n,a);default:if(null===e){s=null,e=\"null\";break}if(e instanceof Date){s=\"date\",e=W(e,\"Invalid Date\");break}if(e===l){s=\"forbidden\",e=\"[forbidden]\";break}switch(ae.call(e)){case\"[object RegExp]\":s=\"regexp\",e=function(e){return G.call(e)}(e);break;case\"[object Error]\":case\"[object DOMException]\":s=\"error\",e=function(e){return e.stack||V.call(e)}(e);break;default:return(n?y:L)(e,t,a,i)}}const c=document.createElement(\"span\");a&&c.appendChild(r(a));const u=c.appendChild(document.createElement(\"span\"));return u.className=`observablehq--${s}`,u.textContent=e,c}function ie(t,n){t.classList.contains(\"observablehq--inspect\")&&n.classList.add(\"observablehq--inspect\"),t.parentNode.replaceChild(n,t),e(n,\"load\")}const se=/\\s+\\(\\d+:\\d+\\)$/m;class Inspector{constructor(e){if(!e)throw new Error(\"invalid node\");this._node=e,e.classList.add(\"observablehq\")}pending(){const{_node:e}=this;e.classList.remove(\"observablehq--error\"),e.classList.add(\"observablehq--running\")}fulfilled(t,n){const{_node:r}=this;if((!function(e){return(e instanceof Element||e instanceof Text)&&e instanceof e.constructor}(t)||t.parentNode&&t.parentNode!==r)&&(t=oe(t,!1,r.firstChild&&r.firstChild.classList&&r.firstChild.classList.contains(\"observablehq--expanded\"),n)).classList.add(\"observablehq--inspect\"),r.classList.remove(\"observablehq--running\",\"observablehq--error\"),r.firstChild!==t)if(r.firstChild){for(;r.lastChild!==r.firstChild;)r.removeChild(r.lastChild);r.replaceChild(t,r.firstChild)}else r.appendChild(t);e(r,\"update\")}rejected(t,n){const{_node:a}=this;for(a.classList.remove(\"observablehq--running\"),a.classList.add(\"observablehq--error\");a.lastChild;)a.removeChild(a.lastChild);var o=document.createElement(\"div\");o.className=\"observablehq--inspect\",n&&o.appendChild(r(n)),o.appendChild(document.createTextNode((t+\"\").replace(se,\"\"))),a.appendChild(o),e(a,\"error\",{error:t})}}Inspector.into=function(e){if(\"string\"==typeof e&&null==(e=document.querySelector(e)))throw new Error(\"container not found\");return function(){return new Inspector(e.appendChild(document.createElement(\"div\")))}};var ce={},le={};function ue(e){return new Function(\"d\",\"return {\"+e.map((function(e,t){return JSON.stringify(e)+\": d[\"+t+'] || \"\"'})).join(\",\")+\"}\")}function fe(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function de(e,t){var n=e+\"\",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function pe(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),a=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?\"Invalid Date\":((t=e.getUTCFullYear())<0?\"-\"+de(-t,6):t>9999?\"+\"+de(t,6):de(t,4))+\"-\"+de(e.getUTCMonth()+1,2)+\"-\"+de(e.getUTCDate(),2)+(o?\"T\"+de(n,2)+\":\"+de(r,2)+\":\"+de(a,2)+\".\"+de(o,3)+\"Z\":a?\"T\"+de(n,2)+\":\"+de(r,2)+\":\"+de(a,2)+\"Z\":r||n?\"T\"+de(n,2)+\":\"+de(r,2)+\"Z\":\"\")}function me(e){var t=new RegExp('[\"'+e+\"\\n\\r]\"),n=e.charCodeAt(0);function r(e,t){var r,a=[],o=e.length,i=0,s=0,c=o<=0,l=!1;function u(){if(c)return le;if(l)return l=!1,ce;var t,r,a=i;if(34===e.charCodeAt(a)){for(;i++<o&&34!==e.charCodeAt(i)||34===e.charCodeAt(++i););return(t=i)>=o?c=!0:10===(r=e.charCodeAt(i++))?l=!0:13===r&&(l=!0,10===e.charCodeAt(i)&&++i),e.slice(a+1,t-1).replace(/\"\"/g,'\"')}for(;i<o;){if(10===(r=e.charCodeAt(t=i++)))l=!0;else if(13===r)l=!0,10===e.charCodeAt(i)&&++i;else if(r!==n)continue;return e.slice(a,t)}return c=!0,e.slice(a,o)}for(10===e.charCodeAt(o-1)&&--o,13===e.charCodeAt(o-1)&&--o;(r=u())!==le;){for(var f=[];r!==ce&&r!==le;)f.push(r),r=u();t&&null==(f=t(f,s++))||a.push(f)}return a}function a(t,n){return t.map((function(t){return n.map((function(e){return i(t[e])})).join(e)}))}function o(t){return t.map(i).join(e)}function i(e){return null==e?\"\":e instanceof Date?pe(e):t.test(e+=\"\")?'\"'+e.replace(/\"/g,'\"\"')+'\"':e}return{parse:function(e,t){var n,a,o=r(e,(function(e,r){if(n)return n(e,r-1);a=e,n=t?function(e,t){var n=ue(e);return function(r,a){return t(n(r),a,e)}}(e,t):ue(e)}));return o.columns=a||[],o},parseRows:r,format:function(t,n){return null==n&&(n=fe(t)),[n.map(i).join(e)].concat(a(t,n)).join(\"\\n\")},formatBody:function(e,t){return null==t&&(t=fe(e)),a(e,t).join(\"\\n\")},formatRows:function(e){return e.map(o).join(\"\\n\")},formatRow:o,formatValue:i}}var he=me(\",\"),be=he.parse,we=he.parseRows,ve=me(\"\\t\"),ye=ve.parse,_e=ve.parseRows;function ge(e){for(var t in e){var n,r,a=e[t].trim();if(a)if(\"true\"===a)a=!0;else if(\"false\"===a)a=!1;else if(\"NaN\"===a)a=NaN;else if(isNaN(n=+a)){if(!(r=a.match(/^([-+]\\d{2})?\\d{4}(-\\d{2}(-\\d{2})?)?(T\\d{2}:\\d{2}(:\\d{2}(\\.\\d{3})?)?(Z|[-+]\\d{2}:\\d{2})?)?$/)))continue;Ee&&r[4]&&!r[7]&&(a=a.replace(/-/g,\"/\").replace(/T/,\" \")),a=new Date(a)}else a=n;else a=null;e[t]=a}return e}const Ee=new Date(\"2019-01-01T00:00\").getHours()||new Date(\"2019-07-01T00:00\").getHours();function Ce(e,t,n){return{resolve:(r=n)=>`${e}@${t}/${r}`}}const Ne=Ce(\"d3\",\"7.9.0\",\"dist/d3.min.js\"),xe=Ce(\"@observablehq/inputs\",\"0.11.0\",\"dist/inputs.min.js\"),Te=Ce(\"@observablehq/plot\",\"0.6.16\",\"dist/plot.umd.min.js\"),Ae=Ce(\"@observablehq/graphviz\",\"0.2.1\",\"dist/graphviz.min.js\"),je=Ce(\"@observablehq/highlight.js\",\"2.0.0\",\"highlight.min.js\"),$e=Ce(\"@observablehq/katex\",\"0.11.1\",\"dist/katex.min.js\"),Se=Ce(\"lodash\",\"4.17.21\",\"lodash.min.js\"),qe=Ce(\"htl\",\"0.3.1\",\"dist/htl.min.js\"),Oe=Ce(\"jszip\",\"3.10.1\",\"dist/jszip.min.js\"),Le=Ce(\"marked\",\"0.3.12\",\"marked.min.js\"),ke=Ce(\"sql.js\",\"1.8.0\",\"dist/sql-wasm.js\"),Me=Ce(\"vega\",\"5.22.1\",\"build/vega.min.js\"),Ie=Ce(\"vega-lite\",\"5.6.0\",\"build/vega-lite.min.js\"),Pe=Ce(\"vega-lite-api\",\"5.0.0\",\"build/vega-lite-api.min.js\"),Re=Ce(\"apache-arrow\",\"4.0.1\",\"Arrow.es2015.min.js\"),Ue=Ce(\"apache-arrow\",\"9.0.0\",\"+esm\"),De=Ce(\"apache-arrow\",\"11.0.0\",\"+esm\"),Fe=Ce(\"arquero\",\"4.8.8\",\"dist/arquero.min.js\"),Be=Ce(\"topojson-client\",\"3.1.0\",\"dist/topojson-client.min.js\"),ze=Ce(\"exceljs\",\"4.3.0\",\"dist/exceljs.min.js\"),We=Ce(\"mermaid\",\"9.2.2\",\"dist/mermaid.min.js\"),He=Ce(\"leaflet\",\"1.9.3\",\"dist/leaflet.js\"),Ve=Ce(\"@duckdb/duckdb-wasm\",\"1.24.0\",\"+esm\"),Ge=new Map,Ye=[],Ze=Ye.map,Je=Ye.some,Ke=Ye.hasOwnProperty,Xe=/^((?:@[^/@]+\\/)?[^/@]+)(?:@([^/]+))?(?:\\/(.*))?$/,Qe=/^\\d+\\.\\d+\\.\\d+(-[\\w-.+]+)?$/,et=/(?:\\.[^/]*|\\/)$/;class RequireError extends Error{constructor(e){super(e)}}function tt(e){const t=Xe.exec(e);return t&&{name:t[1],version:t[2],path:t[3]}}function nt(e=\"https://cdn.jsdelivr.net/npm/\",t=[\"unpkg\",\"jsdelivr\",\"browser\",\"main\"]){if(!/\\/$/.test(e))throw new Error(\"origin lacks trailing slash\");function n(t){const n=`${e}${t.name}${t.version?`@${t.version}`:\"\"}/package.json`;let r=Ge.get(n);return r||Ge.set(n,r=fetch(n).then((e=>{if(!e.ok)throw new RequireError(\"unable to load package.json\");return e.redirected&&!Ge.has(e.url)&&Ge.set(e.url,r),e.json()}))),r}return async function(r,a){if(r.startsWith(e)&&(r=r.substring(e.length)),/^(\\w+:)|\\/\\//i.test(r))return r;if(/^[.]{0,2}\\//i.test(r))return new URL(r,null==a?location:a).href;if(!r.length||/^[\\s._]/.test(r)||/\\s$/.test(r))throw new RequireError(\"illegal name\");const o=tt(r);if(!o)return`${e}${r}`;if(!o.version&&null!=a&&a.startsWith(e)){const t=await n(tt(a.substring(e.length)));o.version=t.dependencies&&t.dependencies[o.name]||t.peerDependencies&&t.peerDependencies[o.name]}if(o.path&&!et.test(o.path)&&(o.path+=\".js\"),o.path&&o.version&&Qe.test(o.version))return`${e}${o.name}@${o.version}/${o.path}`;const i=await n(o);return`${e}${i.name}@${i.version}/${o.path||function(e){for(const n of t){let t=e[n];if(\"string\"==typeof t)return t.startsWith(\"./\")&&(t=t.slice(2)),et.test(t)?t:`${t}.js`}}(i)||\"index.js\"}`}}RequireError.prototype.name=RequireError.name;var rt=at(nt());function at(e){const t=new Map,n=a(null);function r(e){if(\"string\"!=typeof e)return e;let n=t.get(e);return n||t.set(e,n=new Promise(((t,n)=>{const r=document.createElement(\"script\");r.onload=()=>{try{t(Ye.pop()(a(e)))}catch(e){n(new RequireError(\"invalid module\"))}r.remove()},r.onerror=()=>{n(new RequireError(\"unable to load module\")),r.remove()},r.async=!0,r.src=e,window.define=ct,document.head.appendChild(r)}))),n}function a(t){return n=>Promise.resolve(e(n,t)).then(r)}function o(e){return arguments.length>1?Promise.all(Ze.call(arguments,n)).then(ot):n(e)}return o.alias=function(t){return at(((n,r)=>n in t&&(r=null,\"string\"!=typeof(n=t[n]))?n:e(n,r)))},o.resolve=e,o}function ot(e){const t={};for(const n of e)for(const e in n)Ke.call(n,e)&&(null==n[e]?Object.defineProperty(t,e,{get:it(n,e)}):t[e]=n[e]);return t}function it(e,t){return()=>e[t]}function st(e){return\"exports\"===(e+=\"\")||\"module\"===e}function ct(e,t,n){const r=arguments.length;r<2?(n=e,t=[]):r<3&&(n=t,t=\"string\"==typeof e?[]:e),Ye.push(Je.call(t,st)?e=>{const r={},a={exports:r};return Promise.all(Ze.call(t,(t=>\"exports\"===(t+=\"\")?r:\"module\"===t?a:e(t)))).then((e=>(n.apply(null,e),a.exports)))}:e=>Promise.all(Ze.call(t,e)).then((e=>\"function\"==typeof n?n.apply(null,e):n)))}ct.amd={};const lt=\"https://cdn.observableusercontent.com/npm/\";let ut,ft=rt;async function dt(e){const[t,n]=await Promise.all([e(ke.resolve()),e.resolve(ke.resolve(\"dist/\"))]);return t({locateFile:e=>`${n}${e}`})}class SQLiteDatabaseClient{constructor(e){Object.defineProperties(this,{_db:{value:e}})}static async open(e){const[t,n]=await Promise.all([dt(ft),Promise.resolve(e).then(mt)]);return new SQLiteDatabaseClient(new t.Database(n))}async query(e,t){return await async function(e,t,n){const[r]=await e.exec(t,n);if(!r)return[];const{columns:a,values:o}=r,i=o.map((e=>Object.fromEntries(e.map(((e,t)=>[a[t],e])))));return i.columns=a,i}(this._db,e,t)}async queryRow(e,t){return(await this.query(e,t))[0]||null}async explain(e,t){return ht(\"pre\",{className:\"observablehq--inspect\"},[bt((await this.query(`EXPLAIN QUERY PLAN ${e}`,t)).map((e=>e.detail)).join(\"\\n\"))])}async describeTables({schema:e}={}){return this.query(`SELECT NULLIF(schema, 'main') AS schema, name FROM pragma_table_list() WHERE type = 'table'${null==e?\"\":\" AND schema = ?\"} AND name NOT LIKE 'sqlite_%' ORDER BY schema, name`,null==e?[]:[e])}async describeColumns({schema:e,table:t}={}){if(null==t)throw new Error(\"missing table\");const n=await this.query(`SELECT name, type, \"notnull\" FROM pragma_table_info(?${null==e?\"\":\", ?\"}) ORDER BY cid`,null==e?[t]:[t,e]);if(!n.length)throw new Error(`table not found: ${t}`);return n.map((({name:e,type:t,notnull:n})=>({name:e,type:pt(t),databaseType:t,nullable:!n})))}async describe(e){const t=await(void 0===e?this.query(\"SELECT name FROM sqlite_master WHERE type = 'table'\"):this.query(\"SELECT * FROM pragma_table_info(?)\",[e]));if(!t.length)throw new Error(\"Not found\");const{columns:n}=t;return ht(\"table\",{value:t},[ht(\"thead\",[ht(\"tr\",n.map((e=>ht(\"th\",[bt(e)]))))]),ht(\"tbody\",t.map((e=>ht(\"tr\",n.map((t=>ht(\"td\",[bt(e[t])])))))))])}async sql(){return this.query(...this.queryTag.apply(this,arguments))}queryTag(e,...t){return[e.join(\"?\"),t]}}function pt(e){switch(e){case\"NULL\":return\"null\";case\"INT\":case\"INTEGER\":case\"TINYINT\":case\"SMALLINT\":case\"MEDIUMINT\":case\"BIGINT\":case\"UNSIGNED BIG INT\":case\"INT2\":case\"INT8\":return\"integer\";case\"TEXT\":case\"CLOB\":case\"DATE\":case\"DATETIME\":return\"string\";case\"REAL\":case\"DOUBLE\":case\"DOUBLE PRECISION\":case\"FLOAT\":case\"NUMERIC\":return\"number\";case\"BLOB\":return\"buffer\";default:return/^(?:(?:(?:VARYING|NATIVE) )?CHARACTER|(?:N|VAR|NVAR)CHAR)\\(/.test(e)?\"string\":/^(?:DECIMAL|NUMERIC)\\(/.test(e)?\"number\":\"other\"}}function mt(e){return\"string\"==typeof e?fetch(e).then(mt):e instanceof Response||e instanceof Blob?e.arrayBuffer().then(mt):e instanceof ArrayBuffer?new Uint8Array(e):e}function ht(e,t,n){2===arguments.length&&(n=t,t=void 0);const r=document.createElement(e);if(void 0!==t)for(const e in t)r[e]=t[e];if(void 0!==n)for(const e of n)r.appendChild(e);return r}function bt(e){return document.createTextNode(e)}function wt(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function vt(e,t=wt){let n,r=!1;if(1===t.length){let a;for(const o of e){const e=t(o);(r?wt(e,a)>0:0===wt(e,e))&&(n=o,a=e,r=!0)}}else for(const a of e)(r?t(a,n)>0:0===t(a,a))&&(n=a,r=!0);return n}function yt(e){return e&&\"function\"==typeof e.toArrowBuffer}function _t(e){return e&&\"function\"==typeof e.getChild&&\"function\"==typeof e.toArray&&e.schema&&Array.isArray(e.schema.fields)}function gt(e){return{name:e.name,type:Et(e.type),nullable:e.nullable,databaseType:String(e.type)}}function Et(e){switch(e.typeId){case 2:return\"integer\";case 3:case 7:return\"number\";case 4:case 15:return\"buffer\";case 5:return\"string\";case 6:return\"boolean\";case 8:case 9:case 10:return\"date\";case 12:case 16:return\"array\";case 13:case 14:return\"object\";default:return\"other\"}}async function Ct(){return await import(`${lt}${De.resolve()}`)}Object.defineProperty(SQLiteDatabaseClient.prototype,\"dialect\",{value:\"sqlite\"});class DuckDBClient{constructor(e){Object.defineProperties(this,{_db:{value:e}})}async queryStream(e,t){const n=await this._db.connect();let r,a;try{if(t?.length>0){const a=await n.prepare(e);r=await a.send(...t)}else r=await n.send(e);if(a=await r.next(),a.done)throw new Error(\"missing first batch\")}catch(e){throw await n.close(),e}return{schema:(o=a.value,o.schema.fields.map(gt)),async*readRows(){try{for(;!a.done;)yield a.value.toArray(),a=await r.next()}finally{await n.close()}}};var o}async query(e,t){const n=await this.queryStream(e,t),r=[];for await(const e of n.readRows())for(const t of e)r.push(t);return r.schema=n.schema,r}async queryRow(e,t){const n=(await this.queryStream(e,t)).readRows();try{const{done:e,value:t}=await n.next();return e||!t.length?null:t[0]}finally{await n.return()}}async sql(e,...t){return await this.query(e.join(\"?\"),t)}queryTag(e,...t){return[e.join(\"?\"),t]}escape(e){return`\"${e}\"`}async describeTables(){return(await this.query(\"SHOW TABLES\")).map((({name:e})=>({name:e})))}async describeColumns({table:e}={}){return(await this.query(`DESCRIBE ${this.escape(e)}`)).map((({column_name:e,column_type:t,null:n})=>({name:e,type:At(t),nullable:\"NO\"!==n,databaseType:t})))}static async of(e={},t={}){const n=await async function(){void 0===ut&&(ut=async function(){const e=await import(`${lt}${Ve.resolve()}`),t=await e.selectBundle({mvp:{mainModule:`${lt}${Ve.resolve(\"dist/duckdb-mvp.wasm\")}`,mainWorker:`${lt}${Ve.resolve(\"dist/duckdb-browser-mvp.worker.js\")}`},eh:{mainModule:`${lt}${Ve.resolve(\"dist/duckdb-eh.wasm\")}`,mainWorker:`${lt}${Ve.resolve(\"dist/duckdb-browser-eh.worker.js\")}`}}),n=new e.ConsoleLogger;return{module:e,bundle:t,logger:n}}());const{module:e,bundle:t,logger:n}=await ut,r=await e.createWorker(t.mainWorker),a=new e.AsyncDuckDB(n,r);return await a.instantiate(t.mainModule),a}();return void 0===t.query?.castTimestampToDate&&(t={...t,query:{...t.query,castTimestampToDate:!0}}),void 0===t.query?.castBigIntToDouble&&(t={...t,query:{...t.query,castBigIntToDouble:!0}}),await n.open(t),await Promise.all(Object.entries(e).map((async([e,t])=>{if(t instanceof FileAttachment)await Nt(n,e,t);else if(_t(t))await xt(n,e,t);else if(Array.isArray(t))await Tt(n,e,t);else if(yt(t))await async function(e,t,n){const r=(await Ct()).tableFromIPC(n.toArrowBuffer());return await xt(e,t,r)}(n,e,t);else if(\"data\"in t){const{data:r,...a}=t;_t(r)?await xt(n,e,r,a):await Tt(n,e,r,a)}else{if(!(\"file\"in t))throw new Error(`invalid source: ${t}`);{const{file:r,...a}=t;await Nt(n,e,r,a)}}}))),new DuckDBClient(n)}}async function Nt(e,t,n,r){const a=await n.url();if(a.startsWith(\"blob:\")){const t=await n.arrayBuffer();await e.registerFileBuffer(n.name,new Uint8Array(t))}else await e.registerFileURL(n.name,new URL(a,location).href,4);const o=await e.connect();try{switch(n.mimeType){case\"text/csv\":case\"text/tab-separated-values\":return await o.insertCSVFromPath(n.name,{name:t,schema:\"main\",...r}).catch((async e=>{if(e.toString().includes(\"Could not convert\"))return await async function(e,t,n){const r=await e.prepare(`CREATE TABLE '${n}' AS SELECT * FROM read_csv_auto(?, ALL_VARCHAR=TRUE)`);return await r.send(t.name)}(o,n,t);throw e}));case\"application/json\":return await o.insertJSONFromPath(n.name,{name:t,schema:\"main\",...r});default:if(/\\.arrow$/i.test(n.name)){const e=new Uint8Array(await n.arrayBuffer());return await o.insertArrowFromIPCStream(e,{name:t,schema:\"main\",...r})}if(/\\.parquet$/i.test(n.name))return await o.query(`CREATE VIEW '${t}' AS SELECT * FROM parquet_scan('${n.name}')`);throw new Error(`unknown file type: ${n.mimeType}`)}}finally{await o.close()}}async function xt(e,t,n,r){const a=await e.connect();try{await a.insertArrowTable(n,{name:t,schema:\"main\",...r})}finally{await a.close()}}async function Tt(e,t,n,r){const a=(await Ct()).tableFromJSON(n);return await xt(e,t,a,r)}function At(e){switch(e){case\"BIGINT\":case\"HUGEINT\":case\"UBIGINT\":return\"bigint\";case\"DOUBLE\":case\"REAL\":case\"FLOAT\":return\"number\";case\"INTEGER\":case\"SMALLINT\":case\"TINYINT\":case\"USMALLINT\":case\"UINTEGER\":case\"UTINYINT\":return\"integer\";case\"BOOLEAN\":return\"boolean\";case\"DATE\":case\"TIMESTAMP\":case\"TIMESTAMP WITH TIME ZONE\":return\"date\";case\"VARCHAR\":case\"UUID\":return\"string\";default:return/^DECIMAL\\(/.test(e)?\"integer\":\"other\"}}Object.defineProperty(DuckDBClient.prototype,\"dialect\",{value:\"duckdb\"});function jt(e){return Array.isArray(e)&&($t(e.schema)||St(e.columns)||function(e){const t=Math.min(20,e.length);for(let n=0;n<t;++n){const t=e[n];if(null===t||\"object\"!=typeof t)return!1}return t>0&&function(e){for(const t in e)return!0;return!1}(e[0])}(e)||Lt(e)||kt(e))||Mt(e)}function $t(e){return Array.isArray(e)&&e.every(qt)}function St(e){return Array.isArray(e)&&e.every((e=>\"string\"==typeof e))}function qt(e){return e&&\"string\"==typeof e.name&&\"string\"==typeof e.type}function Ot(e){return Mt(e)||Lt(e)||kt(e)}function Lt(e){const t=Math.min(20,e.length);if(!(t>0))return!1;let n,r=!1;for(let a=0;a<t;++a){const t=e[a];if(null==t)continue;const o=typeof t;if(void 0===n)switch(o){case\"number\":case\"boolean\":case\"string\":case\"bigint\":n=o;break;default:return!1}else if(o!==n)return!1;r=!0}return r}function kt(e){const t=Math.min(20,e.length);if(!(t>0))return!1;let n=!1;for(let r=0;r<t;++r){const t=e[r];if(null!=t){if(!(t instanceof Date))return!1;n=!0}}return n}function Mt(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}const It=Object.assign((async(e,t,n,r)=>{if(e=await Rt(await e,r),(a=e)&&(\"function\"==typeof a.sql||\"function\"==typeof a.queryTag&&(\"function\"==typeof a.query||\"function\"==typeof a.queryStream))&&(\"table\"!==o||\"function\"==typeof a.describeColumns)&&a!==It)return Ft(e,function(e,t){const n=\"function\"==typeof t.escape?t.escape:e=>e,{select:r,from:a,filter:o,sort:i,slice:s}=e;if(!a.table)throw new Error(\"missing from table\");if(r.columns&&0===r.columns.length)throw new Error(\"at least one column must be selected\");const c=new Map(e.names?.map((({column:e,name:t})=>[e,t]))),l=[[`SELECT ${r.columns?r.columns.map((e=>{const t=c.get(e);return t?`${n(e)} AS ${n(t)}`:n(e)})).join(\", \"):\"*\"} FROM ${Bt(a.table,n)}`]];for(let e=0;e<o.length;++e)zt(e?\"\\nAND \":\"\\nWHERE \",l),Ht(o[e],l,n);for(let e=0;e<i.length;++e)zt(e?\", \":\"\\nORDER BY \",l),Wt(i[e],l,n);if(\"mssql\"===t.dialect||\"oracle\"===t.dialect){if(null!==s.to||null!==s.from){if(!i.length){if(!r.columns)throw new Error(\"at least one column must be explicitly specified. Received '*'.\");zt(\"\\nORDER BY \",l),Wt({column:r.columns[0],direction:\"ASC\"},l,n)}zt(`\\nOFFSET ${s.from||0} ROWS`,l),zt(`\\nFETCH NEXT ${null!==s.to?s.to-(s.from||0):1e9} ROWS ONLY`,l)}}else null===s.to&&null===s.from||zt(\"\\nLIMIT \"+(null!==s.to?s.to-(s.from||0):1e9),l),null!==s.from&&zt(` OFFSET ${s.from}`,l);return l}(t,e),n);var a,o;if(jt(e))return function(e,t){const n=new Map,r=e,a=un(e,t);e=a.source;let o=a.schema;if(t.derive){const r=[];t.derive.map((({name:a,value:o})=>{let i=[];fn(e,t).map(((e,t)=>{let n;try{n=o(e)}catch(e){i.push({index:t,error:e}),n=void 0}r[t]?r[t]={...r[t],[a]:n}:r.push({[a]:n})})),i.length&&n.set(a,i)}));const a=un(r,t);e=e.map(((e,t)=>({...e,...a.source[t]}))),o=[...o,...a.schema]}for(const{type:n,operands:r}of t.filter){const[{value:t}]=r,a=r.slice(1).map((({value:e})=>e));switch(n){case\"v\":{const[n]=a,r=sn(n);e=e.filter((e=>r(e[t])));break}case\"nv\":{const[n]=a,r=sn(n);e=e.filter((e=>!r(e[t])));break}case\"eq\":{const[n]=a;if(n instanceof Date){const r=+n;e=e.filter((e=>+e[t]===r))}else e=e.filter((e=>e[t]===n));break}case\"ne\":{const[n]=a;e=e.filter((e=>e[t]!==n));break}case\"c\":{const[n]=a;e=e.filter((e=>\"string\"==typeof e[t]&&e[t].includes(n)));break}case\"nc\":{const[n]=a;e=e.filter((e=>\"string\"==typeof e[t]&&!e[t].includes(n)));break}case\"in\":{const n=new Set(a);e=e.filter((e=>n.has(e[t])));break}case\"nin\":{const n=new Set(a);e=e.filter((e=>!n.has(e[t])));break}case\"n\":e=e.filter((e=>null==e[t]));break;case\"nn\":e=e.filter((e=>null!=e[t]));break;case\"lt\":{const[n]=a;e=e.filter((e=>e[t]<n));break}case\"lte\":{const[n]=a;e=e.filter((e=>e[t]<=n));break}case\"gt\":{const[n]=a;e=e.filter((e=>e[t]>n));break}case\"gte\":{const[n]=a;e=e.filter((e=>e[t]>=n));break}default:throw new Error(`unknown filter type: ${n}`)}}for(const{column:n,direction:a}of function(e){if(\"function\"!=typeof e[Symbol.iterator])throw new TypeError(\"values is not iterable\");return Array.from(e).reverse()}(t.sort)){const t=\"desc\"===a?Zt:Yt;e===r&&(e=e.slice()),e.sort(((e,r)=>t(e[n],r[n])))}let{from:i,to:s}=t.slice;i=null==i?0:Math.max(0,i),s=null==s?1/0:Math.max(0,s),(i>0||s<1/0)&&(e=e.slice(Math.max(0,i),Math.max(0,s)));let c=o.slice();if(t.select.columns){if(o){const e=new Map(o.map((e=>[e.name,e])));o=t.select.columns.map((t=>e.get(t)))}e=e.map((e=>Object.fromEntries(t.select.columns.map((t=>[t,e[t]])))))}if(t.names){const n=new Map(t.names.map((e=>[e.column,e])));o&&(o=o.map((e=>{const t=n.get(e.name);return{...e,...t?{name:t.name}:null}}))),c&&(c=c.map((e=>{const t=n.get(e.name);return{...e,...t?{name:t.name}:null}}))),e=fn(e,t)}e!==r&&o&&(e.schema=o);return e.fullSchema=c,e.errors=n,e}(e,t);if(!e)throw new Error(\"missing data source\");throw new Error(\"invalid data source\")}),{sql:(e,t,n)=>async function(){return Ft(await Ut(await e,n),arguments,t)}});function Pt(e){const t=new WeakMap;return(n,r)=>{if(!n||\"object\"!=typeof n)throw new Error(\"invalid data source\");let a=t.get(n);return(!a||jt(n)&&n.length!==a._numRows)&&(a=e(n,r),a._numRows=n.length,t.set(n,a)),a}}const Rt=Pt((async(e,t)=>{if(e instanceof FileAttachment){switch(e.mimeType){case\"text/csv\":return e.csv();case\"text/tab-separated-values\":return e.tsv();case\"application/json\":return e.json();case\"application/x-sqlite3\":return e.sqlite()}if(/\\.(arrow|parquet)$/i.test(e.name))return Dt(e,t);throw new Error(`unsupported file type: ${e.mimeType}`)}return _t(e)||yt(e)?Dt(e,t):jt(e)&&Ot(e)?Array.from(e,(e=>({value:e}))):e})),Ut=Pt((async(e,t)=>{if(e instanceof FileAttachment){switch(e.mimeType){case\"text/csv\":case\"text/tab-separated-values\":case\"application/json\":return Dt(e,t);case\"application/x-sqlite3\":return e.sqlite()}if(/\\.(arrow|parquet)$/i.test(e.name))return Dt(e,t);throw new Error(`unsupported file type: ${e.mimeType}`)}return jt(e)?Dt(await async function(e,t){const n=await Ct();return Ot(e)?n.tableFromArrays({[t]:e}):n.tableFromJSON(e)}(e,t),t):_t(e)||yt(e)?Dt(e,t):e}));function Dt(e,t=(e instanceof FileAttachment?function(e){return e.name.replace(/@\\d+(?=\\.|$)/,\"\").replace(/\\.\\w+$/,\"\")}(e):\"__table\")){return DuckDBClient.of({[t]:e})}async function Ft(e,t,n){if(!e)throw new Error(\"missing data source\");if(\"function\"==typeof e.queryTag){const r=new AbortController,a={signal:r.signal};if(n.then((()=>r.abort(\"invalidated\"))),\"function\"==typeof e.queryStream)return async function*(e){let t=performance.now();const n=await e,r=[];r.done=!1,r.error=null,r.schema=n.schema;try{for await(const e of n.readRows()){performance.now()-t>150&&r.length>0&&(yield r,t=performance.now());for(const t of e)r.push(t)}r.done=!0,yield r}catch(e){r.error=e,yield r}}(e.queryStream(...e.queryTag.apply(e,t),a));if(\"function\"==typeof e.query)return e.query(...e.queryTag.apply(e,t),a)}if(\"function\"==typeof e.sql)return e.sql.apply(e,t);throw new Error(\"source does not implement query, queryStream, or sql\")}function Bt(e,t){if(\"object\"==typeof e){let n=\"\";return null!=e.database&&(n+=t(e.database)+\".\"),null!=e.schema&&(n+=t(e.schema)+\".\"),n+=t(e.table),n}return t(e)}function zt(e,t){const n=t[0];n[n.length-1]+=e}function Wt({column:e,direction:t},n,r){zt(`${r(e)} ${t.toUpperCase()}`,n)}function Ht({type:e,operands:t},n,r){if(t.length<1)throw new Error(\"Invalid operand length\");if(1===t.length||\"v\"===e||\"nv\"===e)switch(Vt(t[0],n,r),e){case\"n\":case\"nv\":return void zt(\" IS NULL\",n);case\"nn\":case\"v\":return void zt(\" IS NOT NULL\",n);default:throw new Error(\"Invalid filter operation\")}if(2!==t.length||[\"in\",\"nin\"].includes(e)){var a;switch(Vt(t[0],n,r),e){case\"in\":zt(\" IN (\",n);break;case\"nin\":zt(\" NOT IN (\",n);break;default:throw new Error(\"Invalid filter operation\")}!function(e,t){let n=!0;for(const r of e)n?n=!1:zt(\",\",t),t.push(r.value),t[0].push(\"\")}(t.slice(1),n),zt(\")\",n)}else{if([\"c\",\"nc\"].includes(e)){switch(Vt(t[0],n,r),e){case\"c\":zt(\" LIKE \",n);break;case\"nc\":zt(\" NOT LIKE \",n)}return void Vt((a=t[1],{...a,value:`%${a.value}%`}),n,r)}switch(Vt(t[0],n,r),e){case\"eq\":zt(\" = \",n);break;case\"ne\":zt(\" <> \",n);break;case\"gt\":zt(\" > \",n);break;case\"lt\":zt(\" < \",n);break;case\"gte\":zt(\" >= \",n);break;case\"lte\":zt(\" <= \",n);break;default:throw new Error(\"Invalid filter operation\")}Vt(t[1],n,r)}}function Vt(e,t,n){\"column\"===e.type?zt(n(e.value),t):(t.push(e.value),t[0].push(\"\"))}function Gt(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))}function Yt(e,t){return Gt(e,t)||(e<t?-1:e>t?1:0)}function Zt(e,t){return Gt(e,t)||(e>t?-1:e<t?1:0)}const Jt=e=>\"number\"==typeof e&&!Number.isNaN(e),Kt=e=>Number.isInteger(e)&&!Number.isNaN(e),Xt=e=>\"string\"==typeof e,Qt=e=>\"boolean\"==typeof e,en=e=>\"bigint\"==typeof e,tn=e=>e instanceof Date&&!isNaN(e),nn=e=>e instanceof ArrayBuffer,rn=e=>Array.isArray(e),an=e=>\"object\"==typeof e&&null!==e,on=e=>null!=e;function sn(e){switch(e){case\"string\":return Xt;case\"bigint\":return en;case\"boolean\":return Qt;case\"number\":return Jt;case\"integer\":return Kt;case\"date\":return tn;case\"buffer\":return nn;case\"array\":return rn;case\"object\":return an;default:return on}}const cn=/^(([-+]\\d{2})?\\d{4}(-\\d{2}(-\\d{2}))|(\\d{1,2})\\/(\\d{1,2})\\/(\\d{2,4}))([T ]\\d{2}:\\d{2}(:\\d{2}(\\.\\d{3})?)?(Z|[-+]\\d{2}:\\d{2})?)?$/;function ln(e,t){switch(t){case\"string\":return\"string\"==typeof e||null==e?e:String(e);case\"boolean\":if(\"string\"==typeof e){const t=e.trim().toLowerCase();return\"true\"===t||\"false\"!==t&&null}return\"boolean\"==typeof e||null==e?e:Boolean(e);case\"bigint\":return\"bigint\"==typeof e||null==e?e:Number.isInteger(\"string\"!=typeof e||e.trim()?+e:NaN)?BigInt(e):void 0;case\"integer\":case\"number\":return\"number\"==typeof e?e:null==e||\"string\"==typeof e&&!e.trim()?NaN:Number(e);case\"date\":{if(e instanceof Date||null==e)return e;if(\"number\"==typeof e)return new Date(e);const t=String(e).trim();return\"string\"!=typeof e||t?new Date(cn.test(t)?t:NaN):null}case\"array\":case\"object\":case\"buffer\":case\"other\":return e;default:throw new Error(`Unable to coerce to type: ${t}`)}}function un(e,t){const n=e;let{schema:r,inferred:a}=function(e){const{columns:t}=e;let{schema:n}=e;return $t(n)?{schema:n,inferred:!1}:(n=mn(e,St(t)?t:void 0),{schema:n,inferred:!0})}(e);const o=new Map(r.map((({name:e,type:t})=>[e,t])));if(t.types){for(const{name:e,type:a}of t.types){o.set(e,a),r===n.schema&&(r=r.slice());const t=r.findIndex((t=>t.name===e));t>-1&&(r[t]={...r[t],type:a})}e=e.map((e=>dn(e,o,r)))}else a&&(e=e.map((e=>dn(e,o,r))));return{source:e,schema:r}}function fn(e,t){if(!t.names)return e;const n=new Map(t.names.map((e=>[e.column,e])));return e.map((e=>Object.fromEntries(Object.keys(e).map((t=>[n.get(t)?.name??t,e[t]])))))}function dn(e,t,n){const r={};for(const a of n){const n=t.get(a.name),o=e[a.name];r[a.name]=\"raw\"===n?o:ln(o,n)}return r}const pn=[\"boolean\",\"integer\",\"number\",\"date\",\"bigint\",\"array\",\"object\",\"buffer\"];function mn(e,t=function(e){const t=new Set;for(const n of e)if(n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t.add(e);return Array.from(t)}(e)){const n=[],r=e.slice(0,100);for(const e of t){const t={boolean:0,integer:0,number:0,date:0,string:0,array:0,object:0,bigint:0,buffer:0,defined:0};for(const n of r){let r=n[e];if(null==r)continue;const a=typeof r;if(\"string\"!==a)++t.defined,Array.isArray(r)?++t.array:r instanceof Date?++t.date:r instanceof ArrayBuffer?++t.buffer:\"number\"===a?(++t.number,Number.isInteger(r)&&++t.integer):a in t&&++t[a];else{if(r=r.trim(),!r)continue;++t.defined,++t.string,/^(true|false)$/i.test(r)?++t.boolean:r&&!isNaN(r)?(++t.number,Number.isInteger(+r)&&++t.integer):cn.test(r)&&++t.date}}const a=Math.max(1,.9*t.defined),o=vt(pn,(e=>t[e]>=a?t[e]:NaN))??(t.string>=a?\"string\":\"other\");n.push({name:e,type:o,inferred:o})}return n}class Workbook{constructor(e){Object.defineProperties(this,{_:{value:e},sheetNames:{value:e.worksheets.map((e=>e.name)),enumerable:!0}})}sheet(e,t){const n=\"number\"==typeof e?this.sheetNames[e]:this.sheetNames.includes(e+=\"\")?e:null;if(null==n)throw new Error(`Sheet not found: ${e}`);return function(e,{range:t,headers:n}={}){let[[r,a],[o,i]]=function(e=\":\",{columnCount:t,rowCount:n}){if(!(e+=\"\").match(/^[A-Z]*\\d*:[A-Z]*\\d*$/))throw new Error(\"Malformed range specifier\");const[[r=0,a=0],[o=t-1,i=n-1]]=e.split(\":\").map(vn);return[[r,a],[o,i]]}(t,e);const s=n?e._rows[a++]:null;let c=new Set([\"#\"]);for(let e=r;e<=o;e++){const t=s?hn(s.findCell(e+1)):null;let n=t&&t+\"\"||wn(e);for(;c.has(n);)n+=\"_\";c.add(n)}c=new Array(r).concat(Array.from(c));const l=new Array(i-a+1);for(let t=a;t<=i;t++){const n=l[t-a]=Object.create(null,{\"#\":{value:t+1}}),i=e.getRow(t+1);if(i.hasValues)for(let e=r;e<=o;e++){const t=hn(i.findCell(e+1));null!=t&&(n[c[e+1]]=t)}}return l.columns=c.filter((()=>!0)),l}(this._.getWorksheet(n),t)}}function hn(e){if(!e)return;const{value:t}=e;if(t&&\"object\"==typeof t&&!(t instanceof Date)){if(t.formula||t.sharedFormula)return t.result&&t.result.error?NaN:t.result;if(t.richText)return bn(t);if(t.text){let{text:e}=t;return e.richText&&(e=bn(e)),t.hyperlink&&t.hyperlink!==e?`${t.hyperlink} ${e}`:e}return t}return t}function bn(e){return e.richText.map((e=>e.text)).join(\"\")}function wn(e){let t=\"\";e++;do{t=String.fromCharCode(64+(e%26||26))+t}while(e=Math.floor((e-1)/26));return t}function vn(e){const[,t,n]=e.match(/^([A-Z]*)(\\d*)$/);let r=0;if(t)for(let e=0;e<t.length;e++)r+=Math.pow(26,t.length-e-1)*(t.charCodeAt(e)-64);return[r?r-1:void 0,n?+n-1:void 0]}async function yn(e){const t=await fetch(await e.url());if(!t.ok)throw new Error(`Unable to load file: ${e.name}`);return t}async function _n(e,t,{array:n=!1,typed:r=!1}={}){const a=await e.text(),o=\"\\t\"===t?n?_e:ye:n?we:be;if(\"auto\"===r&&!n){const e=o(a);return function(e,t){const n=new Map(t.map((({name:e,type:t})=>[e,t])));return Object.assign(e.map((e=>dn(e,n,t))),{schema:t})}(e,mn(e,e.columns))}return o(a,r&&ge)}class gn{constructor(e,t){Object.defineProperty(this,\"name\",{value:e,enumerable:!0}),void 0!==t&&Object.defineProperty(this,\"mimeType\",{value:t+\"\",enumerable:!0})}async blob(){return(await yn(this)).blob()}async arrayBuffer(){return(await yn(this)).arrayBuffer()}async text(){return(await yn(this)).text()}async json(){return(await yn(this)).json()}async stream(){return(await yn(this)).body}async csv(e){return _n(this,\",\",e)}async tsv(e){return _n(this,\"\\t\",e)}async image(e){const t=await this.url();return new Promise(((n,r)=>{const a=new Image;new URL(t,document.baseURI).origin!==new URL(location).origin&&(a.crossOrigin=\"anonymous\"),Object.assign(a,e),a.onload=()=>n(a),a.onerror=()=>r(new Error(`Unable to load file: ${this.name}`)),a.src=t}))}async arrow({version:e=4}={}){switch(e){case 4:{const[e,t]=await Promise.all([ft(Re.resolve()),yn(this)]);return e.Table.from(t)}case 9:{const[e,t]=await Promise.all([import(`${lt}${Ue.resolve()}`),yn(this)]);return e.tableFromIPC(t)}case 11:{const[e,t]=await Promise.all([import(`${lt}${De.resolve()}`),yn(this)]);return e.tableFromIPC(t)}default:throw new Error(`unsupported arrow version: ${e}`)}}async sqlite(){return SQLiteDatabaseClient.open(yn(this))}async zip(){const[e,t]=await Promise.all([ft(Oe.resolve()),this.arrayBuffer()]);return new ZipArchive(await e.loadAsync(t))}async xml(e=\"application/xml\"){return(new DOMParser).parseFromString(await this.text(),e)}async html(){return this.xml(\"text/html\")}async xlsx(){const[e,t]=await Promise.all([ft(ze.resolve()),this.arrayBuffer()]);return new Workbook(await(new e.Workbook).xlsx.load(t))}}class FileAttachment extends gn{constructor(e,t,n){super(t,n),Object.defineProperty(this,\"_url\",{value:e})}async url(){return await this._url+\"\"}}function En(e){throw new Error(`File not found: ${e}`)}class ZipArchive{constructor(e){Object.defineProperty(this,\"_\",{value:e}),this.filenames=Object.keys(e.files).filter((t=>!e.files[t].dir))}file(e){const t=this._.file(e+=\"\");if(!t||t.dir)throw new Error(`file not found: ${e}`);return new ZipArchiveEntry(t)}}class ZipArchiveEntry extends gn{constructor(e){super(e.name),Object.defineProperty(this,\"_\",{value:e}),Object.defineProperty(this,\"_url\",{writable:!0})}async url(){return this._url||(this._url=this.blob().then(URL.createObjectURL))}async blob(){return this._.async(\"blob\")}async arrayBuffer(){return this._.async(\"arraybuffer\")}async text(){return this._.async(\"text\")}async json(){return JSON.parse(await this.text())}}var Cn={math:\"http://www.w3.org/1998/Math/MathML\",svg:\"http://www.w3.org/2000/svg\",xhtml:\"http://www.w3.org/1999/xhtml\",xlink:\"http://www.w3.org/1999/xlink\",xml:\"http://www.w3.org/XML/1998/namespace\",xmlns:\"http://www.w3.org/2000/xmlns/\"};var Nn=0;function xn(e){return new Tn(\"O-\"+(null==e?\"\":e+\"-\")+ ++Nn)}function Tn(e){this.id=e,this.href=new URL(`#${e}`,location)+\"\"}Tn.prototype.toString=function(){return\"url(\"+this.href+\")\"};var An=Object.freeze({__proto__:null,canvas:function(e,t){var n=document.createElement(\"canvas\");return n.width=e,n.height=t,n},context2d:function(e,t,n){null==n&&(n=devicePixelRatio);var r=document.createElement(\"canvas\");r.width=e*n,r.height=t*n,r.style.width=e+\"px\";var a=r.getContext(\"2d\");return a.scale(n,n),a},download:function(e,t=\"untitled\",n=\"Save\"){const r=document.createElement(\"a\"),a=r.appendChild(document.createElement(\"button\"));async function o(){await new Promise(requestAnimationFrame),URL.revokeObjectURL(r.href),r.removeAttribute(\"href\"),a.textContent=n,a.disabled=!1}return a.textContent=n,r.download=t,r.onclick=async t=>{if(a.disabled=!0,r.href)return o();a.textContent=\"Saving…\";try{const t=await(\"function\"==typeof e?e():e);a.textContent=\"Download\",r.href=URL.createObjectURL(t)}catch(e){a.textContent=n}if(t.eventPhase)return o();a.disabled=!1},r},element:function(e,t){var n,r=e+=\"\",a=r.indexOf(\":\");a>=0&&\"xmlns\"!==(r=e.slice(0,a))&&(e=e.slice(a+1));var o=Cn.hasOwnProperty(r)?document.createElementNS(Cn[r],e):document.createElement(e);if(t)for(var i in t)a=(r=i).indexOf(\":\"),n=t[i],a>=0&&\"xmlns\"!==(r=i.slice(0,a))&&(i=i.slice(a+1)),Cn.hasOwnProperty(r)?o.setAttributeNS(Cn[r],i,n):o.setAttribute(i,n);return o},input:function(e){var t=document.createElement(\"input\");return null!=e&&(t.type=e),t},range:function(e,t,n){1===arguments.length&&(t=e,e=null);var r=document.createElement(\"input\");return r.min=e=null==e?0:+e,r.max=t=null==t?1:+t,r.step=null==n?\"any\":n=+n,r.type=\"range\",r},select:function(e){var t=document.createElement(\"select\");return Array.prototype.forEach.call(e,(function(e){var n=document.createElement(\"option\");n.value=n.textContent=e,t.appendChild(n)})),t},svg:function(e,t){var n=document.createElementNS(\"http://www.w3.org/2000/svg\",\"svg\");return n.setAttribute(\"viewBox\",[0,0,e,t]),n.setAttribute(\"width\",e),n.setAttribute(\"height\",t),n},text:function(e){return document.createTextNode(e)},uid:xn});var jn=Object.freeze({__proto__:null,buffer:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsArrayBuffer(e)}))},text:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsText(e)}))},url:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsDataURL(e)}))}});function $n(){return this}function Sn(e,t){let n=!1;if(\"function\"!=typeof t)throw new Error(\"dispose is not a function\");return{[Symbol.iterator]:$n,next:()=>n?{done:!0}:(n=!0,{done:!1,value:e}),return:()=>(n=!0,t(e),{done:!0}),throw:()=>({done:n=!0})}}function qn(e){let t,n,r=!1;const a=e((function(e){n?(n(e),n=null):r=!0;return t=e}));if(null!=a&&\"function\"!=typeof a)throw new Error(\"function\"==typeof a.then?\"async initializers are not supported\":\"initializer returned something, but not a dispose function\");return{[Symbol.iterator]:$n,throw:()=>({done:!0}),return:()=>(null!=a&&a(),{done:!0}),next:function(){return{done:!1,value:r?(r=!1,Promise.resolve(t)):new Promise((e=>n=e))}}}}function On(e){switch(e.type){case\"range\":case\"number\":return e.valueAsNumber;case\"date\":return e.valueAsDate;case\"checkbox\":return e.checked;case\"file\":return e.multiple?e.files:e.files[0];case\"select-multiple\":return Array.from(e.selectedOptions,(e=>e.value));default:return e.value}}var Ln=Object.freeze({__proto__:null,disposable:Sn,filter:function*(e,t){for(var n,r=-1;!(n=e.next()).done;)t(n.value,++r)&&(yield n.value)},input:function(e){return qn((function(t){var n=function(e){switch(e.type){case\"button\":case\"submit\":case\"checkbox\":return\"click\";case\"file\":return\"change\";default:return\"input\"}}(e),r=On(e);function a(){t(On(e))}return e.addEventListener(n,a),void 0!==r&&t(r),function(){e.removeEventListener(n,a)}}))},map:function*(e,t){for(var n,r=-1;!(n=e.next()).done;)yield t(n.value,++r)},observe:qn,queue:function(e){let t;const n=[],r=e((function(e){n.push(e),t&&(t(n.shift()),t=null);return e}));if(null!=r&&\"function\"!=typeof r)throw new Error(\"function\"==typeof r.then?\"async initializers are not supported\":\"initializer returned something, but not a dispose function\");return{[Symbol.iterator]:$n,throw:()=>({done:!0}),return:()=>(null!=r&&r(),{done:!0}),next:function(){return{done:!1,value:n.length?Promise.resolve(n.shift()):new Promise((e=>t=e))}}}},range:function*(e,t,n){e=+e,t=+t,n=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+n;for(var r=-1,a=0|Math.max(0,Math.ceil((t-e)/n));++r<a;)yield e+r*n},valueAt:function(e,t){if(!(!isFinite(t=+t)||t<0||t!=t|0))for(var n,r=-1;!(n=e.next()).done;)if(++r===t)return n.value},worker:function(e){const t=URL.createObjectURL(new Blob([e],{type:\"text/javascript\"})),n=new Worker(t);return Sn(n,(()=>{n.terminate(),URL.revokeObjectURL(t)}))}});function kn(e,t){return function(n){var r,a,o,i,s,c,l,u,f=n[0],d=[],p=null,m=-1;for(s=1,c=arguments.length;s<c;++s){if((r=arguments[s])instanceof Node)d[++m]=r,f+=\"\\x3c!--o:\"+m+\"--\\x3e\";else if(Array.isArray(r)){for(l=0,u=r.length;l<u;++l)(a=r[l])instanceof Node?(null===p&&(d[++m]=p=document.createDocumentFragment(),f+=\"\\x3c!--o:\"+m+\"--\\x3e\"),p.appendChild(a)):(p=null,f+=a);p=null}else f+=r;f+=n[s]}if(p=e(f),++m>0){for(o=new Array(m),i=document.createTreeWalker(p,NodeFilter.SHOW_COMMENT,null,!1);i.nextNode();)a=i.currentNode,/^o:/.test(a.nodeValue)&&(o[+a.nodeValue.slice(2)]=a);for(s=0;s<m;++s)(a=o[s])&&a.parentNode.replaceChild(d[s],a)}return 1===p.childNodes.length?p.removeChild(p.firstChild):11===p.nodeType?((a=t()).appendChild(p),a):p}}const Mn=kn((function(e){var t=document.createElement(\"template\");return t.innerHTML=e.trim(),document.importNode(t.content,!0)}),(function(){return document.createElement(\"span\")}));function In(e){let t;Object.defineProperties(this,{generator:{value:qn((e=>{t=e}))},value:{get:()=>e,set:n=>t(e=n)}}),void 0!==e&&t(e)}function*Pn(){for(;;)yield Date.now()}var Rn=new Map;function Un(e,t){var n;return(n=Rn.get(e=+e))?n.then((()=>t)):(n=Date.now())>=e?Promise.resolve(t):function(e,t){var n=new Promise((function(n){Rn.delete(t);var r=t-e;if(!(r>0))throw new Error(\"invalid time\");if(r>2147483647)throw new Error(\"too long to wait\");setTimeout(n,r)}));return Rn.set(t,n),n}(n,e).then((()=>t))}var Dn=Object.freeze({__proto__:null,delay:function(e,t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))},tick:function(e,t){return Un(Math.ceil((Date.now()+1)/e)*e,t)},when:Un});function Fn(e,t){if(/^(\\w+:)|\\/\\//i.test(e))return e;if(/^[.]{0,2}\\//i.test(e))return new URL(e,null==t?location:t).href;if(!e.length||/^[\\s._]/.test(e)||/\\s$/.test(e))throw new Error(\"illegal name\");return\"https://unpkg.com/\"+e}const Bn=kn((function(e){var t=document.createElementNS(\"http://www.w3.org/2000/svg\",\"g\");return t.innerHTML=e.trim(),t}),(function(){return document.createElementNS(\"http://www.w3.org/2000/svg\",\"g\")}));var zn=String.raw;function Wn(e){return new Promise((function(t,n){var r=document.createElement(\"link\");r.rel=\"stylesheet\",r.href=e,r.onerror=n,r.onload=t,document.head.appendChild(r)}))}function Hn(){return qn((function(e){var t=e(document.body.clientWidth);function n(){var n=document.body.clientWidth;n!==t&&e(t=n)}return window.addEventListener(\"resize\",n),function(){window.removeEventListener(\"resize\",n)}}))}const Library=Object.assign(Object.defineProperties((function(e){const t=function(e){return null==e?ft:at(e)}(e);var n;Object.defineProperties(this,(n={FileAttachment:()=>En,Mutable:()=>In,now:Pn,width:Hn,dot:()=>t(Ae.resolve()),htl:()=>t(qe.resolve()),html:()=>Mn,md:()=>function(e){return e(Le.resolve()).then((function(t){return kn((function(n){var r=document.createElement(\"div\");r.innerHTML=t(n,{langPrefix:\"\"}).trim();var a=r.querySelectorAll(\"pre code[class]\");return a.length>0&&e(je.resolve()).then((function(t){a.forEach((function(n){function r(){t.highlightBlock(n),n.parentNode.classList.add(\"observablehq--md-pre\")}t.getLanguage(n.className)?r():e(je.resolve(\"async-languages/index.js\")).then((r=>{if(r.has(n.className))return e(je.resolve(\"async-languages/\"+r.get(n.className))).then((e=>{t.registerLanguage(n.className,e)}))})).then(r,r)}))})),r}),(function(){return document.createElement(\"div\")}))}))}(t),svg:()=>Bn,tex:()=>function(e){return Promise.all([e($e.resolve()),e.resolve($e.resolve(\"dist/katex.min.css\")).then(Wn)]).then((function(e){var t=e[0],n=r();function r(e){return function(){var n=document.createElement(\"div\");return t.render(zn.apply(String,arguments),n,e),n.removeChild(n.firstChild)}}return n.options=r,n.block=r({displayMode:!0}),n}))}(t),_:()=>t(Se.resolve()),aq:()=>t.alias({\"apache-arrow\":Re.resolve()})(Fe.resolve()),Arrow:()=>t(Re.resolve()),d3:()=>t(Ne.resolve()),DuckDBClient:()=>DuckDBClient,Inputs:()=>t(xe.resolve()).then((e=>({...e,file:e.fileOf(gn)}))),L:()=>async function(e){const t=await e(He.resolve());if(!t._style){const n=document.createElement(\"link\");n.rel=\"stylesheet\",n.href=await e.resolve(He.resolve(\"dist/leaflet.css\")),t._style=document.head.appendChild(n)}return t}(t),mermaid:()=>async function(e){const t=await e(We.resolve());return t.initialize({securityLevel:\"loose\",theme:\"neutral\"}),function(){const e=document.createElement(\"div\");return e.innerHTML=t.render(xn().id,String.raw.apply(String,arguments)),e.removeChild(e.firstChild)}}(t),Plot:()=>t(Te.resolve()),__query:()=>It,require:()=>t,resolve:()=>Fn,SQLite:()=>dt(t),SQLiteDatabaseClient:()=>SQLiteDatabaseClient,topojson:()=>t(Be.resolve()),vl:()=>async function(e){const[t,n,r]=await Promise.all([Me,Ie,Pe].map((t=>e(t.resolve()))));return r.register(t,n)}(t),aapl:()=>new FileAttachment(\"https://static.observableusercontent.com/files/3ccff97fd2d93da734e76829b2b066eafdaac6a1fafdec0faf6ebc443271cfc109d29e80dd217468fcb2aff1e6bffdc73f356cc48feb657f35378e6abbbb63b9\").csv({typed:!0}),alphabet:()=>new FileAttachment(\"https://static.observableusercontent.com/files/75d52e6c3130b1cae83cda89305e17b50f33e7420ef205587a135e8562bcfd22e483cf4fa2fb5df6dff66f9c5d19740be1cfaf47406286e2eb6574b49ffc685d\").csv({typed:!0}),cars:()=>new FileAttachment(\"https://static.observableusercontent.com/files/048ec3dfd528110c0665dfa363dd28bc516ffb7247231f3ab25005036717f5c4c232a5efc7bb74bc03037155cb72b1abe85a33d86eb9f1a336196030443be4f6\").csv({typed:!0}),citywages:()=>new FileAttachment(\"https://static.observableusercontent.com/files/39837ec5121fcc163131dbc2fe8c1a2e0b3423a5d1e96b5ce371e2ac2e20a290d78b71a4fb08b9fa6a0107776e17fb78af313b8ea70f4cc6648fad68ddf06f7a\").csv({typed:!0}),diamonds:()=>new FileAttachment(\"https://static.observableusercontent.com/files/87942b1f5d061a21fa4bb8f2162db44e3ef0f7391301f867ab5ba718b225a63091af20675f0bfe7f922db097b217b377135203a7eab34651e21a8d09f4e37252\").csv({typed:!0}),flare:()=>new FileAttachment(\"https://static.observableusercontent.com/files/a6b0d94a7f5828fd133765a934f4c9746d2010e2f342d335923991f31b14120de96b5cb4f160d509d8dc627f0107d7f5b5070d2516f01e4c862b5b4867533000\").csv({typed:!0}),industries:()=>new FileAttachment(\"https://static.observableusercontent.com/files/76f13741128340cc88798c0a0b7fa5a2df8370f57554000774ab8ee9ae785ffa2903010cad670d4939af3e9c17e5e18e7e05ed2b38b848ac2fc1a0066aa0005f\").csv({typed:!0}),miserables:()=>new FileAttachment(\"https://static.observableusercontent.com/files/31d904f6e21d42d4963ece9c8cc4fbd75efcbdc404bf511bc79906f0a1be68b5a01e935f65123670ed04e35ca8cae3c2b943f82bf8db49c5a67c85cbb58db052\").json(),olympians:()=>new FileAttachment(\"https://static.observableusercontent.com/files/31ca24545a0603dce099d10ee89ee5ae72d29fa55e8fc7c9ffb5ded87ac83060d80f1d9e21f4ae8eb04c1e8940b7287d179fe8060d887fb1f055f430e210007c\").csv({typed:!0}),penguins:()=>new FileAttachment(\"https://static.observableusercontent.com/files/715db1223e067f00500780077febc6cebbdd90c151d3d78317c802732252052ab0e367039872ab9c77d6ef99e5f55a0724b35ddc898a1c99cb14c31a379af80a\").csv({typed:!0}),pizza:()=>new FileAttachment(\"https://static.observableusercontent.com/files/c653108ab176088cacbb338eaf2344c4f5781681702bd6afb55697a3f91b511c6686ff469f3e3a27c75400001a2334dbd39a4499fe46b50a8b3c278b7d2f7fb5\").csv({typed:!0}),weather:()=>new FileAttachment(\"https://static.observableusercontent.com/files/693a46b22b33db0f042728700e0c73e836fa13d55446df89120682d55339c6db7cc9e574d3d73f24ecc9bc7eb9ac9a1e7e104a1ee52c00aab1e77eb102913c1f\").csv({typed:!0}),DOM:An,Files:jn,Generators:Ln,Promises:Dn},Object.fromEntries(Object.entries(n).map(Vn))))}),{resolve:{get:()=>ft.resolve,enumerable:!0,configurable:!0},require:{get:()=>ft,set:function(e){ft=e},enumerable:!0,configurable:!0}}),{resolveFrom:nt,requireFrom:at});function Vn([e,t]){return[e,{value:t,writable:!0,enumerable:!0}]}class RuntimeError extends Error{constructor(e,t){super(e),this.input=t}}function Gn(e){return()=>e}function Yn(e){return e}RuntimeError.prototype.name=\"RuntimeError\";const Zn=Array.prototype.map;function Jn(){}const Kn=Symbol(\"no-observer\");function Variable(e,t,n,r){var a;n||(n=Kn),Object.defineProperties(this,{_observer:{value:n,writable:!0},_definition:{value:tr,writable:!0},_duplicate:{value:void 0,writable:!0},_duplicates:{value:void 0,writable:!0},_indegree:{value:NaN,writable:!0},_inputs:{value:[],writable:!0},_invalidate:{value:Jn,writable:!0},_module:{value:t},_name:{value:null,writable:!0},_outputs:{value:new Set,writable:!0},_promise:{value:Promise.resolve(void 0),writable:!0},_reachable:{value:n!==Kn,writable:!0},_rejector:{value:(a=this,e=>{if(e===nr)throw e;if(e===tr)throw new RuntimeError(`${a._name} is not defined`,a._name);if(e instanceof Error&&e.message)throw new RuntimeError(e.message,a._name);throw new RuntimeError(`${a._name} could not be resolved`,a._name)})},_shadow:{value:Xn(t,r)},_type:{value:e},_value:{value:void 0,writable:!0},_version:{value:0,writable:!0}})}function Xn(e,t){return t?.shadow?new Map(Object.entries(t.shadow).map((([t,n])=>[t,new Variable(2,e).define([],n)]))):null}function Qn(e){e._module._runtime._dirty.add(e),e._outputs.add(this)}function er(e){e._module._runtime._dirty.add(e),e._outputs.delete(this)}function tr(){throw tr}function nr(){throw nr}function rr(e){return()=>{throw new RuntimeError(`${e} is defined more than once`)}}function ar(e,t,n){const r=this._module._scope,a=this._module._runtime;if(this._inputs.forEach(er,this),t.forEach(Qn,this),this._inputs=t,this._definition=n,this._value=void 0,n===Jn?a._variables.delete(this):a._variables.add(this),e!==this._name||r.get(e)!==this){let t,o;if(this._name)if(this._outputs.size)r.delete(this._name),o=this._module._resolve(this._name),o._outputs=this._outputs,this._outputs=new Set,o._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(this)]=o}),this),o._outputs.forEach(a._updates.add,a._updates),a._dirty.add(o).add(this),r.set(this._name,o);else if((o=r.get(this._name))===this)r.delete(this._name);else{if(3!==o._type)throw new Error;o._duplicates.delete(this),this._duplicate=void 0,1===o._duplicates.size&&(o=o._duplicates.keys().next().value,t=r.get(this._name),o._outputs=t._outputs,t._outputs=new Set,o._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(t)]=o})),o._definition=o._duplicate,o._duplicate=void 0,a._dirty.add(t).add(o),a._updates.add(o),r.set(this._name,o))}if(this._outputs.size)throw new Error;e&&((o=r.get(e))?3===o._type?(this._definition=rr(e),this._duplicate=n,o._duplicates.add(this)):2===o._type?(this._outputs=o._outputs,o._outputs=new Set,this._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(o)]=this}),this),a._dirty.add(o).add(this),r.set(e,this)):(o._duplicate=o._definition,this._duplicate=n,t=new Variable(3,this._module),t._name=e,t._definition=this._definition=o._definition=rr(e),t._outputs=o._outputs,o._outputs=new Set,t._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(o)]=t})),t._duplicates=new Set([this,o]),a._dirty.add(o).add(t),a._updates.add(o).add(t),r.set(e,t)):r.set(e,this)),this._name=e}return this._version>0&&++this._version,a._updates.add(this),a._compute(),this}Object.defineProperties(Variable.prototype,{_pending:{value:function(){this._observer.pending&&this._observer.pending()},writable:!0,configurable:!0},_fulfilled:{value:function(e){this._observer.fulfilled&&this._observer.fulfilled(e,this._name)},writable:!0,configurable:!0},_rejected:{value:function(e){this._observer.rejected&&this._observer.rejected(e,this._name)},writable:!0,configurable:!0},_resolve:{value:function(e){return this._shadow?.get(e)??this._module._resolve(e)},writable:!0,configurable:!0},define:{value:function(e,t,n){switch(arguments.length){case 1:n=e,e=t=null;break;case 2:n=t,\"string\"==typeof e?t=null:(t=e,e=null)}return ar.call(this,null==e?null:String(e),null==t?[]:Zn.call(t,this._resolve,this),\"function\"==typeof n?n:Gn(n))},writable:!0,configurable:!0},delete:{value:function(){return ar.call(this,null,[],Jn)},writable:!0,configurable:!0},import:{value:function(e,t,n){arguments.length<3&&(n=t,t=e);return ar.call(this,String(t),[n._resolve(String(e))],Yn)},writable:!0,configurable:!0}});const or=Symbol(\"variable\"),ir=Symbol(\"invalidation\"),sr=Symbol(\"visibility\");function Module(e,t=[]){Object.defineProperties(this,{_runtime:{value:e},_scope:{value:new Map},_builtins:{value:new Map([[\"@variable\",or],[\"invalidation\",ir],[\"visibility\",sr],...t])},_source:{value:null,writable:!0}})}async function cr(e,t){await e._compute();try{return await t._promise}catch(n){if(n===nr)return cr(e,t);throw n}}function lr(e){return e._name}Object.defineProperties(Module.prototype,{_resolve:{value:function(e){let t,n=this._scope.get(e);if(!n)if(n=new Variable(2,this),this._builtins.has(e))n.define(e,Gn(this._builtins.get(e)));else if(this._runtime._builtin._scope.has(e))n.import(e,this._runtime._builtin);else{try{t=this._runtime._global(e)}catch(t){return n.define(e,function(e){return()=>{throw e}}(t))}void 0===t?this._scope.set(n._name=e,n):n.define(e,Gn(t))}return n},writable:!0,configurable:!0},redefine:{value:function(e){const t=this._scope.get(e);if(!t)throw new RuntimeError(`${e} is not defined`);if(3===t._type)throw new RuntimeError(`${e} is defined more than once`);return t.define.apply(t,arguments)},writable:!0,configurable:!0},define:{value:function(){const e=new Variable(1,this);return e.define.apply(e,arguments)},writable:!0,configurable:!0},derive:{value:function(e,t){const n=new Map,r=new Set,a=[];function o(e){let t=n.get(e);return t||(t=new Module(e._runtime,e._builtins),t._source=e,n.set(e,t),a.push([t,e]),r.add(e),t)}const i=o(this);for(const n of e){const{alias:e,name:r}=\"object\"==typeof n?n:{name:n};i.import(r,null==e?r:e,t)}for(const e of r)for(const[t,n]of e._scope)if(n._definition===Yn){if(e===this&&i._scope.has(t))continue;const r=n._inputs[0]._module;r._source&&o(r)}for(const[e,t]of a)for(const[r,a]of t._scope){const t=e._scope.get(r);if(!t||2===t._type)if(a._definition===Yn){const t=a._inputs[0],o=t._module;e.import(t._name,r,n.get(o)||o)}else e.define(r,a._inputs.map(lr),a._definition)}return i},writable:!0,configurable:!0},import:{value:function(){const e=new Variable(1,this);return e.import.apply(e,arguments)},writable:!0,configurable:!0},value:{value:async function(e){let t=this._scope.get(e);if(!t)throw new RuntimeError(`${e} is not defined`);if(t._observer!==Kn)return cr(this._runtime,t);t=this.variable(!0).define([e],Yn);try{return await cr(this._runtime,t)}finally{t.delete()}},writable:!0,configurable:!0},variable:{value:function(e,t){return new Variable(1,this,e,t)},writable:!0,configurable:!0},builtin:{value:function(e,t){this._builtins.set(e,t)},writable:!0,configurable:!0}});const ur=\"function\"==typeof requestAnimationFrame?requestAnimationFrame:\"function\"==typeof setImmediate?setImmediate:e=>setTimeout(e,0);function Runtime(e=new Library,t=yr){const n=this.module();if(Object.defineProperties(this,{_dirty:{value:new Set},_updates:{value:new Set},_precomputes:{value:[],writable:!0},_computing:{value:null,writable:!0},_init:{value:null,writable:!0},_modules:{value:new Map},_variables:{value:new Set},_disposed:{value:!1,writable:!0},_builtin:{value:n},_global:{value:t}}),e)for(const t in e)new Variable(2,n).define(t,[],e[t])}function fr(e){const t=new Set(e._inputs);for(const n of t){if(n===e)return!0;n._inputs.forEach(t.add,t)}return!1}function dr(e){++e._indegree}function pr(e){--e._indegree}function mr(e){return e._promise.catch(e._rejector)}function hr(e){return new Promise((function(t){e._invalidate=t}))}function br(e,t){let n,r,a=\"function\"==typeof IntersectionObserver&&t._observer&&t._observer._node,o=!a,i=Jn,s=Jn;return a&&(r=new IntersectionObserver((([e])=>(o=e.isIntersecting)&&(n=null,i()))),r.observe(a),e.then((()=>(r.disconnect(),r=null,s())))),function(e){return o?Promise.resolve(e):r?(n||(n=new Promise(((e,t)=>(i=e,s=t)))),n.then((()=>e))):Promise.reject()}}function wr(e){e._invalidate(),e._invalidate=Jn,e._pending();const t=e._value,n=++e._version;let r=null;const a=e._promise=(e._inputs.length?Promise.all(e._inputs.map(mr)).then((function(a){if(e._version!==n)throw nr;for(let t=0,n=a.length;t<n;++t)switch(a[t]){case ir:a[t]=r=hr(e);break;case sr:r||(r=hr(e)),a[t]=br(r,e);break;case or:a[t]=e}return e._definition.apply(t,a)})):new Promise((n=>n(e._definition.call(t))))).then((function(t){if(e._version!==n)throw nr;if(function(e){return e&&\"function\"==typeof e.next&&\"function\"==typeof e.return}(t))return(r||hr(e)).then((a=t,function(){a.return()})),function(e,t,n){const r=e._module._runtime;let a;function o(e){return new Promise((e=>e(n.next(a)))).then((({done:t,value:n})=>t?void 0:Promise.resolve(n).then(e)))}function i(){const n=o((o=>{if(e._version!==t)throw nr;return a=o,s(o,n).then((()=>r._precompute(i))),e._fulfilled(o),o}));n.catch((r=>{r!==nr&&e._version===t&&(s(void 0,n),e._rejected(r))}))}function s(t,n){return e._value=t,e._promise=n,e._outputs.forEach(r._updates.add,r._updates),r._compute()}return o((n=>{if(e._version!==t)throw nr;return a=n,r._precompute(i),n}))}(e,n,t);var a;return t}));a.then((t=>{e._value=t,e._fulfilled(t)}),(t=>{t!==nr&&e._version===n&&(e._value=void 0,e._rejected(t))}))}function vr(e,t){e._invalidate(),e._invalidate=Jn,e._pending(),++e._version,e._indegree=NaN,(e._promise=Promise.reject(t)).catch(Jn),e._value=void 0,e._rejected(t)}function yr(e){return globalThis[e]}Object.defineProperties(Runtime.prototype,{_precompute:{value:function(e){this._precomputes.push(e),this._compute()},writable:!0,configurable:!0},_compute:{value:function(){return this._computing||(this._computing=this._computeSoon())},writable:!0,configurable:!0},_computeSoon:{value:function(){return new Promise(ur).then((()=>this._disposed?void 0:this._computeNow()))},writable:!0,configurable:!0},_computeNow:{value:async function(){let e,t,n=[],r=this._precomputes;if(r.length){this._precomputes=[];for(const e of r)e();await function(e=0){let t=Promise.resolve();for(let n=0;n<e;++n)t=t.then((()=>{}));return t}(3)}e=new Set(this._dirty),e.forEach((function(t){t._inputs.forEach(e.add,e);const n=function(e){if(e._observer!==Kn)return!0;const t=new Set(e._outputs);for(const e of t){if(e._observer!==Kn)return!0;e._outputs.forEach(t.add,t)}return!1}(t);n>t._reachable?this._updates.add(t):n<t._reachable&&t._invalidate(),t._reachable=n}),this),e=new Set(this._updates),e.forEach((function(t){t._reachable?(t._indegree=0,t._outputs.forEach(e.add,e)):(t._indegree=NaN,e.delete(t))})),this._computing=null,this._updates.clear(),this._dirty.clear(),e.forEach((function(e){e._outputs.forEach(dr)}));do{for(e.forEach((function(e){0===e._indegree&&n.push(e)}));t=n.pop();)wr(t),t._outputs.forEach(a),e.delete(t);e.forEach((function(t){fr(t)&&(vr(t,new RuntimeError(\"circular definition\")),t._outputs.forEach(pr),e.delete(t))}))}while(e.size);function a(e){0==--e._indegree&&n.push(e)}},writable:!0,configurable:!0},dispose:{value:function(){this._computing=Promise.resolve(),this._disposed=!0,this._variables.forEach((e=>{e._invalidate(),e._version=NaN}))},writable:!0,configurable:!0},module:{value:function(e,t=Jn){let n;if(void 0===e)return(n=this._init)?(this._init=null,n):new Module(this);if(n=this._modules.get(e),n)return n;this._init=n=new Module(this),this._modules.set(e,n);try{e(this,t)}finally{this._init=null}return n},writable:!0,configurable:!0},fileAttachments:{value:function(e){return Object.assign((t=>{const n=e(t+=\"\");if(null==n)throw new Error(`File not found: ${t}`);if(\"object\"==typeof n&&\"url\"in n){const{url:e,mimeType:r}=n;return new FileAttachment(e,t,r)}return new FileAttachment(n,t)}),{prototype:FileAttachment.prototype})},writable:!0,configurable:!0}});export{Inspector,Library,Runtime,RuntimeError};\n"
    },
    {
      "filename": "cloned/webxr-first-steps/CODE_OF_CONDUCT.md",
      "content": "# Code of Conduct\n\n## Our Pledge\n\nIn the interest of fostering an open and welcoming environment, we as\ncontributors and maintainers pledge to make participation in our project and\nour community a harassment-free experience for everyone, regardless of age, body\nsize, disability, ethnicity, sex characteristics, gender identity and expression,\nlevel of experience, education, socio-economic status, nationality, personal\nappearance, race, religion, or sexual identity and orientation.\n\n## Our Standards\n\nExamples of behavior that contributes to creating a positive environment\ninclude:\n\n- Using welcoming and inclusive language\n- Being respectful of differing viewpoints and experiences\n- Gracefully accepting constructive criticism\n- Focusing on what is best for the community\n- Showing empathy towards other community members\n\nExamples of unacceptable behavior by participants include:\n\n- The use of sexualized language or imagery and unwelcome sexual attention or\n  advances\n- Trolling, insulting/derogatory comments, and personal or political attacks\n- Public or private harassment\n- Publishing others' private information, such as a physical or electronic\n  address, without explicit permission\n- Other conduct which could reasonably be considered inappropriate in a\n  professional setting\n\n## Our Responsibilities\n\nProject maintainers are responsible for clarifying the standards of acceptable\nbehavior and are expected to take appropriate and fair corrective action in\nresponse to any instances of unacceptable behavior.\n\nProject maintainers have the right and responsibility to remove, edit, or\nreject comments, commits, code, wiki edits, issues, and other contributions\nthat are not aligned to this Code of Conduct, or to ban temporarily or\npermanently any contributor for other behaviors that they deem inappropriate,\nthreatening, offensive, or harmful.\n\n## Scope\n\nThis Code of Conduct applies within all project spaces, and it also applies when\nan individual is representing the project or its community in public spaces.\nExamples of representing a project or community include using an official\nproject e-mail address, posting via an official social media account, or acting\nas an appointed representative at an online or offline event. Representation of\na project may be further defined and clarified by project maintainers.\n\nThis Code of Conduct also applies outside the project spaces when there is a\nreasonable belief that an individual's behavior may have a negative impact on\nthe project or its community.\n\n## Enforcement\n\nInstances of abusive, harassing, or otherwise unacceptable behavior may be\nreported by contacting the project team at <opensource-conduct@meta.com>. All\ncomplaints will be reviewed and investigated and will result in a response that\nis deemed necessary and appropriate to the circumstances. The project team is\nobligated to maintain confidentiality with regard to the reporter of an incident.\nFurther details of specific enforcement policies may be posted separately.\n\nProject maintainers who do not follow or enforce the Code of Conduct in good\nfaith may face temporary or permanent repercussions as determined by other\nmembers of the project's leadership.\n\n## Attribution\n\nThis Code of Conduct is adapted from the [Contributor Covenant][homepage], version 1.4,\navailable at https://www.contributor-covenant.org/version/1/4/code-of-conduct.html\n\n[homepage]: https://www.contributor-covenant.org\n\nFor answers to common questions about this code of conduct, see\nhttps://www.contributor-covenant.org/faq\n"
    },
    {
      "filename": "cloned/webxr-first-steps/CONTRIBUTING.md",
      "content": "# Contributing to WebXR First Steps\n\nWe want to make contributing to this project as easy and transparent as\npossible.\n\n## Pull Requests\n\nWe actively welcome your pull requests.\n\n1. Fork the repo and create your branch from `main`.\n2. If you've added code that should be tested, add tests.\n3. Make sure your code lints.\n4. If you haven't already, complete the Contributor License Agreement (\"CLA\").\n\n## Contributor License Agreement (\"CLA\")\n\nIn order to accept your pull request, we need you to submit a CLA. You only need\nto do this once to work on any of Meta's open source projects.\n\nComplete your CLA here: <https://code.facebook.com/cla>\n\n## Issues\n\nWe use GitHub issues to track public bugs. Please ensure your description is\nclear and has sufficient instructions to be able to reproduce the issue.\n\nMeta has a [bounty program](https://www.facebook.com/whitehat/) for the safe\ndisclosure of security bugs. In those cases, please go through the process\noutlined on that page and do not file a public issue.\n\n## Coding Style\n\nWebXR Samples uses `eslint` and `prettier` to lint and format code.\n\nYou can format manually by running:\n\n```\n$ npm run format\n```\n\nThere are also VSCode extensions that can run those linters / formatters for you. Prettier has a [VSCode Plugin](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode), which allows you to format on save.\n\nIf you don't want to format on save, and want to format a single file, you can use `Ctrl+Shift+P` in VS Code (`Cmd+Shift+P` on macs) to bring up the command palette, then type `Format Document` to format the currently active file. Note that you should have the Prettier VS code plugin installed to make sure it formats according to the project's guidelines.\n\n## License\n\nBy contributing to WebXR First Steps, you agree that your contributions will be licensed\nunder the LICENSE file in the root directory of this source tree.\n"
    },
    {
      "filename": "cloned/webxr-first-steps/README.md",
      "content": "<p align=\"center\">\n    <img src=\"./tutorial/assets/webxr-first-steps.png\" style=\"max-width:376px\"/>\n</p>\n\nWelcome to **WebXR First Steps**! This **2-hour** tutorial is designed to help you take your first steps into developing immersive WebXR experiences using [Three.js](https://threejs.org/). Whether you’re a web developer looking to expand your skillset or a hobbyist interested in creating virtual reality (VR) applications, this tutorial will guide you through the fundamentals of building interactive 3D worlds for the web.\n\n## What You’ll Build\n\nBy the end of this tutorial, you’ll have created a fully functional WebXR game where players can use VR controllers to shoot targets, track their score, and enjoy an immersive experience complete with sound, vibration, and smooth animations. Here's what the final experience looks like:\n\n<figure style=\"text-align: center;\">\n  <img src=\"./tutorial/assets/targetpractice.gif\" style=\"max-height:376px\"/>\n  <figcaption>Target Practice Gameplay</figcaption>\n</figure>\n\n## Setting Up Your Local Development Environment\n\nTo prepare your development environment and get started with building your WebXR experience, follow the steps below:\n\n1. **Clone this repository**:\n\n   ```bash\n   git clone git@github.com:meta-quest/webxr-first-steps.git\n   cd webxr-first-steps\n   ```\n\n2. **Verify that you have Node.js and npm installed**:\n\n   - Node.js version: `20.x` or later\n   - npm version: `10.x` or later\n     You can check your versions with these commands:\n\n   ```bash\n   node -v\n   npm -v\n   ```\n\n3. **Install dependencies**:\n\n   ```bash\n   npm install\n   ```\n\n4. **Run the local development server**:\n\n   ```bash\n   npm run dev\n   ```\n\n   After running the above command, your development server will be available at `localhost:8081`.\n\n### Developing with a Headset\n\nYou can access the local development server from your XR headset by using one of two methods: via the IP address of your computer or by using ADB with port forwarding.\n\n#### Accessing the Local Server on Your Headset via IP Address\n\nOn most home networks, you can access the local server by entering your computer's IP address and the port number (8081) in the browser on your VR headset. This information is displayed in the Webpack console when you start the server.\n\nFor example:\n\n```bash\n<i> [webpack-dev-server] Project is running at:\n<i> [webpack-dev-server] On Your Network (IPv4): https://192.168.0.123:8081/\n```\n\nYou might encounter a warning about an invalid certificate when accessing the site from your browser client, which you can safely dismiss to access your site.\n\n#### Accessing the Local Server on Your Headset via ADB\n\nIf accessing via IP address doesn’t work due to network restrictions or firewall settings, you can use **ADB (Android Debug Bridge)** and port forwarding:\n\n1. **Connect your headset to your computer**: Use a USB cable and enable developer mode on your headset. Check your device's official documentation for instructions on enabling developer mode.\n2. **Set up port forwarding**: Open Chrome on your computer and navigate to `chrome://inspect/#devices`. Your headset should appear under **Remote Target**.\n\n3. **Configure port forwarding**:\n   - Click **Port forwarding...** in Chrome DevTools.\n   - Add a rule to forward port `8081` from your computer to your headset.\n\nYou can now access the local server on your headset by entering `https://localhost:8081` in the browser. As with the IP address method, you may encounter a certificate warning, which can be dismissed.\n\n### Developing with an Emulator\n\nThis project includes a built-in emulation setup located in `./src/init.js`, powered by [IWER](https://github.com/meta-quest/immersive-web-emulation-runtime/) (Immersive Web Emulation Runtime) and [@iwer/devui](https://github.com/meta-quest/immersive-web-emulation-runtime/tree/main/devui). The emulation setup automatically detects native WebXR support in your browser and activates itself if no native WebXR support is found.\n\nIf you're already using the [Immersive Web Emulator browser extension](https://chromewebstore.google.com/detail/immersive-web-emulator/cgffilbpcibhmcfbgggfhfolhkfbhmik), the built-in emulation will not conflict with it, and you can safely skip this section. However, if you use other WebXR emulators, we recommend disabling them and using the built-in emulation setup for the best results.\n\n- **IWER** is a full WebXR runtime, and **@iwer/devui** provides a developer interface that exposes control over the emulated XR device created by IWER. With this setup, you can manipulate headset and controller transforms, and simulate input events for the emulated controllers.\n- Additionally, you can leverage the **\"Play Mode\"** button on the top bar of the interface. This feature locks your cursor and allows you to control the emulated XR device like a first-person 3D experience on a PC.\n\nHere’s a showcase of the emulation setup in action:\n\n<figure style=\"text-align: center;\">\n  <img src=\"./tutorial/assets/iwerdevui.gif\" style=\"max-height:376px\"/>\n  <figcaption>IWER & IWER/DevUI Showcase</figcaption>\n</figure>\n\n## Getting Started\n\nThis tutorial is structured into chapters to help you progressively build your WebXR game. Follow each chapter in sequence, as each builds upon concepts introduced in the previous ones.\n\n- [**Chapter 1: Creating Simple Objects**](./tutorial/chapter1.md): Learn how to add basic 3D shapes like cubes, spheres, and cones to your scene.\n- [**Chapter 2: Interacting with Controllers**](./tutorial/chapter2.md): Implement VR controller interactions and trigger actions based on user input.\n- [**Chapter 3: Animating Objects**](./tutorial/chapter3.md): Make bullets move in the direction of the controller, and learn about time-based animation in WebXR.\n- [**Chapter 4: Loading GLTF Models**](./tutorial/chapter4.md): Replace simple geometries with more complex, detailed 3D models using the GLTF format.\n- [**Chapter 5: Hit Detection and Score Tracking**](./tutorial/chapter5.md): Implement proximity-based hit detection, track player progress, and display scores.\n- [**Chapter 6: Finishing Touches**](./tutorial/chapter6.md): Add audio feedback, haptic feedback, and visual effects to make your game more immersive and polished.\n\nWe hope you enjoy working through the tutorial. Happy coding, and have fun building your WebXR game!\n\n## Build and Deploy\n\nOnce you've completed the development of your WebXR game, you can build and deploy it for others to experience. Here's how you can do that:\n\n### Deploying the App with GitHub Pages\n\nThis repository includes a ready-to-use GitHub Actions workflow located at `.github/workflows/deploy.yml`, which automates both the build and deployment to GitHub Pages. Once enabled, every time you push changes to the `main` branch, a new build will automatically be deployed.\n\n#### Steps to Enable GitHub Pages Deployment:\n\n1. **Fork this repository** to your own GitHub account.\n2. Navigate to your forked repository’s **Settings**.\n3. Scroll down to the **Pages** section.\n4. Under **Build and Deployment**, change the **Source** to **GitHub Actions**.\n\nOnce this is set, GitHub Actions will handle the build and deployment process automatically. Any time you push changes to the `main` branch, the app will be built and deployed to GitHub Pages without any additional manual steps.\n\nYou can monitor the status of the deployment job or manually re-run it via the **Actions** tab in your GitHub repository.\n\n### Deploying to Your Own Hosting Solution\n\nIf you prefer to host the app yourself, you’ll need to manually build the app and then deploy the generated files to your hosting provider.\n\nTo generate the build, run the following command:\n\n```bash\nnpm run build\n```\n\nThis will create a `dist` folder containing the static files for the app. You can then upload these files to your hosting platform of choice.\n\n## Contributing\n\nPlease read [CONTRIBUTING.md](./CONTRIBUTING.md) for details on how to contribute to the project.\n\n## License\n\nThis project is licensed under the MIT License - see the [LICENSE.md](./LICENSE) file for details.\n"
    },
    {
      "filename": "cloned/webxr-first-steps/src/index.html",
      "content": "<!-- \n  Copyright (c) Meta Platforms, Inc. and affiliates.\n\n  This source code is licensed under the MIT license found in the\n  LICENSE file in the root directory of this source tree.\n-->\n<!doctype html>\n<html lang=\"en\">\n\t<head>\n\t\t<title>WebXR First Steps</title>\n\t\t<meta charset=\"utf-8\" />\n\t\t<meta\n\t\t\tname=\"viewport\"\n\t\t\tcontent=\"width=device-width, initial-scale=1.0, user-scalable=no\"\n\t\t/>\n\t</head>\n\t<body style=\"margin: 0\">\n\t\t<div\n\t\t\tstyle=\"\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 10px;\n\t\t\t\twidth: 100vw;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\tcolor: white;\n\t\t\t\"\n\t\t>\n\t\t\t<div>\n\t\t\t\tWebXR First Steps Tutorial -&nbsp;\n\t\t\t\t<a href=\"https://github.com/meta-quest/webxr-first-steps\">GitHub</a\n\t\t\t\t>&nbsp;|&nbsp;<a\n\t\t\t\t\thref=\"https://raw.githubusercontent.com/meta-quest/webxr-first-steps/main/LICENSE\"\n\t\t\t\t\t>MIT License</a\n\t\t\t\t>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\tCopyright © Meta Platforms, Inc |\n\n\t\t\t\t<a href=\"https://opensource.fb.com/legal/terms/\">Terms</a>&nbsp;|&nbsp;\n\t\t\t\t<a href=\"https://opensource.fb.com/legal/privacy/\">Privacy</a>\n\t\t\t</div>\n\t\t</div>\n\t\t<script type=\"module\" src=\"./index.js\"></script>\n\t</body>\n</html>\n"
    },
    {
      "filename": "cloned/webxr-first-steps/src/index.js",
      "content": "/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport * as THREE from 'three';\n\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';\nimport { Text } from 'troika-three-text';\nimport { XR_BUTTONS } from 'gamepad-wrapper';\nimport { gsap } from 'gsap';\nimport { init } from './init.js';\n\nconst bullets = {};\nconst forwardVector = new THREE.Vector3(0, 0, -1);\nconst bulletSpeed = 10;\nconst bulletTimeToLive = 1;\n\nconst blasterGroup = new THREE.Group();\nconst targets = [];\n\nlet score = 0;\nconst scoreText = new Text();\nscoreText.fontSize = 0.52;\nscoreText.font = 'assets/SpaceMono-Bold.ttf';\nscoreText.position.z = -2;\nscoreText.color = 0xffa276;\nscoreText.anchorX = 'center';\nscoreText.anchorY = 'middle';\n\nlet laserSound, scoreSound;\n\nfunction updateScoreDisplay() {\n\tconst clampedScore = Math.max(0, Math.min(9999, score));\n\tconst displayScore = clampedScore.toString().padStart(4, '0');\n\tscoreText.text = displayScore;\n\tscoreText.sync();\n}\n\nfunction setupScene({ scene, camera, renderer, player, controllers }) {\n\tconst gltfLoader = new GLTFLoader();\n\n\tgltfLoader.load('assets/spacestation.glb', (gltf) => {\n\t\tscene.add(gltf.scene);\n\t});\n\n\tgltfLoader.load('assets/blaster.glb', (gltf) => {\n\t\tblasterGroup.add(gltf.scene);\n\t});\n\n\tgltfLoader.load('assets/target.glb', (gltf) => {\n\t\tfor (let i = 0; i < 3; i++) {\n\t\t\tconst target = gltf.scene.clone();\n\t\t\ttarget.position.set(\n\t\t\t\tMath.random() * 10 - 5,\n\t\t\t\ti * 2 + 1,\n\t\t\t\t-Math.random() * 5 - 5,\n\t\t\t);\n\t\t\tscene.add(target);\n\t\t\ttargets.push(target);\n\t\t}\n\t});\n\n\tscene.add(scoreText);\n\tscoreText.position.set(0, 0.67, -1.44);\n\tscoreText.rotateX(-Math.PI / 3.3);\n\tupdateScoreDisplay();\n\n\t// Load and set up positional audio\n\tconst listener = new THREE.AudioListener();\n\tcamera.add(listener);\n\n\tconst audioLoader = new THREE.AudioLoader();\n\tlaserSound = new THREE.PositionalAudio(listener);\n\taudioLoader.load('assets/laser.ogg', (buffer) => {\n\t\tlaserSound.setBuffer(buffer);\n\t\tblasterGroup.add(laserSound);\n\t});\n\n\tscoreSound = new THREE.PositionalAudio(listener);\n\taudioLoader.load('assets/score.ogg', (buffer) => {\n\t\tscoreSound.setBuffer(buffer);\n\t\tscoreText.add(scoreSound);\n\t});\n}\n\nfunction onFrame(\n\tdelta,\n\ttime,\n\t{ scene, camera, renderer, player, controllers },\n) {\n\tif (controllers.right) {\n\t\tconst { gamepad, raySpace, mesh } = controllers.right;\n\t\tif (!raySpace.children.includes(blasterGroup)) {\n\t\t\traySpace.add(blasterGroup);\n\t\t\tmesh.visible = false;\n\t\t}\n\t\tif (gamepad.getButtonClick(XR_BUTTONS.TRIGGER)) {\n\t\t\ttry {\n\t\t\t\tgamepad.getHapticActuator(0).pulse(0.6, 100);\n\t\t\t} catch {\n\t\t\t\t// do nothing\n\t\t\t}\n\n\t\t\t// Play laser sound\n\t\t\tif (laserSound.isPlaying) laserSound.stop();\n\t\t\tlaserSound.play();\n\n\t\t\tconst bulletPrototype = blasterGroup.getObjectByName('bullet');\n\t\t\tif (bulletPrototype) {\n\t\t\t\tconst bullet = bulletPrototype.clone();\n\t\t\t\tscene.add(bullet);\n\t\t\t\tbulletPrototype.getWorldPosition(bullet.position);\n\t\t\t\tbulletPrototype.getWorldQuaternion(bullet.quaternion);\n\n\t\t\t\tconst directionVector = forwardVector\n\t\t\t\t\t.clone()\n\t\t\t\t\t.applyQuaternion(bullet.quaternion);\n\t\t\t\tbullet.userData = {\n\t\t\t\t\tvelocity: directionVector.multiplyScalar(bulletSpeed),\n\t\t\t\t\ttimeToLive: bulletTimeToLive,\n\t\t\t\t};\n\t\t\t\tbullets[bullet.uuid] = bullet;\n\t\t\t}\n\t\t}\n\t}\n\n\tObject.values(bullets).forEach((bullet) => {\n\t\tif (bullet.userData.timeToLive < 0) {\n\t\t\tdelete bullets[bullet.uuid];\n\t\t\tscene.remove(bullet);\n\t\t\treturn;\n\t\t}\n\t\tconst deltaVec = bullet.userData.velocity.clone().multiplyScalar(delta);\n\t\tbullet.position.add(deltaVec);\n\t\tbullet.userData.timeToLive -= delta;\n\n\t\ttargets\n\t\t\t.filter((target) => target.visible)\n\t\t\t.forEach((target) => {\n\t\t\t\tconst distance = target.position.distanceTo(bullet.position);\n\t\t\t\tif (distance < 1) {\n\t\t\t\t\tdelete bullets[bullet.uuid];\n\t\t\t\t\tscene.remove(bullet);\n\n\t\t\t\t\tgsap.to(target.scale, {\n\t\t\t\t\t\tduration: 0.3,\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\tz: 0,\n\t\t\t\t\t\tonComplete: () => {\n\t\t\t\t\t\t\ttarget.visible = false;\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\ttarget.visible = true;\n\t\t\t\t\t\t\t\ttarget.position.x = Math.random() * 10 - 5;\n\t\t\t\t\t\t\t\ttarget.position.z = -Math.random() * 5 - 5;\n\n\t\t\t\t\t\t\t\t// Scale back up the target\n\t\t\t\t\t\t\t\tgsap.to(target.scale, {\n\t\t\t\t\t\t\t\t\tduration: 0.3,\n\t\t\t\t\t\t\t\t\tx: 1,\n\t\t\t\t\t\t\t\t\ty: 1,\n\t\t\t\t\t\t\t\t\tz: 1,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tscore += 10;\n\t\t\t\t\tupdateScoreDisplay();\n\t\t\t\t\tif (scoreSound.isPlaying) scoreSound.stop();\n\t\t\t\t\tscoreSound.play();\n\t\t\t\t}\n\t\t\t});\n\t});\n\tgsap.ticker.tick(delta);\n}\n\ninit(setupScene, onFrame);\n"
    },
    {
      "filename": "cloned/webxr-first-steps/src/init.js",
      "content": "/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport * as THREE from 'three';\n\nimport { XRDevice, metaQuest3 } from 'iwer';\n\nimport { DevUI } from '@iwer/devui';\nimport { GamepadWrapper } from 'gamepad-wrapper';\nimport { OrbitControls } from 'three/addons/controls/OrbitControls.js';\nimport { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js';\nimport { VRButton } from 'three/addons/webxr/VRButton.js';\nimport { XRControllerModelFactory } from 'three/addons/webxr/XRControllerModelFactory.js';\n\nexport async function init(setupScene = () => {}, onFrame = () => {}) {\n\t// iwer setup\n\tlet nativeWebXRSupport = false;\n\tif (navigator.xr) {\n\t\tnativeWebXRSupport = await navigator.xr.isSessionSupported('immersive-vr');\n\t}\n\tif (!nativeWebXRSupport) {\n\t\tconst xrDevice = new XRDevice(metaQuest3);\n\t\txrDevice.installRuntime();\n\t\txrDevice.fovy = (75 / 180) * Math.PI;\n\t\txrDevice.ipd = 0;\n\t\twindow.xrdevice = xrDevice;\n\t\txrDevice.controllers.right.position.set(0.15649, 1.43474, -0.38368);\n\t\txrDevice.controllers.right.quaternion.set(\n\t\t\t0.14766305685043335,\n\t\t\t0.02471366710960865,\n\t\t\t-0.0037767395842820406,\n\t\t\t0.9887216687202454,\n\t\t);\n\t\txrDevice.controllers.left.position.set(-0.15649, 1.43474, -0.38368);\n\t\txrDevice.controllers.left.quaternion.set(\n\t\t\t0.14766305685043335,\n\t\t\t0.02471366710960865,\n\t\t\t-0.0037767395842820406,\n\t\t\t0.9887216687202454,\n\t\t);\n\t\tnew DevUI(xrDevice);\n\t}\n\n\tconst container = document.createElement('div');\n\tdocument.body.appendChild(container);\n\n\tconst scene = new THREE.Scene();\n\tscene.background = new THREE.Color(0x808080);\n\n\tconst camera = new THREE.PerspectiveCamera(\n\t\t50,\n\t\twindow.innerWidth / window.innerHeight,\n\t\t0.1,\n\t\t100,\n\t);\n\tcamera.position.set(0, 1.6, 3);\n\n\tconst controls = new OrbitControls(camera, container);\n\tcontrols.target.set(0, 1.6, 0);\n\tcontrols.update();\n\n\tconst renderer = new THREE.WebGLRenderer({ antialias: true });\n\trenderer.setPixelRatio(window.devicePixelRatio);\n\trenderer.setSize(window.innerWidth, window.innerHeight);\n\trenderer.xr.enabled = true;\n\tcontainer.appendChild(renderer.domElement);\n\n\tconst environment = new RoomEnvironment(renderer);\n\tconst pmremGenerator = new THREE.PMREMGenerator(renderer);\n\tscene.environment = pmremGenerator.fromScene(environment).texture;\n\n\tconst player = new THREE.Group();\n\tscene.add(player);\n\tplayer.add(camera);\n\n\tconst controllerModelFactory = new XRControllerModelFactory();\n\tconst controllers = {\n\t\tleft: null,\n\t\tright: null,\n\t};\n\tfor (let i = 0; i < 2; i++) {\n\t\tconst raySpace = renderer.xr.getController(i);\n\t\tconst gripSpace = renderer.xr.getControllerGrip(i);\n\t\tconst mesh = controllerModelFactory.createControllerModel(gripSpace);\n\t\tgripSpace.add(mesh);\n\t\tplayer.add(raySpace, gripSpace);\n\t\traySpace.visible = false;\n\t\tgripSpace.visible = false;\n\t\tgripSpace.addEventListener('connected', (e) => {\n\t\t\traySpace.visible = true;\n\t\t\tgripSpace.visible = true;\n\t\t\tconst handedness = e.data.handedness;\n\t\t\tcontrollers[handedness] = {\n\t\t\t\traySpace,\n\t\t\t\tgripSpace,\n\t\t\t\tmesh,\n\t\t\t\tgamepad: new GamepadWrapper(e.data.gamepad),\n\t\t\t};\n\t\t});\n\t\tgripSpace.addEventListener('disconnected', (e) => {\n\t\t\traySpace.visible = false;\n\t\t\tgripSpace.visible = false;\n\t\t\tconst handedness = e.data.handedness;\n\t\t\tcontrollers[handedness] = null;\n\t\t});\n\t}\n\n\tfunction onWindowResize() {\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\n\t\trenderer.setSize(window.innerWidth, window.innerHeight);\n\t}\n\n\twindow.addEventListener('resize', onWindowResize);\n\n\tconst globals = {\n\t\tscene,\n\t\tcamera,\n\t\trenderer,\n\t\tplayer,\n\t\tcontrollers,\n\t};\n\n\tsetupScene(globals);\n\n\tconst clock = new THREE.Clock();\n\tfunction animate() {\n\t\tconst delta = clock.getDelta();\n\t\tconst time = clock.getElapsedTime();\n\t\tObject.values(controllers).forEach((controller) => {\n\t\t\tif (controller?.gamepad) {\n\t\t\t\tcontroller.gamepad.update();\n\t\t\t}\n\t\t});\n\t\tonFrame(delta, time, globals);\n\t\trenderer.render(scene, camera);\n\t}\n\n\trenderer.setAnimationLoop(animate);\n\n\tdocument.body.appendChild(VRButton.createButton(renderer));\n}\n"
    },
    {
      "filename": "cloned/webxr-first-steps/tutorial/chapter1.md",
      "content": "# Chapter 1: Creating Simple Objects in the Scene\n\nWelcome to Chapter 1 of our WebXR tutorial! In this chapter, you’ll learn how to create and position simple objects in a 3D scene using Three.js, setting the foundation for more complex interactions.\n\n## `setupScene` Function\n\nThe `setupScene` function is where you'll define the objects in your 3D environment. It’s the space where you arrange all the elements that will appear in your scene, leaving frame-by-frame updates for later.\n\n### Meshes, Geometries, and Materials in Three.js\n\nIn Three.js, a **mesh** is the combination of **geometry** (the shape) and **material** (the appearance). Let’s use the floor as an example:\n\n- **Geometry**: Defines the shape. For the floor, we use `PlaneGeometry` to create a 6x6 unit rectangle:\n\n  ```javascript\n  const floorGeometry = new THREE.PlaneGeometry(6, 6);\n  ```\n\n- **Material**: Defines how the surface looks. We use `MeshStandardMaterial` with a white color:\n\n  ```javascript\n  const floorMaterial = new THREE.MeshStandardMaterial({ color: 'white' });\n  ```\n\n- **Mesh**: Combines the geometry and material:\n  ```javascript\n  const floor = new THREE.Mesh(floorGeometry, floorMaterial);\n  ```\n\nFinally, we rotate and add the floor to the scene:\n\n```javascript\nfloor.rotateX(-Math.PI / 2);\nscene.add(floor);\n```\n\n## Task\n\nNow, let’s add a cone, a cube, and a sphere to your `sceneSetup`, each with its own geometry, material, and transformations.\n\n### 1. **Adding a Cone**\n\n```javascript\nconst coneGeometry = new THREE.ConeGeometry(0.6, 1.5);\nconst coneMaterial = new THREE.MeshStandardMaterial({ color: 'purple' });\nconst cone = new THREE.Mesh(coneGeometry, coneMaterial);\nscene.add(cone);\ncone.position.set(0.4, 0.75, -1.5);\n```\n\n- **Geometry**: `ConeGeometry(0.6, 1.5)` creates a cone with a base radius of 0.6 units and a height of 1.5 units.\n- **Material**: `MeshStandardMaterial` gives the cone a purple color and realistic lighting.\n- **Positioning**: The cone is positioned at `(0.4, 0.75, -1.5)`.\n\n### 2. **Adding a Cube**\n\n```javascript\nconst cubeGeometry = new THREE.BoxGeometry(1, 1, 1);\nconst cubeMaterial = new THREE.MeshStandardMaterial({ color: 'orange' });\nconst cube = new THREE.Mesh(cubeGeometry, cubeMaterial);\nscene.add(cube);\ncube.position.set(-0.8, 0.5, -1.5);\ncube.rotateY(Math.PI / 4);\n```\n\n- **Geometry**: `BoxGeometry(1, 1, 1)` creates a 1x1x1 cube.\n- **Rotation**: The cube is rotated 45 degrees around the Y-axis using `rotateY(Math.PI / 4)`.\n\n### 3. **Adding a Sphere**\n\n```javascript\nconst sphereGeometry = new THREE.SphereGeometry(0.4);\nconst sphereMaterial = new THREE.MeshStandardMaterial({ color: 'red' });\nconst sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);\nscene.add(sphere);\nsphere.position.set(0.6, 0.4, -0.5);\nsphere.scale.set(1.2, 1.2, 1.2);\n```\n\n- **Geometry**: `SphereGeometry(0.4)` creates a sphere with a 0.4-unit radius.\n- **Scaling**: The sphere is scaled up by 20% using `scale.set(1.2, 1.2, 1.2)`.\n\n## Summary\n\nIn this chapter, you've learned how to combine geometry and material to form meshes and how to apply transformations such as positioning, rotation, and scaling to manipulate objects in 3D space. This foundational knowledge will be crucial as we move on to more advanced topics in the following chapters.\n\nHere’s what our scene looks like now:\n\n![Scene with Basic Objects](./assets/chapter1.png)\n"
    },
    {
      "filename": "cloned/webxr-first-steps/tutorial/chapter2.md",
      "content": "# Chapter 2: Working with Controllers\n\nIn Chapter 2, we’ll explore how to interact with a WebXR scene using VR controllers. By the end of this chapter, you'll be able to respond to controller inputs and trigger actions within your scene. Specifically, we’ll focus on detecting button presses and using them to spawn a “bullet” from the controller into the scene. In the next chapter, we’ll focus on moving these bullets, but for now, let’s focus on spawning them.\n\n## `onFrame` Function\n\nThe `onFrame` function is where we handle updates for every frame. It receives two key arguments in addition to the global variables in `setupScene`:\n\n- **`delta`**: The time since the last frame in seconds. This is useful for making time-based animations or movements.\n- **`time`**: The total elapsed time since the app started. This can be used for tracking overall progress or creating time-based effects.\n\nYou’ll use `onFrame` to check for controller input and trigger actions based on those inputs.\n\n## Introducing the Bullet\n\nTo start, we’ll introduce a bullet—a small gray sphere that will be fired from the controller when the trigger button is pressed. We will set it up as a global variable so that we can access it later in our frame loop and event handlers:\n\n```javascript\nconst bulletGeometry = new THREE.SphereGeometry(0.02);\nconst bulletMaterial = new THREE.MeshStandardMaterial({ color: 'gray' });\nconst bulletPrototype = new THREE.Mesh(bulletGeometry, bulletMaterial);\n```\n\n### Explanation:\n\n- **Bullet Geometry and Material**: The bullet is a small sphere with a radius of `0.02`, using a gray `MeshStandardMaterial`. This gives the bullet its shape and appearance.\n\n- **Cloning the Bullet**: The `bulletPrototype` is a mesh that we’ll clone each time we want to spawn a new bullet. Cloning is an efficient way to create multiple instances of an object. The cloned objects share the same geometry and material, which saves memory and ensures consistent appearance across all bullets.\n\n## Handling Controller Input\n\nNow, let’s handle the controller input within the `onFrame` function to spawn bullets when the trigger is pressed:\n\n```javascript\nimport { XR_BUTTONS } from 'gamepad-wrapper';\n\nfunction onFrame(\n\tdelta,\n\ttime,\n\t{ scene, camera, renderer, player, controllers },\n) {\n\tif (controllers.right) {\n\t\tconst { gamepad, raySpace } = controllers.right;\n\t\tif (gamepad.getButtonClick(XR_BUTTONS.TRIGGER)) {\n\t\t\tconst bullet = bulletPrototype.clone();\n\t\t\tscene.add(bullet);\n\t\t\traySpace.getWorldPosition(bullet.position);\n\t\t\traySpace.getWorldQuaternion(bullet.quaternion);\n\t\t}\n\t}\n}\n```\n\n### Explanation:\n\n- **Controller Detection**: The `if (controllers.right)` check ensures that a right-hand controller is connected and active.\n\n- **Button Press Handling**: We use `gamepad.getButtonClick(XR_BUTTONS.TRIGGER)` to detect when the trigger button is pressed during the current frame on the right controller. This functionality is provided by the `gamepad-wrapper` library, which tracks the state of gamepad buttons frame by frame. This ensures that you can reliably detect events such as single button presses. For more information, you can refer to the gamepad-wrapper [documentation](https://github.com/felixtrz/gamepad-wrapper)\n\n- **Spawning the Bullet**: When the trigger is pressed, we clone the `bulletPrototype` to create a new bullet and add it to the scene with `scene.add(bullet)`.\n\n- **Bullet Positioning**: The `raySpace.getWorldPosition(bullet.position)` method sets the bullet’s position to the world position of the controller's ray space. This is necessary because the controller ray space and the bullet do not share the same parent in the scene graph. The bullet’s parent is the `scene`, meaning its position is interpreted as its world position. Therefore, to correctly position the bullet at the controller’s tip, we retrieve the ray space’s world position and apply it directly to the bullet.\n\n### Explanation:\n\n- **Controller Detection**: The `if (controllers.right)` check ensures that a right-hand controller is connected and active.\n\n- **Button Press Handling**: We use `gamepad.getButtonClick(XR_BUTTONS.TRIGGER)` to detect when the trigger button is pressed during the current frame on the right controller. This functionality is provided by the `gamepad-wrapper` library, which tracks the state of gamepad buttons frame by frame. This ensures that you can reliably detect events such as single button presses. For more information, you can refer to the gamepad-wrapper [documentation](https://github.com/felixtrz/gamepad-wrapper).\n\n- **Spawning the Bullet**: When the trigger is pressed, we clone the `bulletPrototype` to create a new bullet and add it to the scene with `scene.add(bullet)`.\n\n- **Controller Ray Space**: The `raySpace` represents the XR controller's ray-casting direction and position in 3D space. It is a special object managed by Three.js that represents where the user is pointing. In VR, ray spaces are often used to interact with objects in the world by projecting a laser-like ray from the controller. In this case, we use the `raySpace` to determine the origin and direction for spawning bullets, ensuring that they are fired from the controller's tip and in the right direction.\n\n- **Bullet Positioning**: The `raySpace.getWorldPosition(bullet.position)` method sets the bullet’s position to the world position of the controller's ray space. This is necessary because the controller ray space and the bullet do not share the same parent in the scene graph. The bullet’s parent is the `scene`, meaning its position is interpreted as its world position. Therefore, to correctly position the bullet at the controller’s tip, we retrieve the ray space’s world position and apply it directly to the bullet.\n\n- **Bullet Orientation**: In addition to positioning, we need to correctly orient the bullet. The method `raySpace.getWorldQuaternion(bullet.quaternion)` retrieves the world quaternion (i.e., orientation) of the controller's ray space and applies it to the bullet. This ensures the bullet is aligned with the controller’s orientation when fired. Without this step, the bullet might spawn in the correct location but at the wrong angle, leading to unintended behavior later when we animate it.\n\n## Summary\n\nIn this chapter, you’ve learned how to interact with your WebXR scene using a VR controller. We introduced the concept of detecting controller input and used it to spawn bullets into the scene when the trigger button is pressed. This sets the stage for more complex interactions, like moving these bullets, which we’ll cover in the next chapter.\n\nHere’s what our scene looks like after adding the bullet spawning feature:\n\n![Scene with Bullet](./assets/chapter2.png)\n"
    },
    {
      "filename": "cloned/webxr-first-steps/tutorial/chapter3.md",
      "content": "# Chapter 3: Animating Bullet Objects\n\nIn this chapter, we’ll focus on animating the bullets that we spawned in the previous chapter. Specifically, we’ll make the bullets move forward in the direction the controller is pointing and disappear after a short duration. This involves managing the bullets’ movement, ensuring they don’t remain in the scene indefinitely, and updating their positions each frame.\n\n## Constants for Bullet Behavior\n\nWe begin by defining constants that will control the behavior of the bullets:\n\n```javascript\nconst forwardVector = new THREE.Vector3(0, 0, -1);\nconst bulletSpeed = 5;\nconst bulletTimeToLive = 1;\n```\n\n- **`forwardVector`**: This vector points forward along the negative Z-axis. It represents the default direction in which bullets will move.\n- **`bulletSpeed`**: Sets the speed of the bullets, meaning they will travel 5 units per second.\n- **`bulletTimeToLive`**: Determines how long each bullet will remain active in the scene (1 second). This ensures bullets that are no longer visible are removed to prevent performance degradation over time.\n\n## Managing Active Bullets\n\nWe use an object to keep track of all active bullets:\n\n```javascript\nconst bullets = {};\n```\n\n- **`bullets`**: This object stores all active bullets using their unique IDs (`uuid`). This allows us to manage and update each bullet individually during every frame.\n\n## Setting Up Bullet Velocity and Lifespan\n\nIn our `onFrame` function, when a bullet is fired, we calculate its movement direction and assign it a time-to-live (TTL):\n\n```javascript\nif (controllers.right) {\n\tconst { gamepad, raySpace } = controllers.right;\n\tif (gamepad.getButtonClick(XR_BUTTONS.TRIGGER)) {\n\t\tconst bullet = bulletPrototype.clone();\n\t\tscene.add(bullet);\n\t\traySpace.getWorldPosition(bullet.position);\n\t\traySpace.getWorldQuaternion(bullet.quaternion);\n\n\t\tconst directionVector = forwardVector\n\t\t\t.clone()\n\t\t\t.applyQuaternion(bullet.quaternion);\n\t\tbullet.userData = {\n\t\t\tvelocity: directionVector.multiplyScalar(bulletSpeed),\n\t\t\ttimeToLive: bulletTimeToLive,\n\t\t};\n\t\tbullets[bullet.uuid] = bullet;\n\t}\n}\n```\n\n### Explanation:\n\n- **`globalQuaternion`**: This represents the controller’s orientation in world space. By getting the world quaternion of the controller’s ray space, we capture how the controller is rotated in 3D space.\n\n- **`directionVector`**: To determine the direction in which the bullet will move, we take the `forwardVector` and apply the `globalQuaternion` to it. This rotates the forward vector to match the orientation of the controller. This step is crucial because it ensures that bullets are fired in the direction the controller is pointing, regardless of its rotation.\n\n- **`userData`**: Three.js provides a built-in `userData` property on all `Object3D` instances, which we can use to store custom information about our objects. Here, we store the bullet’s velocity (its movement direction and speed) and its TTL. This data will be used to update the bullet’s position and ensure it’s removed after its lifespan ends.\n\n## Updating Bullet Positions and Lifespan\n\nEach frame, we update the bullets' positions and reduce their TTL:\n\n```javascript\nObject.values(bullets).forEach((bullet) => {\n\tif (bullet.userData.timeToLive < 0) {\n\t\tdelete bullets[bullet.uuid];\n\t\tscene.remove(bullet);\n\t\treturn;\n\t}\n\tconst deltaVec = bullet.userData.velocity.clone().multiplyScalar(delta);\n\tbullet.position.add(deltaVec);\n\tbullet.userData.timeToLive -= delta;\n});\n```\n\n### Explanation:\n\n- **Lifespan Check**: Each bullet’s TTL decreases over time. Once the TTL drops below zero, the bullet is removed from both the scene and the `bullets` object to free up resources and maintain performance.\n\n- **Position Update**: The bullet’s position is updated by moving it along its velocity vector, scaled by `delta` (the time since the last frame). This makes the bullet move forward at the correct speed each frame.\n\n## Summary\n\nIn this chapter, you’ve enhanced your WebXR scene by animating the bullets. Now, when fired, the bullets travel in the direction the controller is pointing and disappear after a set time. This addition introduces dynamic motion into your scene and helps maintain performance by cleaning up bullets after they’re no longer needed.\n\nHere’s what our scene looks like with the bullet animation feature:\n\n![Scene with Bullet Animation](./assets/chapter3.png)\n"
    },
    {
      "filename": "cloned/webxr-first-steps/tutorial/chapter4.md",
      "content": "# Chapter 4: Replacing Basic Objects with GLTF Models\n\nIn this chapter, we’ll take your WebXR experience to the next level by replacing the basic geometries we've used so far with detailed 3D models loaded from GLTF files. GLTF is a popular format for transmitting 3D models on the web because it's compact, efficient, and easy to use in Three.js.\n\n## Loading GLTF Models\n\nWe’ll use the `GLTFLoader` from Three.js to load our 3D models. The models we’ll be using are a space station, a blaster, and a set of targets. Here’s how we load and set them up in the scene:\n\n### Setting Up the Scene\n\n```javascript\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';\n\n// global variables\nconst blasterGroup = new THREE.Group();\nconst targets = []; // array to keep track of targets, we will need to use this later\n\nfunction setupScene({ scene, camera, renderer, player, controllers }) {\n\tconst gltfLoader = new GLTFLoader();\n\n\t// Load the space station environment\n\tgltfLoader.load('assets/spacestation.glb', (gltf) => {\n\t\tscene.add(gltf.scene);\n\t});\n\n\t// Load the blaster model\n\tgltfLoader.load('assets/blaster.glb', (gltf) => {\n\t\tblasterGroup.add(gltf.scene);\n\t});\n\n\t// Load and clone the target models\n\tgltfLoader.load('assets/target.glb', (gltf) => {\n\t\tfor (let i = 0; i < 3; i++) {\n\t\t\tconst target = gltf.scene.clone();\n\t\t\t// spawn targets at random locations in front of the player\n\t\t\ttarget.position.set(\n\t\t\t\tMath.random() * 10 - 5,\n\t\t\t\ti * 2 + 1,\n\t\t\t\t-Math.random() * 5 - 5,\n\t\t\t);\n\t\t\tscene.add(target);\n\t\t\ttargets.push(target);\n\t\t}\n\t});\n}\n```\n\n### Explanation:\n\n- **GLTFLoader**: We use `GLTFLoader` to load 3D models from GLTF files. Each model is loaded asynchronously, and once loaded, it’s added to the scene or another relevant group (like the blaster group).\n\n- **Space Station**: The space station model is added directly to the scene, providing an immersive environment for your WebXR experience. Here’s how it looks:\n\n  ![Space Station Model](./assets/spaces-station.png)\n\n- **Blaster**: We created the `blasterGroup` as an empty `THREE.Group` to house the blaster model. This way we can manipulate its transform right away without waiting for the blaster model to finish loading. The blaster model is added to the `blasterGroup`, which will be attached to the right controller when the user interacts with it. Here’s a glimpse of the blaster:\n\n  ![Blaster Model](./assets/blaster.png)\n\n- **Targets**: Three instances of the target model are created by cloning the original model. Each target is randomly positioned within the scene, providing dynamic and varied locations for the user to aim at. Here's what it looks like:\n\n  ![Target Model](./assets/target.png)\n\n## Attaching the Blaster to the Controller\n\nThe blaster model is attached to the right controller when it first comes alive (after entering VR). We do this in the `onFrame` function rather than `setupScene` because we need to wait for the controller to be active:\n\n```javascript\nfunction onFrame(\n\tdelta,\n\ttime,\n\t{ scene, camera, renderer, player, controllers },\n) {\n\tif (controllers.right) {\n\t\tconst { gamepad, raySpace, mesh } = controllers.right;\n\n\t\t// Attach the blaster to the right controller\n\t\tif (!raySpace.children.includes(blasterGroup)) {\n\t\t\traySpace.add(blasterGroup);\n\t\t\tmesh.visible = false; // Hide the default controller model\n\t\t}\n\n\t\t// Firing bullets\n\t\tif (gamepad.getButtonClick(XR_BUTTONS.TRIGGER)) {\n\t\t\t// use the embedded bullet as prototype\n\t\t\tconst bulletPrototype = blasterGroup.getObjectByName('bullet');\n\t\t\tif (bulletPrototype) {\n\t\t\t\tconst bullet = bulletPrototype.clone();\n\t\t\t\tscene.add(bullet);\n\t\t\t\t// copy position and quaternion directly from the bulletPrototype, instead of from raySpace\n\t\t\t\tbulletPrototype.getWorldPosition(bullet.position);\n\t\t\t\tbulletPrototype.getWorldQuaternion(bullet.quaternion);\n\t\t\t\t// ...  unchanged logic\n\t\t\t}\n\t\t}\n\t}\n\t// ...  unchanged logic\n}\n```\n\n### Explanation:\n\n- **Attaching the Blaster**: The blaster model is attached to the right controller’s ray space. This is done in `onFrame` because the controller becomes active only after entering VR. Once attached, the default controller model is hidden by setting `mesh.visible = false`.\n\n- **Embedded Bullet Prototype**: The bullet prototype is now embedded within the blaster model. This prototype serves two purposes: it acts as the base for cloning new bullets, and it serves as a marker from which we can read the starting position and orientation of each bullet. Here’s how it looks inside the blaster:\n\n  ![Embedded Bullet Prototype](./assets/blaster-with-bullet.png)\n\n- **Bullet Firing**: When the trigger is pressed, a new bullet is cloned from the prototype, and its position and orientation are set to match the blaster. The bullet is then added to the scene and animated as described in previous chapters.\n\n## Summary\n\nIn this chapter, you’ve replaced basic geometric shapes with detailed GLTF models, enhancing the realism and immersion of your WebXR experience. You’ve also attached the blaster model to the controller, allowing for a more integrated and interactive shooting experience. Additionally, the bullet prototype embedded in the blaster serves as both a cloning source and a position/orientation marker. In the next chapters, we’ll continue to build on this foundation by adding more complex interactions and gameplay elements.\n\nHere’s what our scene looks like with the GLTF models:\n\n![Scene with GLTF Models](./assets/chapter4.png)\n"
    },
    {
      "filename": "cloned/webxr-first-steps/tutorial/chapter5.md",
      "content": "# Chapter 5: Making It a Game\n\nIn this chapter, we’ll turn your WebXR experience into a simple game by adding a proximity-based hit test for the targets and implementing a scoreboard to track the player’s score. These additions will make your scene more interactive and engaging, providing immediate feedback when a target is hit.\n\n## Setting Up the Scoreboard\n\nTo display the score, we’ll use the `troika-three-text` library, which allows us to render high-quality text in Three.js. The score will be displayed on a monitor in the space station scene, giving the player a clear view of their progress.\n\n### Scoreboard Setup\n\nFirst, we define the score text and an `updateScoreDisplay` function to manage the scoreboard:\n\n```javascript\nimport { Text } from 'troika-three-text';\nlet score = 0;\nconst scoreText = new Text();\nscoreText.fontSize = 0.52;\nscoreText.font = 'assets/SpaceMono-Bold.ttf';\nscoreText.position.z = -2;\nscoreText.color = 0xffa276;\nscoreText.anchorX = 'center';\nscoreText.anchorY = 'middle';\n\nfunction updateScoreDisplay() {\n\tconst clampedScore = Math.max(0, Math.min(9999, score));\n\tconst displayScore = clampedScore.toString().padStart(4, '0');\n\tscoreText.text = displayScore;\n\tscoreText.sync();\n}\n```\n\n#### Explanation:\n\n- **Score Text Setup**: The `Text` object is used to display the score. We configure its font size, color, and position, ensuring it fits well within the scene.\n- **`updateScoreDisplay` Function**: This function updates the score text whenever the score changes. It clamps the score between 0 and 9999 and formats it to be a four-digit number, which is then displayed on the monitor.\n\n### Adding the Scoreboard to the Scene\n\nNext, we add the score text to the scene in `setupScene`:\n\n```javascript\nfunction setupScene({ scene, camera, renderer, player, controllers }) {\n\t// Other setup code...\n\n\t// Add the score text to the scene\n\tscene.add(scoreText);\n\tscoreText.position.set(0, 0.67, -1.44);\n\tscoreText.rotateX(-Math.PI / 3.3);\n\tupdateScoreDisplay();\n}\n```\n\n#### Explanation:\n\n- **Score Text Positioning**: The score text is positioned and rotated to align with a monitor in the space station scene, making it look like the monitor is displaying the player's score. You will need to adjust it if you are using a different environment.\n\n## Implementing Proximity-Based Hit Test\n\nTo determine whether a bullet hits a target, we use a proximity-based hit test. This method checks the distance between the bullet and each target, and if they’re close enough, the target is considered “hit”:\n\n```javascript\nfunction onFrame() {\n\t// ... unchanged params\n\tObject.values(bullets).forEach((bullet) => {\n\t\t// ... unchanged logic\n\t\ttargets\n\t\t\t.filter((target) => target.visible)\n\t\t\t.forEach((target) => {\n\t\t\t\tconst distance = target.position.distanceTo(bullet.position);\n\t\t\t\tif (distance < 1) {\n\t\t\t\t\tdelete bullets[bullet.uuid];\n\t\t\t\t\tscene.remove(bullet);\n\n\t\t\t\t\t// make target disappear, and then reappear at a different place after 2 seconds\n\t\t\t\t\ttarget.visible = false;\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\ttarget.visible = true;\n\t\t\t\t\t\ttarget.position.x = Math.random() * 10 - 5;\n\t\t\t\t\t\ttarget.position.z = -Math.random() * 5 - 5;\n\t\t\t\t\t}, 2000);\n\n\t\t\t\t\tscore += 10; // Update the score when a target is hit\n\t\t\t\t\tupdateScoreDisplay(); // Update the rendered troika-three-text object\n\t\t\t\t}\n\t\t\t});\n\t});\n}\n```\n\n### Explanation:\n\n- **Proximity-Based Hit Test**: This method checks if the distance between the bullet and a target is less than 1 unit. If it is, the bullet is removed from the scene, and the target is temporarily hidden.\n- **Updating the Score**: Each time a target is hit, the score is increased by 10 points, and the `updateScoreDisplay` function is called to refresh the displayed score.\n- **Respawning Targets**: After 2 seconds, the target becomes visible again and is repositioned randomly within the scene.\n\n- **Why Proximity-Based?**: This approach is simple and effective for our scenario because the targets are round and facing the player. However, for more advanced and reliable hit detection, especially with irregularly shaped objects or targets that aren’t facing the player, you would need to look into using raycasting.\n\n## Summary\n\nIn this chapter, you’ve transformed your WebXR scene into a simple game by adding hit detection and a scoreboard. The proximity-based hit test provides a straightforward way to register hits, while the scoreboard keeps track of the player’s score, making the game more engaging and interactive.\n\nHere’s what your game looks like now:\n\n![Gameplay Screenshot](./assets/chapter5.gif)\n"
    },
    {
      "filename": "cloned/webxr-first-steps/tutorial/chapter6.md",
      "content": "# Chapter 6: Finishing Touches\n\nNow that you have a fully functioning WebXR game, it's time to add some finishing touches to enhance the overall experience. In this final chapter, we'll introduce audio, haptic feedback, and visual effects to make your game more immersive and engaging. These elements will provide immediate feedback to the player, making the game feel more polished and interactive.\n\n## Adding Audio Feedback\n\nWe’ll start by adding audio feedback for firing the blaster and scoring points. Three.js provides a straightforward way to handle audio using its audio system, which we’ll leverage here.\n\n### Setting Up Audio\n\nFirst, we declare global variables for the sounds:\n\n```javascript\nlet laserSound, scoreSound;\n```\n\nNext, inside the `setupScene` function, we create an audio listener and load the positional audio files:\n\n```javascript\nfunction setupScene({ scene, camera, renderer, player, controllers }) {\n\t// Other setup code...\n\n\t// Load and set up positional audio\n\tconst listener = new THREE.AudioListener();\n\tcamera.add(listener);\n\n\tconst audioLoader = new THREE.AudioLoader();\n\n\t// Laser sound\n\tlaserSound = new THREE.PositionalAudio(listener);\n\taudioLoader.load('assets/laser.ogg', (buffer) => {\n\t\tlaserSound.setBuffer(buffer);\n\t\tblasterGroup.add(laserSound);\n\t});\n\n\t// Score sound\n\tscoreSound = new THREE.PositionalAudio(listener);\n\taudioLoader.load('assets/score.ogg', (buffer) => {\n\t\tscoreSound.setBuffer(buffer);\n\t\tscoreText.add(scoreSound);\n\t});\n}\n```\n\n### Explanation:\n\n- **Audio Listener**: The `AudioListener` is essentially the \"ears\" of the camera. It’s necessary for hearing the sounds in the scene. We attach it to the camera so that the audio follows the player's perspective.\n\n- **Positional Audio**: We use `PositionalAudio` to make the sounds feel like they’re coming from specific points in the 3D space. The laser sound is attached to the blaster, and the score sound is attached to the scoreboard text.\n\n### Playing the Sounds\n\nWe trigger the sounds when appropriate actions occur:\n\n- **Firing the Blaster**:\n\n  ```javascript\n  if (laserSound.isPlaying) laserSound.stop();\n  laserSound.play();\n  ```\n\n- **Scoring Points**:\n\n  ```javascript\n  if (scoreSound.isPlaying) scoreSound.stop();\n  scoreSound.play();\n  ```\n\nThis ensures that the sounds are played without overlap, providing clear audio feedback to the player.\n\n## Adding Haptic Feedback\n\nTo enhance the tactile experience, we add haptic feedback when the player fires the blaster. This simple vibration adds a layer of immersion, making the action feel more impactful:\n\n```javascript\ntry {\n\tconst hapticActuator = gamepad.getHapticActuator(0).pulse(0.6, 100);\n} catch {}\n```\n\n### Explanation:\n\n- **Haptic Feedback**: The `pulse` method triggers a short vibration at 60% intensity for 100 milliseconds.\n- **Try-Catch Block**: We use a try-catch block to ensure that the application doesn’t crash on devices that don’t have haptic actuators.\n\n## Adding Visual Feedback\n\nFinally, we enhance the visual feedback when a target is hit by animating its disappearance and reappearance using GSAP. Instead of having the target abruptly disappear and reappear, we smoothly scale it down and back up. Let's first locate the target disappear/reappear logic based on `setTimeout`:\n\n```javascript\ntarget.visible = false;\nsetTimeout(() => {\n\ttarget.visible = true;\n\ttarget.position.x = Math.random() * 10 - 5;\n\ttarget.position.z = -Math.random() * 5 - 5;\n}, 2000);\n```\n\nAnd replace it with:\n\n```javascript\nimport { gsap } from 'gsap';\n\ngsap.to(target.scale, {\n\tduration: 0.3,\n\tx: 0,\n\ty: 0,\n\tz: 0,\n\tonComplete: () => {\n\t\ttarget.visible = false;\n\t\tsetTimeout(() => {\n\t\t\ttarget.visible = true;\n\t\t\ttarget.position.x = Math.random() * 10 - 5;\n\t\t\ttarget.position.z = -Math.random() * 5 - 5;\n\n\t\t\t// Scale back up the target\n\t\t\tgsap.to(target.scale, {\n\t\t\t\tduration: 0.3,\n\t\t\t\tx: 1,\n\t\t\t\ty: 1,\n\t\t\t\tz: 1,\n\t\t\t});\n\t\t}, 1000);\n\t},\n});\n```\n\n### Explanation:\n\n- **Scaling Down**: When a target is hit, it scales down to zero over 0.3 seconds, creating a smooth disappearing effect.\n- **Respawning with Animation**: After 1 second, the target reappears, scaling back up to its original size over 0.3 seconds. This makes the reappearance feel smooth and natural.\n-\n\n### Final Step: Updating the GSAP Ticker\n\nTo ensure GSAP animations are synchronized with your WebXR frame updates, include this at the end of your `onFrame` function:\n\n```javascript\ngsap.ticker.tick(delta);\n```\n\n## Congratulations!\n\nCongratulations! You’ve completed the entire WebXR First Steps tutorial and built a fully immersive and interactive game. Here’s a final look at your game in action:\n\n![Shrinking Targets](./assets/chapter6.gif)\n\n## What's Next?\n\nAlthough the tutorial is over, your journey with WebXR has just begun. There are countless ways to expand and enhance your game. Here are some ideas to get you started:\n\n- **Dual Wielding**: Add a second blaster to the other controller for dual-wielding action.\n- **Timed Challenge**: Introduce a timer to make it a race against the clock.\n- **Moving Targets**: Make the targets move around to increase the difficulty.\n- **Exploding Targets**: Add visual effects to make the targets explode when hit.\n- **And More!**: Your imagination is the limit—experiment, add new features, and make the game truly your own!\n\nThank you for following along with this tutorial. I hope it’s been a fun and educational journey into the world of WebXR. Happy coding!\n"
    }
  ]
}