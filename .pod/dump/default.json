{
  "version": "0.0.62",
  "files": [
    {
      "filename": "src/App.vue",
      "content": "<template>\n  <div class=\"relative w-full h-screen bg-[#36363f] overflow-hidden\">\n    <!-- 3D Viewport -->\n    <div class=\"absolute inset-0 z-0\">\n        <CodeGraph \n          ref=\"codeGraphRef\"\n          v-if=\"graphData\" \n          :data=\"graphData\" \n          :selected-node-id=\"selectedNode?.id\"\n          @select=\"onNodeSelect\" \n        />\n        <div v-else class=\"w-full h-full flex items-center justify-center text-zinc-500\">\n           {{ loading ? 'Scanning...' : 'Ready to scan' }}\n        </div>\n    </div>\n\n    <!-- Top Right: Controls & Path -->\n    <div class=\"absolute top-4 right-4 z-10 flex flex-col gap-2 w-72\">\n      <!-- Path & Scan -->\n      <div class=\"relative\">\n        <div class=\"bg-zinc-900/80 backdrop-blur border border-zinc-800 rounded-lg p-2 flex items-center gap-2 shadow-lg\">\n          <div class=\"px-2\">\n              <div class=\"w-2 h-2 rounded-full\" :class=\"loading ? 'bg-yellow-500 animate-pulse' : 'bg-green-500'\"></div>\n          </div>\n          <input \n              v-model=\"scanPath\" \n              @keyup.enter=\"fetchGraph\" \n              class=\"bg-transparent border-none text-xs text-zinc-200 focus:outline-none w-full placeholder-zinc-600\"\n              placeholder=\"/absolute/path/to/project\"\n              @focus=\"showHistory = true\"\n          />\n          <button \n            v-if=\"historyStore.recentPaths.length > 0\" \n            @click=\"showHistory = !showHistory\"\n            class=\"text-zinc-500 hover:text-zinc-300 px-1\"\n          >\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"6 9 12 15 18 9\"></polyline></svg>\n          </button>\n          \n          <button \n              @click=\"fetchGraph\" \n              class=\"bg-blue-600 hover:bg-blue-500 text-white text-xs px-3 py-1.5 rounded transition-colors whitespace-nowrap\"\n              :disabled=\"loading\"\n          >\n              {{ loading ? '...' : 'Scan' }}\n          </button>\n\n          <button \n              @click=\"fetchGraph\" \n              class=\"bg-zinc-700 hover:bg-zinc-600 text-zinc-300 p-1.5 rounded transition-colors\"\n              title=\"Refresh Project\"\n              :disabled=\"loading\"\n          >\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3\"/></svg>\n          </button>\n        </div>\n\n        <!-- History Dropdown -->\n        <div v-if=\"showHistory && historyStore.recentPaths.length > 0\" class=\"absolute top-full left-0 w-full mt-1 bg-zinc-900/95 backdrop-blur border border-zinc-800 rounded-lg shadow-xl overflow-hidden z-30\">\n          <div \n            v-for=\"path in historyStore.recentPaths\" \n            :key=\"path\" \n            @click=\"selectPath(path)\"\n            class=\"px-4 py-2 text-xs text-zinc-400 hover:bg-zinc-800 hover:text-white cursor-pointer truncate border-b border-zinc-800/50 last:border-0 transition-colors\"\n          >\n            {{ path }}\n          </div>\n        </div>\n      </div>\n      \n      <div v-if=\"graphData && graphData.stats\" class=\"bg-zinc-900/50 backdrop-blur rounded px-2 py-1 text-[10px] text-zinc-500 border border-zinc-800/50 self-start\">\n         {{ graphData.stats.files }} files · {{ graphData.stats.nodes }} nodes · {{ graphData.stats.links }} links\n      </div>\n      \n      <div v-if=\"error\" class=\"text-red-400 text-xs bg-red-900/20 border border-red-900/50 p-2 rounded\">\n          {{ error }}\n      </div>\n      \n      <!-- Config Toggle -->\n      <button \n        @click=\"showConfig = !showConfig\" \n        class=\"text-xs bg-zinc-900/80 backdrop-blur border border-zinc-800 text-zinc-400 hover:text-white px-2 py-1 rounded self-start flex items-center gap-1\"\n      >\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z\"></path><circle cx=\"12\" cy=\"12\" r=\"3\"></circle></svg>\n        Graph Settings\n      </button>\n\n      <div v-if=\"showConfig\" class=\"absolute top-full mt-2 left-0 z-50\">\n         <ConfigPanel />\n      </div>\n    </div>\n\n    <!-- Graph Explorer (Left Side) -->\n    <div class=\"absolute top-4 left-4 z-20 pointer-events-none\">\n       <div class=\"pointer-events-auto\">\n         <GraphExplorer \n            :data=\"graphData\" \n            :selected-node=\"selectedNode\" \n            @select=\"onNodeSelect\" \n            @close=\"onNodeSelect(null)\" \n            @focus-group=\"onFocusGroup\"\n         />\n       </div>\n    </div>\n\n    <!-- Bottom Help -->\n    <div class=\"absolute bottom-4 right-4 z-10 text-xs text-zinc-600 text-right\">\n       LMB: Rotate | RMB: Pan | Scroll: Zoom | RMB+Drag: Lock Node\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onBeforeUnmount, watch } from 'vue'\nimport CodeGraph from './components/CodeGraph.vue'\nimport GraphExplorer from './components/GraphExplorer.vue'\nimport ConfigPanel from './components/ConfigPanel.vue'\nimport type { GraphData, GraphNode } from './types/graph'\nimport { useHistoryStore } from './stores/history'\n\nconst historyStore = useHistoryStore()\nconst codeGraphRef = ref<InstanceType<typeof CodeGraph> | null>(null)\n\nconst selectedNode = ref<GraphNode | null>(null)\nconst graphData = ref<GraphData | null>(null)\nconst scanPath = ref('')\nconst loading = ref(false)\nconst error = ref<string | null>(null)\nconst showHistory = ref(false)\nconst showConfig = ref(false)\n\nasync function fetchGraph() {\n  loading.value = true\n  error.value = null\n  graphData.value = null\n  showHistory.value = false\n  selectedNode.value = null\n  \n  try {\n      const params = new URLSearchParams()\n      if (scanPath.value) params.append('path', scanPath.value)\n      \n      const res = await fetch(`/api/graph?${params.toString()}`)\n      if (!res.ok) {\n          const err = await res.json()\n          throw new Error(err.error || 'Failed to scan')\n      }\n      const data = await res.json()\n      graphData.value = data\n      \n      if (data.path) {\n        scanPath.value = data.path\n        historyStore.addPath(data.path)\n\n        // Sync URL Path\n        const url = new URL(window.location.href)\n        if (url.searchParams.get('path') !== data.path) {\n            url.searchParams.set('path', data.path)\n            url.searchParams.delete('node')\n            window.history.pushState({ path: data.path }, '', url.toString())\n        }\n      }\n      \n      // Restore selection from URL if present\n      syncSelectionFromUrl(data)\n\n  } catch (e: any) {\n      console.error(e)\n      error.value = e.message\n  } finally {\n      loading.value = false\n  }\n}\n\nfunction selectPath(path: string) {\n  scanPath.value = path\n  showHistory.value = false\n  fetchGraph()\n}\n\nfunction onNodeSelect(node: GraphNode | null, updateHistory = true) {\n  selectedNode.value = node\n  if (node) {\n     if (codeGraphRef.value) {\n        codeGraphRef.value.focusNode(node.id)\n     }\n     if (updateHistory) {\n         const url = new URL(window.location.href)\n         url.searchParams.set('node', node.id)\n         window.history.pushState({ nodeId: node.id }, '', url.toString())\n     }\n  } else {\n     if (updateHistory) {\n         const url = new URL(window.location.href)\n         url.searchParams.delete('node')\n         window.history.pushState({}, '', url.toString())\n     }\n  }\n}\n\nfunction onFocusGroup(nodeIds: string[]) {\n   // TODO: Implement group focus in CodeGraph\n   // For now, just pick the first one to fly to\n   if(nodeIds.length > 0) {\n      const first = graphData.value?.nodes.find(n => n.id === nodeIds[0])\n      if (first && codeGraphRef.value) {\n          codeGraphRef.value.focusNode(first.id)\n      }\n   }\n}\n\n// --- Browser History Integration ---\nfunction syncSelectionFromUrl(data: GraphData) {\n    const url = new URL(window.location.href)\n    const nodeId = url.searchParams.get('node')\n    if (nodeId) {\n        const node = data.nodes.find(n => n.id === nodeId)\n        if (node) {\n            setTimeout(() => {\n                onNodeSelect(node, false)\n            }, 500)\n        }\n    }\n}\n\nfunction handlePopState(event: PopStateEvent) {\n    const url = new URL(window.location.href)\n    const newPath = url.searchParams.get('path') || ''\n    \n    // Path Change\n    if (newPath !== scanPath.value) {\n        scanPath.value = newPath\n        fetchGraph()\n        return\n    }\n\n    if (!graphData.value) return\n    const nodeId = url.searchParams.get('node')\n    \n    if (nodeId) {\n        const node = graphData.value.nodes.find(n => n.id === nodeId)\n        if (node) {\n            onNodeSelect(node, false)\n        }\n    } else {\n        onNodeSelect(null, false)\n    }\n}\n\nonMounted(() => {\n  const url = new URL(window.location.href)\n  const queryPath = url.searchParams.get('path')\n\n  if (queryPath) {\n    scanPath.value = queryPath\n    fetchGraph()\n  } else if (historyStore.lastPath) {\n    scanPath.value = historyStore.lastPath\n    fetchGraph()\n  } else {\n    fetchGraph()\n  }\n  \n  window.addEventListener('popstate', handlePopState)\n})\n\nonBeforeUnmount(() => {\n    window.removeEventListener('popstate', handlePopState)\n})\n</script>\n"
    },
    {
      "filename": "src/components/CodeGraph.vue",
      "content": "<template>\n  <div \n    ref=\"container\" \n    class=\"w-full h-full\" \n    @contextmenu.prevent \n    @mousedown=\"onContainerMouseDown\"\n  ></div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onBeforeUnmount, watch, computed } from 'vue'\nimport * as THREE from 'three'\nimport ForceGraph3D from '3d-force-graph'\nimport type { GraphData, GraphNode, GraphLink } from '../types/graph'\nimport { useGraphConfigStore } from '../stores/graphConfig'\n\nconst props = defineProps<{\n  data: GraphData\n  selectedNodeId?: string\n}>()\n\nconst emit = defineEmits<{ (e: 'select', node: GraphNode | null): void }>()\n\nconst container = ref<HTMLElement | null>(null)\nconst config = useGraphConfigStore()\nlet graph: any = null\nlet resizeObserver: ResizeObserver | null = null\nconst draggedNode = ref<GraphNode | null>(null)\n\n// Highlight State\nconst highlightNodes = new Set<string>()\nconst highlightLinks = new Set<any>()\nlet hoverNode: GraphNode | null = null\n\nconst displayData = computed(() => {\n  if (!props.data) return { nodes: [], links: [] }\n  \n  if (config.onlyShowCycles) {\n    return {\n      nodes: props.data.nodes.filter(n => n.cycle),\n      links: props.data.links.filter(l => l.cycle)\n    }\n  }\n  return props.data\n})\n\nonMounted(() => {\n  if (container.value) {\n    initGraph()\n    if (props.data) {\n      updateGraph(props.data)\n    }\n\n    resizeObserver = new ResizeObserver(() => {\n      if (graph && container.value) {\n        graph.width(container.value.clientWidth)\n        graph.height(container.value.clientHeight)\n      }\n    })\n    resizeObserver.observe(container.value)\n  }\n})\n\nonBeforeUnmount(() => {\n  if (resizeObserver) resizeObserver.disconnect()\n  if (graph) graph._destructor()\n})\n\n// React to Data Changes\nwatch(displayData, (newData) => {\n  if (graph) updateGraph(newData)\n}, { deep: true })\n\n// React to Config Changes\nwatch(\n  () => [\n    config.backgroundColor, \n    config.nodeRelSize, \n    config.linkWidth, \n    config.linkOpacity,\n    config.linkDirectionalParticles,\n    config.chargeStrength,\n    config.dagMode,\n    config.dagLevelDistance,\n    config.forceEngine,\n    config.numDimensions,\n    config.directionalArrows,\n    config.linkCurvature\n  ], \n  () => {\n    if (graph) applyConfig()\n  }\n)\n\nwatch(() => config.hoverHighlight, () => {\n  updateHighlights() // Trigger visual refresh\n})\n\nwatch(() => props.selectedNodeId, () => {\n    computeHighlights()\n})\n\n// Re-create geometries (LODs) when label distance changes\nwatch(() => config.labelVisibleDistance, () => {\n  if (graph) setupGeometries()\n})\n\n// Re-create geometries when cycle highlight changes\nwatch(() => config.highlightCycles, () => {\n    if (graph) {\n        setupGeometries()\n        // Update link colors without full rebuild if possible, but setupGeometries handles node colors\n        graph.linkColor(graph.linkColor()) // Force link update\n    }\n})\n\nfunction getHealthColor(node: GraphNode) {\n  if (config.highlightCycles && node.cycle) return '#ff00ff' // Magenta for cycles\n  const errors = node.errorCount || 0;\n  if (errors === 0) return '#22c55e' // Green\n  if (errors < 3) return '#eab308'   // Yellow\n  if (errors < 10) return '#f97316'  // Orange\n  return '#ef4444'                   // Red\n}\n\nfunction initGraph() {\n  graph = ForceGraph3D()(container.value!)\n    .nodeLabel(null) // Disable default hover tooltip\n    .onNodeClick((node: any) => {\n      emit('select', node)\n    })\n    .onNodeRightClick((node: any) => {\n      if (!draggedNode.value) {\n          toggleLock(node)\n      }\n    })\n    .onNodeHover((node: any) => {\n        hoverNode = node || null\n        if (!props.selectedNodeId && config.hoverHighlight) {\n            computeHighlights()\n        }\n    })\n    .onLinkHover((link: any) => {\n        if (props.selectedNodeId) return // Selection takes precedence\n        if (!config.hoverHighlight) return\n        \n        highlightNodes.clear()\n        highlightLinks.clear()\n\n        if (link) {\n            highlightLinks.add(link)\n            highlightNodes.add(link.source.id)\n            highlightNodes.add(link.target.id)\n        }\n        updateHighlights()\n    })\n    .onBackgroundClick(() => {\n      // Do nothing to enforce \"always selected\" rule\n    })\n    .onNodeDrag((node: any) => {\n        draggedNode.value = node\n    })\n    .onNodeDragEnd((node: any) => {\n        // Enforce lock state on drag end\n        if (node.isLocked) {\n            node.fx = node.x\n            node.fy = node.y\n            node.fz = node.z\n        } else {\n            node.fx = null\n            node.fy = null\n            node.fz = null\n        }\n        draggedNode.value = null\n    })\n\n  applyConfig()\n  setupGeometries()\n}\n\nfunction applyConfig() {\n  const dagMode = config.dagMode === 'null' ? null : config.dagMode;\n\n  graph\n    .backgroundColor(config.backgroundColor)\n    .nodeRelSize(config.nodeRelSize)\n    .linkWidth(config.linkWidth)\n    .linkOpacity(config.linkOpacity)\n    .linkDirectionalParticles(config.linkDirectionalParticles)\n    .linkDirectionalParticleSpeed(config.linkDirectionalParticleSpeed)\n    // Engine Config\n    .forceEngine(config.forceEngine)\n    .numDimensions(config.numDimensions)\n    .dagMode(dagMode)\n    .dagLevelDistance(config.dagLevelDistance)\n    .warmupTicks(config.warmupTicks)\n    .cooldownTicks(config.cooldownTicks)\n    // Arrows & Curvature\n    .linkDirectionalArrowLength(config.directionalArrows ? 3.5 : 0)\n    .linkDirectionalArrowRelPos(1)\n    .linkCurvature(config.linkCurvature)\n    \n  // Physics Update (Only applies if engine is d3)\n  if (config.forceEngine === 'd3') {\n      graph.d3Force('charge').strength(config.chargeStrength)\n  }\n  \n  // Re-heat simulation if changing major structural params\n  graph.numDimensions(config.numDimensions) // Trigger update\n}\n\nfunction createTextSprite(text: string) {\n  const fontFace = 'Arial';\n  const fontSize = 24;\n  const padding = 4;\n  const borderRadius = 4;\n\n  const canvas = document.createElement('canvas');\n  const context = canvas.getContext('2d');\n  if (!context) return new THREE.Object3D();\n\n  context.font = `bold ${fontSize}px ${fontFace}`;\n  const metrics = context.measureText(text);\n  const textWidth = metrics.width;\n  \n  // Resize canvas\n  canvas.width = textWidth + (padding * 2);\n  canvas.height = fontSize + (padding * 2);\n\n  // Background (Rounded Rect)\n  context.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n  context.beginPath();\n  context.roundRect(0, 0, canvas.width, canvas.height, borderRadius);\n  context.fill();\n\n  // Text\n  context.font = `bold ${fontSize}px ${fontFace}`;\n  context.fillStyle = \"white\";\n  context.textBaseline = \"middle\";\n  context.fillText(text, padding, canvas.height / 2);\n\n  const texture = new THREE.CanvasTexture(canvas);\n  texture.minFilter = THREE.LinearFilter;\n  \n  const material = new THREE.SpriteMaterial({ map: texture, transparent: true, depthTest: false });\n  const sprite = new THREE.Sprite(material);\n  \n  // Scale based on canvas ratio, scaled down to world units\n  const scaleFactor = 0.5;\n  sprite.scale.set(canvas.width / 10 * scaleFactor, canvas.height / 10 * scaleFactor, 1);\n  \n  return sprite;\n}\n\nfunction setupGeometries() {\n  graph.nodeThreeObject((node: any) => {\n      const size = Math.pow(node.val || 1, 1 / 3);\n      let geometry;\n\n      switch (node.type) {\n        case 'file':\n          geometry = new THREE.SphereGeometry(size, 16, 16);\n          break;\n        case 'class':\n          geometry = new THREE.BoxGeometry(size * 1.5, size * 1.5, size * 1.5);\n          break;\n        case 'function':\n          geometry = new THREE.ConeGeometry(size, size * 2, 8);\n          break;\n        default:\n          geometry = new THREE.SphereGeometry(size, 8, 8);\n      }\n\n      const material = new THREE.MeshLambertMaterial({\n        color: getHealthColor(node),\n        transparent: true,\n        opacity: 0.9\n      });\n\n      const mesh = new THREE.Mesh(geometry, material);\n      mesh.name = 'node-mesh'\n\n      // Label with LOD\n      const group = new THREE.Group();\n      group.add(mesh);\n\n      const label = createTextSprite(node.name);\n      if (label) {\n        label.position.y = size + 2; // Offset above node\n        \n        const lod = new THREE.LOD();\n        lod.addLevel(label, 0);\n        lod.addLevel(new THREE.Object3D(), config.labelVisibleDistance); // Hide when far\n        group.add(lod);\n      }\n\n      // Apply lock visual if already locked (e.g. after config change or if we implement persistence)\n      updateNodeVisual(group, node)\n      updateNodeVisuals(node) // Apply current highlight state immediately\n\n      return group;\n    })\n    .linkColor((link: any) => {\n        if (config.highlightCycles && link.cycle) return '#ff00ff'\n        if (highlightLinks.size > 0 && highlightLinks.has(link)) return '#a5f3fc' // Lighter color (Cyan 200)\n        return config.linkColor\n    })\n    .linkWidth((link: any) => {\n        if (highlightLinks.size > 0 && highlightLinks.has(link)) return config.linkWidth * 3\n        return config.linkWidth\n    })\n    .linkDirectionalParticles((link: any) => {\n        if (highlightLinks.size > 0 && highlightLinks.has(link)) return 4\n        return config.linkDirectionalParticles\n    })\n    .linkDirectionalParticleWidth(4)\n}\n\nfunction updateGraph(data: GraphData) {\n  // 1. Prepare Nodes Map\n  const nodesMap = new Map<string, GraphNode>()\n  const nodes = data.nodes.map(n => {\n        const node = { ...n, neighbors: [], links: [] }\n        if (node.isLocked === undefined) {\n            node.isLocked = (node.fx !== undefined && node.fx !== null)\n        }\n        nodesMap.set(n.id, node)\n        return node\n  })\n\n  // 2. Clone Links\n  const links = data.links.map(l => ({ ...l }))\n\n  // 3. Cross-link (Compute Neighbors)\n  links.forEach(link => {\n      const a = nodesMap.get(link.source)\n      const b = nodesMap.get(link.target)\n      if (a && b) {\n          a.neighbors!.push(b)\n          b.neighbors!.push(a)\n          a.links!.push(link)\n          b.links!.push(link)\n      }\n  })\n\n  const graphData = { nodes, links }\n  graph.graphData(graphData)\n  // Re-compute highlights if selection exists after update\n  if (props.selectedNodeId) computeHighlights()\n}\n\nfunction computeHighlights() {\n    highlightNodes.clear()\n    highlightLinks.clear()\n\n    // Priority: Selected Node > Hover Node (if config enabled)\n    const focusId = props.selectedNodeId || (config.hoverHighlight ? hoverNode?.id : null)\n    \n    if (focusId) {\n        const { nodes } = graph.graphData()\n        const node = nodes.find((n: any) => n.id === focusId)\n        \n        if (node) {\n            highlightNodes.add(node.id)\n            node.neighbors?.forEach((neighbor: GraphNode) => highlightNodes.add(neighbor.id))\n            node.links?.forEach((link: GraphLink) => highlightLinks.add(link))\n        }\n    }\n    \n    updateHighlights()\n}\n\nfunction updateHighlights() {\n    if (!graph) return\n    \n    // Trigger Link Updates via accessors\n    graph\n        .linkWidth(graph.linkWidth())\n        .linkDirectionalParticles(graph.linkDirectionalParticles())\n        .linkColor(graph.linkColor())\n    \n    // Trigger Node Updates (Custom Objects)\n    const { nodes } = graph.graphData()\n    nodes.forEach((node: any) => {\n        if (node.__threeObj) {\n            updateNodeVisuals(node)\n        }\n    })\n}\n\nfunction updateNodeVisuals(node: any) {\n    if (!node.__threeObj) return\n    \n    const mesh = node.__threeObj.getObjectByName('node-mesh') as THREE.Mesh\n    if (mesh && mesh.material) {\n        const material = mesh.material as THREE.MeshLambertMaterial\n        \n        let color = getHealthColor(node)\n        let opacity = 0.9\n\n        // Only highlight selected node, do not touch neighbors or dim others\n        if (props.selectedNodeId && node.id === props.selectedNodeId) {\n             color = '#3b82f6' // Selected: Blue 500\n             opacity = 1.0\n        }\n        \n        material.color.set(color)\n        material.opacity = opacity\n    }\n    \n    // Handle label visibility - always visible subject to LOD, no filtering by selection\n    const lod = node.__threeObj.children.find((c: any) => c.type === 'LOD')\n    if (lod) {\n       lod.visible = true\n    }\n}\n\nfunction onContainerMouseDown(e: MouseEvent) {\n    // Handle Right Click (Button 2) while dragging\n    if (e.button === 2 && draggedNode.value) {\n        toggleLock(draggedNode.value)\n    }\n}\n\nfunction toggleLock(node: GraphNode) {\n  // Initialize isLocked if undefined (fallback to existing fx)\n  if (node.isLocked === undefined) {\n      // If dragging, we assume it's NOT locked yet, despite fx being set by drag engine\n      if (draggedNode.value === node) {\n          node.isLocked = false\n      } else {\n          node.isLocked = (node.fx !== undefined && node.fx !== null)\n      }\n  }\n\n  node.isLocked = !node.isLocked\n\n  if (node.isLocked) {\n    // Fix position\n    node.fx = node.x\n    node.fy = node.y\n    node.fz = node.z\n  } else {\n    // Release position (only if not currently dragging, otherwise drag handler controls fx)\n    if (draggedNode.value !== node) {\n        node.fx = null\n        node.fy = null\n        node.fz = null\n    }\n  }\n\n  // Update Visuals\n  if (node.__threeObj) {\n    updateNodeVisual(node.__threeObj, node)\n  }\n}\n\nfunction updateNodeVisual(group: THREE.Group, node: GraphNode) {\n  const lockName = 'lock-indicator'\n  const existing = group.getObjectByName(lockName)\n  \n  // Check isLocked prop, fallback to fx check for initial load\n  const isLocked = node.isLocked !== undefined ? node.isLocked : (node.fx !== undefined && node.fx !== null)\n\n  if (isLocked && !existing) {\n    // Create Lock Indicator (Wireframe Cage)\n    const size = Math.pow(node.val || 1, 1 / 3) * 1.5 // Slightly larger than node\n    // Using BoxGeometry for distinct look vs spheres, or Sphere for cleaner look. \n    // Let's use an Icosahedron for a 'forcefield' look.\n    const geometry = new THREE.IcosahedronGeometry(size, 0)\n    const edges = new THREE.WireframeGeometry(geometry)\n    const material = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.3 })\n    const mesh = new THREE.LineSegments(edges, material)\n    mesh.name = lockName\n    group.add(mesh)\n  } else if (!isLocked && existing) {\n    group.remove(existing)\n    // Cleanup\n    ;(existing as any).geometry.dispose()\n    ;(existing as any).material.dispose()\n  }\n}\n\nfunction focusNode(id: string) {\n  if (!graph) return\n  const { nodes } = graph.graphData()\n  const node = nodes.find((n: any) => n.id === id)\n\n  if (node) {\n    const distance = 100\n    const distRatio = 1 + distance / Math.hypot(node.x, node.y, node.z)\n\n    graph.cameraPosition(\n      { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio },\n      node,\n      2000\n    )\n  }\n}\n\ndefineExpose({ focusNode })\n</script>\n"
    },
    {
      "filename": "src/components/ConfigPanel.vue",
      "content": "<template>\n  <div class=\"bg-zinc-900/80 backdrop-blur border border-zinc-800 rounded-lg p-4 w-72 flex flex-col gap-3 text-xs text-zinc-300 shadow-xl\">\n    <h3 class=\"font-bold text-zinc-400 uppercase tracking-wider mb-1\">Visualization Config</h3>\n    \n    <div class=\"space-y-1\">\n      <label class=\"flex justify-between\">Node Size <span>{{ config.nodeRelSize }}</span></label>\n      <input type=\"range\" min=\"1\" max=\"15\" step=\"0.5\" v-model.number=\"config.nodeRelSize\" class=\"w-full accent-blue-500\" />\n    </div>\n\n      <div class=\"space-y-1\">\n        <label class=\"flex justify-between\">Link Width <span>{{ config.linkWidth }}</span></label>\n        <input type=\"range\" min=\"0.1\" max=\"3\" step=\"0.1\" v-model.number=\"config.linkWidth\" class=\"w-full accent-blue-500\" />\n      </div>\n\n    <div class=\"space-y-1\">\n      <label class=\"flex justify-between\">Label Distance <span>{{ config.labelVisibleDistance }}</span></label>\n      <input type=\"range\" min=\"50\" max=\"500\" step=\"10\" v-model.number=\"config.labelVisibleDistance\" class=\"w-full accent-blue-500\" />\n    </div>\n\n    <div class=\"flex justify-between items-center py-1\">\n       <label class=\"cursor-pointer select-none\" for=\"chk-cycles\">Highlight Cycles</label>\n       <input id=\"chk-cycles\" type=\"checkbox\" v-model=\"config.highlightCycles\" class=\"w-4 h-4 accent-red-500\" />\n    </div>\n\n    <div class=\"flex justify-between items-center py-1\">\n       <label class=\"cursor-pointer select-none\" for=\"chk-only-cycles\">Only Show Cycles</label>\n       <input id=\"chk-only-cycles\" type=\"checkbox\" v-model=\"config.onlyShowCycles\" class=\"w-4 h-4 accent-red-500\" />\n    </div>\n\n    <div class=\"pt-2 border-t border-zinc-700/50 space-y-2\">\n       <h4 class=\"font-bold text-zinc-500 uppercase tracking-wider text-[10px]\">Interactions & Effects</h4>\n       <div class=\"flex justify-between items-center\">\n          <label class=\"cursor-pointer select-none\" for=\"chk-hover\">Hover Highlight</label>\n          <input id=\"chk-hover\" type=\"checkbox\" v-model=\"config.hoverHighlight\" class=\"w-4 h-4 accent-blue-500\" />\n       </div>\n       <div class=\"flex justify-between items-center\">\n          <label class=\"cursor-pointer select-none\" for=\"chk-arrows\">Directional Arrows</label>\n          <input id=\"chk-arrows\" type=\"checkbox\" v-model=\"config.directionalArrows\" class=\"w-4 h-4 accent-blue-500\" />\n       </div>\n       <div class=\"space-y-1\">\n          <label class=\"flex justify-between\">Link Curvature <span>{{ config.linkCurvature }}</span></label>\n          <input type=\"range\" min=\"0\" max=\"1\" step=\"0.1\" v-model.number=\"config.linkCurvature\" class=\"w-full accent-blue-500\" />\n       </div>\n    </div>\n\n    <div class=\"space-y-1\">\n      <label class=\"flex justify-between\">Link Opacity <span>{{ config.linkOpacity }}</span></label>\n      <input type=\"range\" min=\"0.1\" max=\"1\" step=\"0.1\" v-model.number=\"config.linkOpacity\" class=\"w-full accent-blue-500\" />\n    </div>\n\n    <div class=\"space-y-1\">\n      <label class=\"flex justify-between\">Particle Flow <span>{{ config.linkDirectionalParticles }}</span></label>\n      <input type=\"range\" min=\"0\" max=\"5\" step=\"1\" v-model.number=\"config.linkDirectionalParticles\" class=\"w-full accent-blue-500\" />\n    </div>\n\n    <div class=\"space-y-1\" v-if=\"config.forceEngine === 'd3'\">\n      <label class=\"flex justify-between\">Repulsion Force <span>{{ config.chargeStrength }}</span></label>\n      <input type=\"range\" min=\"-500\" max=\"-10\" step=\"10\" v-model.number=\"config.chargeStrength\" class=\"w-full accent-blue-500\" />\n    </div>\n\n    <div class=\"pt-2 border-t border-zinc-700/50 space-y-3\">\n      <h4 class=\"font-bold text-zinc-500 uppercase tracking-wider text-[10px]\">Engine & Layout</h4>\n      \n      <div class=\"flex justify-between items-center\">\n         <label>Engine</label>\n         <select v-model=\"config.forceEngine\" class=\"bg-zinc-800 border border-zinc-700 rounded px-1 text-zinc-300\">\n           <option value=\"d3\">d3-force</option>\n           <option value=\"ngraph\">ngraph</option>\n         </select>\n      </div>\n\n      <div class=\"flex justify-between items-center\">\n         <label>Dimensions</label>\n         <div class=\"flex gap-1\">\n            <button \n              v-for=\"dim in [1, 2, 3]\" :key=\"dim\" \n              @click=\"config.numDimensions = dim as any\"\n              class=\"px-2 py-0.5 rounded border border-zinc-700\"\n              :class=\"config.numDimensions === dim ? 'bg-blue-600 text-white border-blue-500' : 'bg-zinc-800 text-zinc-400'\"\n            >\n              {{ dim }}D\n            </button>\n         </div>\n      </div>\n\n      <div class=\"space-y-1\">\n        <div class=\"flex justify-between items-center\">\n           <label>DAG Mode</label>\n           <select v-model=\"config.dagMode\" class=\"bg-zinc-800 border border-zinc-700 rounded px-1 text-zinc-300 max-w-[8rem]\">\n             <option value=\"null\">None</option>\n             <option value=\"td\">Top-Down</option>\n             <option value=\"bu\">Bottom-Up</option>\n             <option value=\"lr\">Left-Right</option>\n             <option value=\"rl\">Right-Left</option>\n             <option value=\"zout\">Z-Out</option>\n             <option value=\"zin\">Z-In</option>\n             <option value=\"radialout\">Radial-Out</option>\n             <option value=\"radialin\">Radial-In</option>\n           </select>\n        </div>\n      </div>\n\n      <div v-if=\"config.dagMode !== 'null'\" class=\"space-y-1\">\n        <label class=\"flex justify-between\">DAG Distance <span>{{ config.dagLevelDistance }}</span></label>\n        <input type=\"range\" min=\"10\" max=\"200\" step=\"10\" v-model.number=\"config.dagLevelDistance\" class=\"w-full accent-blue-500\" />\n      </div>\n    </div>\n\n    <div class=\"pt-2 border-t border-zinc-700/50 flex justify-between items-center\">\n       <span class=\"text-[10px] text-zinc-500\">Background</span>\n       <input type=\"color\" v-model=\"config.backgroundColor\" class=\"w-6 h-6 rounded bg-transparent border-none p-0 cursor-pointer\" />\n    </div>\n\n    <button @click=\"config.reset()\" class=\"mt-2 w-full py-1 bg-zinc-800 hover:bg-zinc-700 rounded text-zinc-400 transition-colors\">\n      Reset Defaults\n    </button>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useGraphConfigStore } from '../stores/graphConfig'\nconst config = useGraphConfigStore()\n</script>\n"
    },
    {
      "filename": "src/components/GraphExplorer.vue",
      "content": "<template>\n  <div class=\"flex gap-2 max-h-[90vh] pointer-events-auto items-start\">\n    <!-- 1. Left Column: Structure (Islands) -->\n    <div class=\"w-16 flex flex-col gap-2 bg-zinc-900/90 backdrop-blur border border-zinc-800 rounded-lg py-3 shadow-xl overflow-y-auto max-h-full scrollbar-hide\">\n        <div \n            v-for=\"island in islands\" \n            :key=\"island.id\"\n            @click=\"selectIsland(island)\"\n            class=\"w-12 h-12 mx-auto rounded-lg flex items-center justify-center cursor-pointer transition-all relative group shrink-0\"\n            :class=\"activeIslandId === island.id ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'bg-zinc-800/50 text-zinc-500 hover:bg-zinc-800 hover:text-zinc-300'\"\n            :title=\"`${island.name} (${island.count} nodes)`\"\n        >\n            <NodeIcon \n                :type=\"island.type === 'orphan' ? (island.representative?.type || 'file') : 'cluster'\" \n                :color=\"island.type === 'orphan' ? getNodeColor(island.representative) : undefined\"\n                class=\"w-6 h-6\"\n            />\n\n            <!-- Badge count -->\n            <div class=\"absolute -top-1 -right-1 bg-zinc-950 text-[9px] text-zinc-400 px-1 rounded-full border border-zinc-700 min-w-[16px] text-center\">\n                {{ island.count }}\n            </div>\n        </div>\n    </div>\n\n    <!-- 2. Right Column: Node Inspector & Search -->\n    <div class=\"w-96 flex flex-col gap-4 max-h-full overflow-hidden\">\n        <!-- Search Bar -->\n        <div class=\"bg-zinc-900/90 backdrop-blur border border-zinc-800 rounded-lg p-3 shadow-lg flex flex-col gap-2 shrink-0\">\n            <div class=\"flex items-center gap-2 border-b border-zinc-800 pb-2\">\n                <svg class=\"text-zinc-500\" xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"11\" cy=\"11\" r=\"8\"></circle><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"></line></svg>\n                <input \n                    v-model=\"searchQuery\" \n                    class=\"bg-transparent border-none text-xs text-zinc-200 focus:outline-none w-full placeholder-zinc-600\"\n                    placeholder=\"Search nodes...\"\n                />\n            </div>\n            \n            <!-- Search Results Overlay -->\n            <div v-if=\"searchResults.length > 0\" class=\"max-h-48 overflow-y-auto mt-1 flex flex-col gap-0.5\">\n                <div \n                    v-for=\"node in searchResults\" \n                    :key=\"node.id\"\n                    @click=\"selectNode(node)\"\n                    class=\"text-xs text-zinc-400 hover:text-white hover:bg-zinc-800 cursor-pointer p-1.5 rounded truncate flex items-center gap-2\"\n                >\n                    <NodeIcon :type=\"node.type\" :color=\"getNodeColor(node)\" class=\"w-3 h-3\" />\n                    <span class=\"truncate\">{{ node.name }}</span>\n                </div>\n            </div>\n        </div>\n\n        <!-- Current Node Details -->\n        <div v-if=\"selectedNode\" class=\"bg-zinc-900/90 backdrop-blur border border-zinc-800 rounded-lg p-4 shadow-xl text-zinc-100 flex flex-col overflow-hidden flex-1\">\n            <div class=\"flex items-center gap-3 mb-2\">\n                <div class=\"p-1.5 bg-zinc-800/50 rounded-lg border border-zinc-700/50\">\n                     <NodeIcon :type=\"selectedNode.type\" :color=\"getNodeColor(selectedNode)\" class=\"w-6 h-6\" />\n                </div>\n                <h2 class=\"text-lg font-bold truncate flex-1\" :title=\"selectedNode.id\">{{ selectedNode.name }}</h2>\n            </div>\n\n            <!-- Path Display -->\n            <div class=\"flex items-center gap-2 bg-zinc-950/30 rounded border border-zinc-800/50 px-2 py-1 mb-3 group\">\n                 <span class=\"text-[10px] font-mono text-zinc-500 truncate select-all flex-1\">{{ selectedNode.id }}</span>\n                 <button \n                    @click=\"copyToClipboard(selectedNode.id)\" \n                    class=\"text-zinc-600 hover:text-zinc-300 focus:outline-none transition-colors opacity-60 group-hover:opacity-100\"\n                    title=\"Copy ID\"\n                 >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>\n                 </button>\n            </div>\n\n            <div class=\"flex gap-2 mb-4\">\n                <span v-if=\"selectedNode.island\" class=\"text-[10px] uppercase font-bold px-2 py-0.5 rounded bg-zinc-800 text-zinc-500 border border-zinc-700 truncate max-w-[100px]\" :title=\"selectedNode.island\">\n                    {{ selectedNode.island }}\n                </span>\n            </div>\n\n            <div class=\"grid grid-cols-2 gap-2 mb-4 shrink-0\">\n                <div class=\"bg-zinc-800/30 p-2 rounded border border-zinc-800/50\">\n                    <span class=\"text-[10px] text-zinc-500 block\">LOC</span>\n                    <span class=\"text-sm font-mono\">{{ Math.round(selectedNode.val * 5) }}</span>\n                </div>\n                <div class=\"bg-zinc-800/30 p-2 rounded border border-zinc-800/50\">\n                    <span class=\"text-[10px] text-zinc-500 block\">Health</span>\n                    <span class=\"text-sm font-bold\" :class=\"selectedNode.errorCount ? 'text-red-400' : 'text-green-400'\">\n                        {{ selectedNode.errorCount || 'Healthy' }}\n                    </span>\n                </div>\n            </div>\n\n            <div class=\"flex-1 overflow-y-auto pr-1 custom-scrollbar\">\n                <div class=\"grid grid-cols-2 gap-4 h-full content-start\">\n                    <!-- Left: Dependents (Incoming) -->\n                    <div>\n                        <div class=\"sticky top-0 bg-zinc-900 py-1 z-10 border-b border-zinc-800 mb-2 flex justify-between items-end\">\n                             <h3 class=\"text-[10px] uppercase tracking-wider text-zinc-500 font-bold\">Dependents</h3>\n                             <span class=\"text-[9px] text-zinc-600 font-mono\">{{ incomingLinks.length }}</span>\n                        </div>\n                        \n                        <div v-if=\"incomingLinks.length === 0\" class=\"text-zinc-600 text-xs italic\">None</div>\n                        <div class=\"flex flex-col gap-1\">\n                            <div v-for=\"ref in incomingLinks\" :key=\"ref.id\" @click=\"selectNodeById(ref.id)\" class=\"cursor-pointer text-xs p-1.5 rounded hover:bg-zinc-800 text-zinc-400 hover:text-zinc-200 truncate border border-transparent hover:border-zinc-700 flex items-center gap-2\" :title=\"ref.name\">\n                                <NodeIcon :type=\"ref.type\" :color=\"getNodeColor(ref)\" class=\"w-2.5 h-2.5\" />\n                                <span class=\"truncate\">{{ ref.name }}</span>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Right: Dependencies (Outgoing) -->\n                    <div>\n                        <div class=\"sticky top-0 bg-zinc-900 py-1 z-10 border-b border-zinc-800 mb-2 flex justify-between items-end\">\n                             <h3 class=\"text-[10px] uppercase tracking-wider text-zinc-500 font-bold\">Dependencies</h3>\n                             <span class=\"text-[9px] text-zinc-600 font-mono\">{{ outgoingLinks.length }}</span>\n                        </div>\n\n                        <div v-if=\"outgoingLinks.length === 0\" class=\"text-zinc-600 text-xs italic\">None</div>\n                        <div class=\"flex flex-col gap-1\">\n                            <div v-for=\"dep in outgoingLinks\" :key=\"dep.id\" @click=\"selectNodeById(dep.id)\" class=\"cursor-pointer text-xs p-1.5 rounded hover:bg-zinc-800 text-zinc-400 hover:text-zinc-200 truncate border border-transparent hover:border-zinc-700 flex items-center gap-2\" :title=\"dep.name\">\n                                <NodeIcon :type=\"dep.type\" :color=\"getNodeColor(dep)\" class=\"w-2.5 h-2.5\" />\n                                <span class=\"truncate\">{{ dep.name }}</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, watch } from 'vue'\nimport type { GraphData, GraphNode } from '../types/graph'\nimport { useGraphConfigStore } from '../stores/graphConfig'\nimport NodeIcon from './NodeIcon.vue'\n\nconst props = defineProps<{\n    data: GraphData | null,\n    selectedNode: GraphNode | null\n}>()\n\nconst emit = defineEmits<{\n    (e: 'select', node: GraphNode): void,\n    (e: 'close'): void,\n    (e: 'focus-group', nodeIds: string[]): void\n}>()\n\nconst config = useGraphConfigStore()\nconst searchQuery = ref('')\nconst activeIslandId = ref<string | null>(null)\n\n// --- Helpers ---\nfunction getNodeColor(node: GraphNode | undefined) {\n    if (!node) return '#555'\n    if (config.highlightCycles && node.cycle) return '#ff00ff'\n    const errors = node.errorCount || 0\n    if (errors === 0) return '#22c55e'\n    if (errors < 3) return '#eab308'\n    if (errors < 10) return '#f97316'\n    return '#ef4444'\n}\n\n// --- Search ---\nconst searchResults = computed(() => {\n    if (!searchQuery.value || !props.data) return []\n    const q = searchQuery.value.toLowerCase()\n    return props.data.nodes.filter(n => n.name.toLowerCase().includes(q)).slice(0, 20)\n})\n\n// --- Dependencies ---\nconst outgoingLinks = computed(() => {\n    if (!props.selectedNode || !props.data) return []\n    return props.data.links\n        .filter(l => l.source === props.selectedNode!.id)\n        .map(l => {\n            const target = props.data!.nodes.find(n => n.id === l.target)\n            return target || { \n                id: l.target, \n                name: l.target, \n                type: 'file', \n                val: 1, \n                group: 1 \n            } as GraphNode\n        })\n})\n\nconst incomingLinks = computed(() => {\n    if (!props.selectedNode || !props.data) return []\n    return props.data.links\n        .filter(l => l.target === props.selectedNode!.id)\n        .map(l => {\n            const source = props.data!.nodes.find(n => n.id === l.source)\n            return source || { \n                id: l.source, \n                name: l.source, \n                type: 'file', \n                val: 1, \n                group: 1 \n            } as GraphNode\n        })\n})\n\n// --- Islands ---\nconst islands = computed(() => {\n    if (!props.data) return []\n    const counts = new Map<string, number>()\n    props.data.nodes.forEach(n => {\n        const i = n.island || 'unknown'\n        counts.set(i, (counts.get(i) || 0) + 1)\n    })\n    \n    const result = []\n    const totalNodes = props.data.nodes.length\n\n    for (const [id, count] of counts.entries()) {\n        // Classification for Icon\n        let type = 'isolated'\n        let name = 'Group'\n        let representative: GraphNode | undefined = undefined\n        \n        if (count > (totalNodes * 0.5)) {\n            type = 'main'\n            name = 'Main App'\n        } else if (count === 1) {\n            type = 'orphan'\n            name = 'Orphan'\n            // Find the node\n            representative = props.data.nodes.find(n => n.island === id)\n        }\n        \n        result.push({ id, count, name, type, representative })\n    }\n    return result.sort((a, b) => b.count - a.count)\n})\n\n// --- Initialization Logic ---\nwatch(() => props.data, (newData) => {\n    if (newData && newData.nodes.length > 0) {\n        // 1. Select First Island by default\n        const firstIsland = islands.value[0]\n        if (firstIsland) {\n            activeIslandId.value = firstIsland.id\n            \n            // 2. If no selected node, select the most important node in this island\n            if (!props.selectedNode) {\n                autoSelectNodeInIsland(firstIsland.id)\n            }\n        }\n    }\n}, { immediate: true })\n\n// Watch selectedNode to sync Active Island\nwatch(() => props.selectedNode, (newNode) => {\n    if (newNode && newNode.island && newNode.island !== activeIslandId.value) {\n        activeIslandId.value = newNode.island\n    }\n})\n\nfunction autoSelectNodeInIsland(islandId: string) {\n    if (!props.data) return\n    \n    // Find nodes in this island\n    const islandNodes = props.data.nodes.filter(n => n.island === islandId)\n    if (islandNodes.length === 0) return\n    \n    // Pick largest node (highest 'val')\n    const bestNode = islandNodes.reduce((prev, current) => (prev.val > current.val) ? prev : current)\n    \n    emit('select', bestNode)\n}\n\n// --- Actions ---\nfunction selectIsland(island: any) {\n    activeIslandId.value = island.id\n    emit('focus-group', props.data?.nodes.filter(n => n.island === island.id).map(n => n.id) || [])\n    \n    // If current selected node is NOT in this island, switch selection\n    if (props.selectedNode?.island !== island.id) {\n        autoSelectNodeInIsland(island.id)\n    }\n}\n\nfunction selectNode(node: GraphNode) {\n    emit('select', node)\n    searchQuery.value = '' // Clear search\n}\n\nfunction selectNodeById(id: string) {\n    const node = props.data?.nodes.find(n => n.id === id)\n    if (node) emit('select', node)\n}\n\nfunction copyToClipboard(text: string) {\n    navigator.clipboard.writeText(text)\n}\n</script>\n\n<style scoped>\n/* Hide scrollbar for Chrome, Safari and Opera */\n.scrollbar-hide::-webkit-scrollbar {\n    display: none;\n}\n\n/* Hide scrollbar for IE, Edge and Firefox */\n.scrollbar-hide {\n    -ms-overflow-style: none;  /* IE and Edge */\n    scrollbar-width: none;  /* Firefox */\n}\n\n.custom-scrollbar::-webkit-scrollbar {\n    width: 4px;\n}\n.custom-scrollbar::-webkit-scrollbar-track {\n    background: rgba(0,0,0,0.1);\n}\n.custom-scrollbar::-webkit-scrollbar-thumb {\n    background: rgba(255,255,255,0.2);\n    border-radius: 4px;\n}\n</style>\n"
    },
    {
      "filename": "src/components/NodeIcon.vue",
      "content": "<template>\n  <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" class=\"inline-block shrink-0\">\n    <!-- File: Sphere -> Circle -->\n    <circle v-if=\"type === 'file'\" cx=\"12\" cy=\"12\" r=\"8\" :fill=\"fillColor\" stroke=\"currentColor\" stroke-width=\"2\" stroke-opacity=\"0.2\" />\n    \n    <!-- Class: Box -> Square -->\n    <rect v-else-if=\"type === 'class'\" x=\"5\" y=\"5\" width=\"14\" height=\"14\" rx=\"2\" :fill=\"fillColor\" stroke=\"currentColor\" stroke-width=\"2\" stroke-opacity=\"0.2\" />\n    \n    <!-- Function: Cone -> Triangle -->\n    <path v-else-if=\"type === 'function'\" d=\"M12 3L21 20H3L12 3Z\" :fill=\"fillColor\" stroke=\"currentColor\" stroke-width=\"2\" stroke-opacity=\"0.2\" />\n    \n    <!-- Cluster (Default) -->\n    <g v-else>\n       <circle cx=\"8\" cy=\"8\" r=\"4\" :fill=\"fillColor\" opacity=\"0.9\" />\n       <circle cx=\"16\" cy=\"16\" r=\"4\" :fill=\"fillColor\" opacity=\"0.7\" />\n       <circle cx=\"16\" cy=\"8\" r=\"4\" :fill=\"fillColor\" opacity=\"0.8\" />\n       <circle cx=\"8\" cy=\"16\" r=\"4\" :fill=\"fillColor\" opacity=\"0.6\" />\n    </g>\n  </svg>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nconst props = defineProps<{\n  type: string\n  color?: string\n}>()\n\nconst fillColor = computed(() => props.color || 'currentColor')\n</script>\n"
    },
    {
      "filename": "src/components/NodeInfoPanel.vue",
      "content": "<template>\n  <div v-if=\"node\" class=\"w-80 bg-zinc-900/90 backdrop-blur-md rounded-lg border border-zinc-800 p-4 shadow-xl text-zinc-100 flex flex-col max-h-[80vh]\">\n    <!-- Header -->\n    <div class=\"flex justify-between items-center mb-4\">\n      <h2 class=\"text-lg font-bold truncate\">{{ node.name }}</h2>\n      <span \n        class=\"text-[10px] uppercase font-bold px-2 py-1 rounded bg-zinc-800 text-zinc-400 border border-zinc-700\"\n      >\n        {{ node.type }}\n      </span>\n    </div>\n    \n    <!-- Stats -->\n    <div class=\"space-y-3 mb-4\">\n      <div>\n        <label class=\"text-[10px] uppercase tracking-wider text-zinc-500 font-bold block mb-1\">Identifier</label>\n        <code class=\"block bg-black/50 p-2 rounded text-xs font-mono text-zinc-400 break-all border border-zinc-800/50\">\n          {{ node.id }}\n        </code>\n      </div>\n      \n      <div class=\"grid grid-cols-2 gap-2\">\n        <div class=\"bg-zinc-800/30 p-2 rounded border border-zinc-800/50\">\n          <span class=\"text-[10px] text-zinc-500 block\">Health</span>\n          <span class=\"text-sm font-bold\" :class=\"node.errorCount ? 'text-red-400' : 'text-green-400'\">\n             {{ node.errorCount ? `${node.errorCount} Issues` : 'Healthy' }}\n          </span>\n        </div>\n        <div class=\"bg-zinc-800/30 p-2 rounded border border-zinc-800/50\">\n          <span class=\"text-[10px] text-zinc-500 block\">LOC (Est.)</span>\n          <span class=\"text-sm font-mono\">{{ Math.round(node.val * 5) }}</span>\n        </div>\n        <div class=\"bg-zinc-800/30 p-2 rounded border border-zinc-800/50\">\n          <span class=\"text-[10px] text-zinc-500 block\">Group</span>\n          <span class=\"text-sm font-mono\">{{ node.group }}</span>\n        </div>\n      </div>\n    </div>\n\n    <!-- Dependencies List -->\n    <div class=\"flex-1 overflow-hidden flex flex-col\">\n        <h3 class=\"text-[10px] uppercase tracking-wider text-zinc-500 font-bold mb-2 sticky top-0 bg-zinc-900/90 py-1\">\n            Links To ({{ dependencies.length }})\n        </h3>\n        <div class=\"overflow-y-auto space-y-1 flex-1 pr-1\">\n            <div v-if=\"dependencies.length === 0\" class=\"text-zinc-600 text-xs italic p-2\">\n                No outgoing links\n            </div>\n            <div \n                v-for=\"dep in dependencies\" \n                :key=\"dep.id\" \n                class=\"bg-zinc-800/40 p-2 rounded border border-zinc-800/30 text-xs text-zinc-300 hover:bg-zinc-800 hover:border-zinc-700 transition-colors cursor-pointer\"\n                @click=\"$emit('select-dependency', dep.id)\"\n            >\n                <div class=\"font-mono truncate\">{{ dep.name }}</div>\n                <div class=\"text-[10px] text-zinc-500 truncate\">{{ dep.id }}</div>\n            </div>\n        </div>\n    </div>\n\n  </div>\n  \n  <div v-else class=\"w-80 bg-zinc-900/50 backdrop-blur-sm rounded-lg border border-zinc-800/50 p-4 text-center text-zinc-500 text-sm\">\n    Click a node to inspect details\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport type { GraphNode } from '../types/graph'\n\ninterface Dependency {\n    id: string\n    name: string\n}\n\ndefineProps<{ \n    node: GraphNode | null,\n    dependencies: Dependency[]\n}>()\n\ndefineEmits<{ (e: 'select-dependency', id: string): void }>()\n</script>\n"
    },
    {
      "filename": "src/main.ts",
      "content": "import { createApp } from 'vue'\nimport { createPinia } from 'pinia'\nimport piniaPluginPersistedstate from 'pinia-plugin-persistedstate'\nimport './style.css'\nimport App from './App.vue'\n\nconst pinia = createPinia()\npinia.use(piniaPluginPersistedstate)\n\nconst app = createApp(App)\napp.use(pinia)\napp.mount('#app')\n"
    },
    {
      "filename": "src/server/api/graph.get.ts",
      "content": "import { defineEventHandler, getQuery } from \"h3\";\nimport { Project } from \"ts-morph\";\nimport { resolve, relative } from \"path\";\nimport * as fs from \"fs\";\n\nexport default defineEventHandler(async (event) => {\n\tconst query = getQuery(event);\n\t// Use provided path or default to CWD\n\tconst rawPath = (query.path as string) || process.cwd();\n\tconst projectRoot = resolve(rawPath);\n\n\tif (!fs.existsSync(projectRoot)) {\n\t\tthrow createError({\n\t\t\tstatusCode: 404,\n\t\t\tstatusMessage: \"Path not found\",\n\t\t\tdata: { path: projectRoot },\n\t\t});\n\t}\n\n\t// Initialize Project\n\t// Attempt to load tsconfig if present in the target root\n\tlet project: Project;\n\tconst tsConfigPath = resolve(projectRoot, \"tsconfig.json\");\n\n\ttry {\n\t\tif (fs.existsSync(tsConfigPath)) {\n\t\t\tproject = new Project({\n\t\t\t\ttsConfigFilePath: tsConfigPath,\n\t\t\t\tskipAddingFilesFromTsConfig: true,\n\t\t\t\tcompilerOptions: {\n\t\t\t\t\tallowJs: true,\n\t\t\t\t\tskipLibCheck: true,\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\tthrow new Error(\"No tsconfig\");\n\t\t}\n\t} catch (e) {\n\t\tproject = new Project({\n\t\t\tcompilerOptions: {\n\t\t\t\tallowJs: true,\n\t\t\t\tskipLibCheck: true,\n\t\t\t\tbaseUrl: projectRoot,\n\t\t\t\tpaths: {\n\t\t\t\t\t\"~/*\": [\"./*\"],\n\t\t\t\t\t\"@/*\": [\"./*\"],\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t// Recursive walker\n\tconst walkSync = (dir: string, filelist: string[] = []) => {\n\t\tif (!fs.existsSync(dir)) return filelist;\n\t\ttry {\n\t\t\tfs.readdirSync(dir).forEach((file) => {\n\t\t\t\tconst filepath = resolve(dir, file);\n\t\t\t\tconst stat = fs.statSync(filepath);\n\t\t\t\tif (stat.isDirectory()) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t![\n\t\t\t\t\t\t\t\"node_modules\",\n\t\t\t\t\t\t\t\".nuxt\",\n\t\t\t\t\t\t\t\".output\",\n\t\t\t\t\t\t\t\".git\",\n\t\t\t\t\t\t\t\"dist\",\n\t\t\t\t\t\t\t\"coverage\",\n\t\t\t\t\t\t].includes(file)\n\t\t\t\t\t) {\n\t\t\t\t\t\twalkSync(filepath, filelist);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (\n\t\t\t\t\t\tfile.endsWith(\".ts\") ||\n\t\t\t\t\t\tfile.endsWith(\".vue\") ||\n\t\t\t\t\t\tfile.endsWith(\".js\")\n\t\t\t\t\t) {\n\t\t\t\t\t\tfilelist.push(filepath);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} catch (e) {\n\t\t\t// Ignore access errors\n\t\t}\n\t\treturn filelist;\n\t};\n\n\t// Scan directory\n\t// If it's a specific src/app folder, just scan that. If root, scan sensible defaults if they exist.\n\tconst sensibleDirs = [\n\t\t\"src\",\n\t\t\"server\",\n\t\t\"app\",\n\t\t\"components\",\n\t\t\"pages\",\n\t\t\"composables\",\n\t\t\"utils\",\n\t\t\"lib\",\n\t];\n\tconst sourceFiles: string[] = [];\n\n\t// Check if we are at a project root with subdirs\n\tlet foundSensible = false;\n\tsensibleDirs.forEach((d) => {\n\t\tconst fullPath = resolve(projectRoot, d);\n\t\tif (fs.existsSync(fullPath)) {\n\t\t\tsourceFiles.push(...walkSync(fullPath));\n\t\t\tfoundSensible = true;\n\t\t}\n\t});\n\n\t// If no structure found, just scan the root recursively\n\tif (!foundSensible) {\n\t\tsourceFiles.push(...walkSync(projectRoot));\n\t}\n\n\t// Limit file count to prevent crashes on huge repos for now\n\tconst limitedFiles = sourceFiles.slice(0, 500);\n\n\tlimitedFiles.forEach((file) => project.addSourceFileAtPath(file));\n\tproject.resolveSourceFileDependencies();\n\n\tconst nodes: any[] = [];\n\tconst links: any[] = [];\n\tconst nodeSet = new Set<string>();\n\n\tconst addNode = (\n\t\tid: string,\n\t\tname: string,\n\t\ttype: string,\n\t\tgroup: number,\n\t\tval: number = 1,\n\t) => {\n\t\tif (!nodeSet.has(id)) {\n\t\t\tnodes.push({ id, name, type, group, val });\n\t\t\tnodeSet.add(id);\n\t\t}\n\t};\n\n\tproject.getSourceFiles().forEach((sourceFile) => {\n\t\tconst filePath = sourceFile.getFilePath();\n\t\tconst relPath = relative(projectRoot, filePath);\n\n\t\tif (relPath.includes(\"node_modules\") || relPath.startsWith(\"..\")) return;\n\n\t\tconst fileId = relPath;\n\t\tconst loc = sourceFile.getEndLineNumber();\n\n\t\taddNode(fileId, sourceFile.getBaseName(), \"file\", 1, Math.max(1, loc / 5));\n\n\t\tsourceFile.getClasses().forEach((cls) => {\n\t\t\tconst name = cls.getName();\n\t\t\tif (name) {\n\t\t\t\tconst id = `${fileId}#${name}`;\n\t\t\t\taddNode(id, name, \"class\", 2, 3);\n\t\t\t\tlinks.push({ source: fileId, target: id, type: \"contains\" });\n\t\t\t}\n\t\t});\n\n\t\tsourceFile.getFunctions().forEach((func) => {\n\t\t\tconst name = func.getName();\n\t\t\tif (name) {\n\t\t\t\tconst id = `${fileId}#${name}`;\n\t\t\t\taddNode(id, name, \"function\", 3, 2);\n\t\t\t\tlinks.push({ source: fileId, target: id, type: \"contains\" });\n\t\t\t}\n\t\t});\n\n\t\tsourceFile.getImportDeclarations().forEach((importDecl) => {\n\t\t\tconst importedSourceFile = importDecl.getModuleSpecifierSourceFile();\n\t\t\tif (importedSourceFile) {\n\t\t\t\tconst targetPath = relative(\n\t\t\t\t\tprojectRoot,\n\t\t\t\t\timportedSourceFile.getFilePath(),\n\t\t\t\t);\n\t\t\t\tif (\n\t\t\t\t\t!targetPath.includes(\"node_modules\") &&\n\t\t\t\t\ttargetPath !== relPath &&\n\t\t\t\t\t!targetPath.startsWith(\"..\")\n\t\t\t\t) {\n\t\t\t\t\tif (!nodeSet.has(targetPath)) {\n\t\t\t\t\t\taddNode(targetPath, importedSourceFile.getBaseName(), \"file\", 1, 1);\n\t\t\t\t\t}\n\t\t\t\t\tlinks.push({ source: fileId, target: targetPath, type: \"imports\" });\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\treturn {\n\t\tpath: projectRoot,\n\t\tstats: {\n\t\t\tfiles: limitedFiles.length,\n\t\t\tnodes: nodes.length,\n\t\t\tlinks: links.length,\n\t\t},\n\t\tnodes,\n\t\tlinks,\n\t};\n});\n"
    },
    {
      "filename": "src/stores/counter.ts",
      "content": "import { ref, computed } from 'vue'\nimport { defineStore } from 'pinia'\n\nexport const useCounterStore = defineStore('counter', () => {\n  const count = ref(0)\n  const doubleCount = computed(() => count.value * 2)\n  function increment() {\n    count.value++\n  }\n\n  return { count, doubleCount, increment }\n})\n"
    },
    {
      "filename": "src/stores/graphConfig.ts",
      "content": "import { defineStore } from \"pinia\";\nimport { ref } from \"vue\";\n\nexport const useGraphConfigStore = defineStore(\n\t\"graphConfig\",\n\t() => {\n\t\t// Appearance\n\t\tconst backgroundColor = ref(\"#19191d\");\n\t\tconst nodeColor = ref(\"#cccccc\");\n\t\tconst linkColor = ref(\"#555555\");\n\n\t\t// Physics & Layout\n\t\tconst nodeRelSize = ref(4); // Multiplier for node sphere size\n\t\tconst linkWidth = ref(0.5);\n\t\tconst linkOpacity = ref(0.5);\n\t\tconst linkDirectionalParticles = ref(0);\n\t\tconst linkDirectionalParticleSpeed = ref(0.005);\n\n\t\t// Forces\n\t\tconst chargeStrength = ref(-100);\n\t\tconst distanceMax = ref(400);\n\n\t\t// Engine & Advanced\n\t\tconst forceEngine = ref<\"d3\" | \"ngraph\">(\"d3\");\n\t\tconst numDimensions = ref<1 | 2 | 3>(3);\n\t\tconst dagMode = ref<string>(\"null\"); // 'null', 'td', 'bu', 'lr', 'rl', 'zout', 'zin', 'radialout', 'radialin'\n\t\tconst dagLevelDistance = ref(50);\n\t\tconst warmupTicks = ref(0);\n\t\tconst cooldownTicks = ref(15000); // -1 for infinite\n\n\t\tfunction reset() {\n\t\t\tbackgroundColor.value = \"#19191d\";\n\t\t\tnodeRelSize.value = 4;\n\t\t\tlinkWidth.value = 0.5;\n\t\t\tlinkOpacity.value = 0.5;\n\t\t\tlinkDirectionalParticles.value = 0;\n\t\t\tchargeStrength.value = -100;\n\t\t\tforceEngine.value = \"d3\";\n\t\t\tnumDimensions.value = 3;\n\t\t\tdagMode.value = \"null\";\n\t\t\tdagLevelDistance.value = 50;\n\t\t\twarmupTicks.value = 0;\n\t\t\tcooldownTicks.value = 15000;\n\t\t}\n\n\t\treturn {\n\t\t\tbackgroundColor,\n\t\t\tnodeColor,\n\t\t\tlinkColor,\n\t\t\tnodeRelSize,\n\t\t\tlinkWidth,\n\t\t\tlinkOpacity,\n\t\t\tlinkDirectionalParticles,\n\t\t\tlinkDirectionalParticleSpeed,\n\t\t\tchargeStrength,\n\t\t\tdistanceMax,\n\t\t\tforceEngine,\n\t\t\tnumDimensions,\n\t\t\tdagMode,\n\t\t\tdagLevelDistance,\n\t\t\twarmupTicks,\n\t\t\tcooldownTicks,\n\t\t\treset,\n\t\t};\n\t},\n\t{\n\t\tpersist: true,\n\t},\n);\n"
    },
    {
      "filename": "src/stores/history.ts",
      "content": "import { defineStore } from 'pinia'\nimport { ref } from 'vue'\n\nexport const useHistoryStore = defineStore('history', () => {\n  const recentPaths = ref<string[]>([])\n  const lastPath = ref<string>('')\n\n  function addPath(path: string) {\n    if (!path) return\n    // Remove if exists to move to top\n    recentPaths.value = recentPaths.value.filter(p => p !== path)\n    // Add to beginning\n    recentPaths.value.unshift(path)\n    // Keep max 10\n    if (recentPaths.value.length > 10) {\n      recentPaths.value.pop()\n    }\n    lastPath.value = path\n  }\n\n  return { recentPaths, lastPath, addPath }\n}, {\n  persist: true\n})\n"
    },
    {
      "filename": "src/style.css",
      "content": "@import \"tailwindcss\";\n\n:root {\n\tbackground-color: #19191d;\n\tcolor: #ffffff;\n}\n\nbody {\n\tmargin: 0;\n\tpadding: 0;\n\toverflow: hidden;\n\twidth: 100vw;\n\theight: 100vh;\n}\n\n#app {\n\twidth: 100%;\n\theight: 100%;\n}\n"
    },
    {
      "filename": "src/types/graph.ts",
      "content": "export interface GraphNode {\n  id: string\n  name: string\n  type: 'file' | 'class' | 'function'\n  group: number\n  val: number\n  errorCount?: number\n  cycle?: boolean\n  x?: number\n  y?: number\n  z?: number\n  vx?: number\n  vy?: number\n  vz?: number\n  fx?: number | null\n  fy?: number | null\n  fz?: number | null\n  __threeObj?: any\n  isLocked?: boolean\n  neighbors?: GraphNode[]\n  links?: GraphLink[]\n  island?: string\n}\n\nexport interface GraphLink {\n  source: string\n  target: string\n  type: 'contains' | 'imports'\n  cycle?: boolean\n  sourceNode?: GraphNode\n  targetNode?: GraphNode\n}\n\nexport interface GraphData {\n  path?: string\n  stats?: { files: number, nodes: number, links: number }\n  nodes: GraphNode[]\n  links: GraphLink[]\n}\n"
    }
  ]
}